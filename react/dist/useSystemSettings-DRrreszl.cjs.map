{"version":3,"file":"useSystemSettings-DRrreszl.cjs","sources":["../src/utils/systemSettingsApi.ts","../src/hooks/useSystemSettings.ts"],"sourcesContent":["import type {\n  ListSystemSettingsResponse,\n  UpdateSettingRequest,\n  UpdateSystemSettingsResponse,\n} from '../types';\nimport { ApiClient, handleApiError } from './apiClient';\n\n/**\n * API client for system settings operations (admin only)\n */\nexport class SystemSettingsApiClient {\n  private client: ApiClient;\n\n  constructor(\n    baseUrl: string,\n    timeoutMs?: number,\n    retryAttempts?: number,\n    getAccessToken?: () => string | null\n  ) {\n    this.client = new ApiClient({ baseUrl, timeoutMs, retryAttempts, getAccessToken });\n  }\n\n  /**\n   * Get all system settings grouped by category\n   * Requires system admin privileges\n   */\n  async getSettings(): Promise<ListSystemSettingsResponse> {\n    try {\n      return await this.client.get<ListSystemSettingsResponse>('/admin/settings');\n    } catch (error) {\n      throw handleApiError(error, 'Failed to fetch system settings');\n    }\n  }\n\n  /**\n   * Update one or more system settings\n   * Requires system admin privileges\n   */\n  async updateSettings(settings: UpdateSettingRequest[]): Promise<UpdateSystemSettingsResponse> {\n    try {\n      return await this.client.patch<UpdateSystemSettingsResponse>('/admin/settings', {\n        settings,\n      });\n    } catch (error) {\n      throw handleApiError(error, 'Failed to update system settings');\n    }\n  }\n}\n","import { useState, useCallback, useMemo, useRef } from 'react';\nimport type { SystemSetting, UpdateSettingRequest, UseSystemSettingsReturn } from '../types';\nimport { useCedrosLogin } from '../context/useCedrosLogin';\nimport { SystemSettingsApiClient } from '../utils/systemSettingsApi';\n\n/**\n * Hook for managing system settings (admin only).\n *\n * Provides CRUD operations for system-wide configuration settings\n * stored in the database. Only accessible to system administrators.\n *\n * @example\n * ```tsx\n * function SystemSettingsPanel() {\n *   const {\n *     settings,\n *     isLoading,\n *     error,\n *     fetchSettings,\n *     updateSettings,\n *     getValue,\n *   } = useSystemSettings();\n *\n *   useEffect(() => {\n *     fetchSettings();\n *   }, [fetchSettings]);\n *\n *   const handleSave = async () => {\n *     await updateSettings([\n *       { key: 'privacy_period_secs', value: '1209600' },\n *     ]);\n *   };\n *\n *   return (\n *     <div>\n *       {Object.entries(settings).map(([category, items]) => (\n *         <section key={category}>\n *           <h3>{category}</h3>\n *           {items.map(item => (\n *             <div key={item.key}>\n *               {item.key}: {item.value}\n *             </div>\n *           ))}\n *         </section>\n *       ))}\n *     </div>\n *   );\n * }\n * ```\n */\nexport function useSystemSettings(): UseSystemSettingsReturn {\n  const { config, authState, _internal } = useCedrosLogin();\n\n  const [settings, setSettings] = useState<Record<string, SystemSetting[]>>({});\n  const [isLoading, setIsLoading] = useState(false);\n  const [isUpdating, setIsUpdating] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n  const requestIdRef = useRef(0);\n\n  const apiClient = useMemo(\n    () =>\n      new SystemSettingsApiClient(\n        config.serverUrl,\n        config.requestTimeout,\n        config.retryAttempts,\n        _internal?.getAccessToken\n      ),\n    [config.serverUrl, config.requestTimeout, config.retryAttempts, _internal]\n  );\n\n  // Use ref to avoid apiClient in callback dependencies\n  const apiClientRef = useRef(apiClient);\n  apiClientRef.current = apiClient;\n\n  const fetchSettings = useCallback(async () => {\n    if (authState !== 'authenticated') {\n      setSettings({});\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n    const requestId = ++requestIdRef.current;\n\n    try {\n      const response = await apiClientRef.current.getSettings();\n      if (requestId !== requestIdRef.current) return;\n      setSettings(response.settings);\n    } catch (err) {\n      if (requestId !== requestIdRef.current) return;\n      setError(err instanceof Error ? err : new Error('Failed to fetch settings'));\n    } finally {\n      if (requestId === requestIdRef.current) {\n        setIsLoading(false);\n      }\n    }\n  }, [authState]);\n\n  const updateSettings = useCallback(\n    async (updates: UpdateSettingRequest[]): Promise<void> => {\n      if (authState !== 'authenticated') {\n        throw new Error('Not authenticated');\n      }\n\n      setIsUpdating(true);\n      setError(null);\n\n      try {\n        await apiClientRef.current.updateSettings(updates);\n        // Refresh settings after update\n        await fetchSettings();\n      } catch (err) {\n        const error = err instanceof Error ? err : new Error('Failed to update settings');\n        setError(error);\n        throw error;\n      } finally {\n        setIsUpdating(false);\n      }\n    },\n    [authState, fetchSettings]\n  );\n\n  const getValue = useCallback(\n    (key: string): string | undefined => {\n      for (const categorySettings of Object.values(settings)) {\n        const found = categorySettings.find((s) => s.key === key);\n        if (found) return found.value;\n      }\n      return undefined;\n    },\n    [settings]\n  );\n\n  return {\n    settings,\n    isLoading,\n    isUpdating,\n    error,\n    fetchSettings,\n    updateSettings,\n    getValue,\n  };\n}\n"],"names":["SystemSettingsApiClient","baseUrl","timeoutMs","retryAttempts","getAccessToken","ApiClient","error","handleApiError","settings","useSystemSettings","config","authState","_internal","useCedrosLogin","setSettings","useState","isLoading","setIsLoading","isUpdating","setIsUpdating","setError","requestIdRef","useRef","apiClient","useMemo","apiClientRef","fetchSettings","useCallback","requestId","response","err","updateSettings","updates","getValue","key","categorySettings","found","s"],"mappings":"iFAUO,MAAMA,CAAwB,CAC3B,OAER,YACEC,EACAC,EACAC,EACAC,EACA,CACA,KAAK,OAAS,IAAIC,YAAU,CAAE,QAAAJ,EAAS,UAAAC,EAAW,cAAAC,EAAe,eAAAC,EAAgB,CACnF,CAMA,MAAM,aAAmD,CACvD,GAAI,CACF,OAAO,MAAM,KAAK,OAAO,IAAgC,iBAAiB,CAC5E,OAASE,EAAO,CACd,MAAMC,EAAAA,eAAeD,EAAO,iCAAiC,CAC/D,CACF,CAMA,MAAM,eAAeE,EAAyE,CAC5F,GAAI,CACF,OAAO,MAAM,KAAK,OAAO,MAAoC,kBAAmB,CAC9E,SAAAA,CAAA,CACD,CACH,OAASF,EAAO,CACd,MAAMC,EAAAA,eAAeD,EAAO,kCAAkC,CAChE,CACF,CACF,CCGO,SAASG,GAA6C,CAC3D,KAAM,CAAE,OAAAC,EAAQ,UAAAC,EAAW,UAAAC,CAAA,EAAcC,EAAAA,eAAA,EAEnC,CAACL,EAAUM,CAAW,EAAIC,EAAAA,SAA0C,CAAA,CAAE,EACtE,CAACC,EAAWC,CAAY,EAAIF,EAAAA,SAAS,EAAK,EAC1C,CAACG,EAAYC,CAAa,EAAIJ,EAAAA,SAAS,EAAK,EAC5C,CAACT,EAAOc,CAAQ,EAAIL,EAAAA,SAAuB,IAAI,EAC/CM,EAAeC,EAAAA,OAAO,CAAC,EAEvBC,EAAYC,EAAAA,QAChB,IACE,IAAIxB,EACFU,EAAO,UACPA,EAAO,eACPA,EAAO,cACPE,GAAW,cAAA,EAEf,CAACF,EAAO,UAAWA,EAAO,eAAgBA,EAAO,cAAeE,CAAS,CAAA,EAIrEa,EAAeH,EAAAA,OAAOC,CAAS,EACrCE,EAAa,QAAUF,EAEvB,MAAMG,EAAgBC,EAAAA,YAAY,SAAY,CAC5C,GAAIhB,IAAc,gBAAiB,CACjCG,EAAY,CAAA,CAAE,EACd,MACF,CAEAG,EAAa,EAAI,EACjBG,EAAS,IAAI,EACb,MAAMQ,EAAY,EAAEP,EAAa,QAEjC,GAAI,CACF,MAAMQ,EAAW,MAAMJ,EAAa,QAAQ,YAAA,EAC5C,GAAIG,IAAcP,EAAa,QAAS,OACxCP,EAAYe,EAAS,QAAQ,CAC/B,OAASC,EAAK,CACZ,GAAIF,IAAcP,EAAa,QAAS,OACxCD,EAASU,aAAe,MAAQA,EAAM,IAAI,MAAM,0BAA0B,CAAC,CAC7E,QAAA,CACMF,IAAcP,EAAa,SAC7BJ,EAAa,EAAK,CAEtB,CACF,EAAG,CAACN,CAAS,CAAC,EAERoB,EAAiBJ,EAAAA,YACrB,MAAOK,GAAmD,CACxD,GAAIrB,IAAc,gBAChB,MAAM,IAAI,MAAM,mBAAmB,EAGrCQ,EAAc,EAAI,EAClBC,EAAS,IAAI,EAEb,GAAI,CACF,MAAMK,EAAa,QAAQ,eAAeO,CAAO,EAEjD,MAAMN,EAAA,CACR,OAASI,EAAK,CACZ,MAAMxB,EAAQwB,aAAe,MAAQA,EAAM,IAAI,MAAM,2BAA2B,EAChF,MAAAV,EAASd,CAAK,EACRA,CACR,QAAA,CACEa,EAAc,EAAK,CACrB,CACF,EACA,CAACR,EAAWe,CAAa,CAAA,EAGrBO,EAAWN,EAAAA,YACdO,GAAoC,CACnC,UAAWC,KAAoB,OAAO,OAAO3B,CAAQ,EAAG,CACtD,MAAM4B,EAAQD,EAAiB,KAAME,GAAMA,EAAE,MAAQH,CAAG,EACxD,GAAIE,SAAcA,EAAM,KAC1B,CAEF,EACA,CAAC5B,CAAQ,CAAA,EAGX,MAAO,CACL,SAAAA,EACA,UAAAQ,EACA,WAAAE,EACA,MAAAZ,EACA,cAAAoB,EACA,eAAAK,EACA,SAAAE,CAAA,CAEJ"}