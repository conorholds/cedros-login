"use strict";const n=require("react/jsx-runtime"),r=require("react"),W=require("./useCedrosLogin-C9MrcZvh.cjs"),P=require("./validation-BuGQrA-K.cjs"),R=require("./LoadingSpinner-d6sSxgQN.cjs");function q(){const{config:e,_internal:t}=W.useCedrosLogin(),[c,o]=r.useState(!1),[v,i]=r.useState(null),g=r.useMemo(()=>new W.ApiClient({baseUrl:e.serverUrl,timeoutMs:e.requestTimeout,retryAttempts:e.retryAttempts}),[e.serverUrl,e.requestTimeout,e.retryAttempts]),s=r.useCallback(async h=>{if(!P.validateSolanaPublicKey(h)){const u={code:"INVALID_PUBLIC_KEY",message:"Invalid Solana public key format"};throw i(u),u}o(!0),i(null);try{return await g.post("/solana/challenge",{publicKey:h},{credentials:"omit"})}catch(u){const d=W.handleApiError(u,"Failed to get challenge");throw i(d),d}finally{o(!1)}},[g]),S=r.useCallback(async(h,u,d)=>{if(!P.validateSolanaPublicKey(h)){const l={code:"INVALID_PUBLIC_KEY",message:"Invalid Solana public key format"};throw i(l),l}o(!0),i(null);try{const l=await g.post("/solana",{publicKey:h,signature:u,message:d});return e.callbacks?.onLoginSuccess?.(l.user,"solana"),t?.handleLoginSuccess(l.user,l.tokens),l}catch(l){const f=W.handleApiError(l,"Solana sign-in failed");throw i(f),f}finally{o(!1)}},[g,e.callbacks,t]),b=r.useCallback(()=>i(null),[]);return{requestChallenge:s,signIn:S,isLoading:c,error:v,clearError:b}}const V=["phantom","solflare","backpack","glow","slope","sollet","coin98","clover","mathWallet","ledger","torus","walletconnect"];function _(e){if(!e||typeof e!="object")return!1;const t=e;return typeof t.connect=="function"||typeof t.signMessage=="function"||typeof t.signTransaction=="function"||"isConnected"in t}function $(){try{const e=window.__wallet_standard__;if(e&&typeof e=="object"&&"get"in e&&typeof e.get=="function"){const t=e.get();return Array.isArray(t)&&t.length>0}}catch{}return!1}function B(){if(typeof window>"u")return!1;const e=window;for(const t of V){const c=e[t];if(c&&typeof c=="object"&&"solana"in c&&_(c.solana))return!0}return!!(_(e.solana)||$())}function O({onSuccess:e,onError:t,className:c="",variant:o="default",size:v="md",disabled:i=!1,hideIfNoWallet:g=!0,walletContext:s}){const{requestChallenge:S,signIn:b,isLoading:h}=q(),[u,d]=r.useState(!1),[l,f]=r.useState(!1),[I,L]=r.useState(!1),j=r.useRef(!1),[D]=r.useState(()=>B()),m=s?.connected??!1,C=s?.connecting??!1,p=s?.publicKey,w=s?.signMessage,E=s?.wallet,y=(s?.wallets??[]).filter(a=>a.adapter.readyState==="Installed"||a.adapter.readyState==="Loadable"),z=s?y.length>0:D,A=r.useCallback(async()=>{if(!j.current){if(!p||!w){t?.(new Error("Wallet not ready"));return}j.current=!0;try{const a=p.toBase58(),k=await S(a),K=new TextEncoder().encode(k.message),N=await w(K);if(!(N instanceof Uint8Array)||N.length===0)throw new Error("Wallet returned invalid signature");let M;try{M=btoa(String.fromCharCode(...N))}catch{throw new Error("Failed to encode signature")}await b(a,M,k.message),e?.()}catch(a){const k=a instanceof Error?a:new Error(String(a));t?.(k)}finally{j.current=!1,f(!1)}}},[p,w,S,b,e,t]);if(r.useEffect(()=>{I&&E&&!m&&!C&&s?.connect&&(L(!1),s.connect().catch(a=>{t?.(a instanceof Error?a:new Error(String(a))),f(!1)}))},[I,E,m,C,s,t]),r.useEffect(()=>{l&&m&&p&&w&&!j.current&&A().catch(()=>{})},[l,m,p,w,A]),g&&!z)return null;const F=async()=>{i||h||C||(m&&p&&w?(f(!0),await A()):E?(f(!0),L(!0)):y.length===1?(s?.select(y[0].adapter.name),f(!0),L(!0)):y.length>1?d(!0):t?.(new Error("No Solana wallet found. Please install Phantom or another Solana wallet.")))},H=a=>{d(!1),s?.select(a),f(!0),L(!0)},T={sm:"cedros-button-sm",md:"cedros-button-md",lg:"cedros-button-lg"},U={default:"cedros-button-solana",outline:"cedros-button-solana-outline"},x=h||C||l&&!m;return n.jsxs(n.Fragment,{children:[n.jsxs("button",{type:"button",className:`cedros-button ${U[o]} ${T[v]} ${c}`,onClick:F,disabled:i||x,"aria-label":"Continue with Solana",children:[x?n.jsx(R.LoadingSpinner,{size:"sm"}):n.jsxs("svg",{className:"cedros-button-icon",width:"18",height:"18",viewBox:"0 0 128 128",fill:"currentColor","aria-hidden":"true",children:[n.jsx("path",{d:"M25.38 96.04a4.35 4.35 0 0 1 3.07-1.27h91.68c1.93 0 2.9 2.34 1.54 3.7l-17.71 17.72a4.35 4.35 0 0 1-3.07 1.27H9.21c-1.93 0-2.9-2.34-1.54-3.7l17.71-17.72z"}),n.jsx("path",{d:"M25.38 11.81a4.47 4.47 0 0 1 3.07-1.27h91.68c1.93 0 2.9 2.34 1.54 3.7L103.96 31.96a4.35 4.35 0 0 1-3.07 1.27H9.21c-1.93 0-2.9-2.34-1.54-3.7L25.38 11.81z"}),n.jsx("path",{d:"M102.62 53.76a4.35 4.35 0 0 0-3.07-1.27H7.87c-1.93 0-2.9 2.34-1.54 3.7l17.71 17.72a4.35 4.35 0 0 0 3.07 1.27h91.68c1.93 0 2.9-2.34 1.54-3.7L102.62 53.76z"})]}),n.jsx("span",{children:"Continue with Solana"})]}),u&&n.jsx("div",{className:"cedros-modal-backdrop",onClick:()=>d(!1),role:"presentation",children:n.jsxs("div",{className:"cedros-modal cedros-wallet-selector",role:"dialog","aria-modal":"true","aria-labelledby":"wallet-selector-title",onClick:a=>a.stopPropagation(),children:[n.jsxs("div",{className:"cedros-modal-header",children:[n.jsx("h2",{id:"wallet-selector-title",className:"cedros-modal-title",children:"Select Wallet"}),n.jsx("button",{type:"button",className:"cedros-modal-close",onClick:()=>d(!1),"aria-label":"Close",children:n.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:n.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),n.jsx("div",{className:"cedros-modal-content",children:n.jsx("div",{className:"cedros-wallet-list",children:y.map(a=>n.jsxs("button",{type:"button",className:"cedros-wallet-option",onClick:()=>H(a.adapter.name),children:[n.jsx("img",{src:a.adapter.icon,alt:"",width:"32",height:"32",className:"cedros-wallet-icon"}),n.jsx("span",{children:a.adapter.name})]},a.adapter.name))})})]})})]})}function Y(e){if(typeof window>"u")return!1;try{const t=require("@solana-mobile/wallet-standard-mobile"),c=e?.chains??["solana:mainnet"],o={appIdentity:{name:e?.name,uri:e?.uri,icon:e?.icon},chains:c};return typeof t.createDefaultAuthorizationCache=="function"&&(o.authorizationCache=t.createDefaultAuthorizationCache()),typeof t.createDefaultChainSelector=="function"&&(o.chainSelector=t.createDefaultChainSelector()),typeof t.createDefaultWalletNotFoundHandler=="function"&&(o.onWalletNotFound=t.createDefaultWalletNotFoundHandler()),t.registerMwa(o),!0}catch{return!1}}exports.SolanaLoginButton=O;exports.detectSolanaWallets=B;exports.registerMobileWallet=Y;exports.useSolanaAuth=q;
