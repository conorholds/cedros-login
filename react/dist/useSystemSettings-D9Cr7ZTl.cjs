"use strict";const e=require("react"),g=require("./apiClient-CTTKhsYb.cjs");class q{client;constructor(t,i,a,o){this.client=new g.ApiClient({baseUrl:t,timeoutMs:i,retryAttempts:a,getAccessToken:o})}async getSettings(){try{return await this.client.get("/admin/settings")}catch(t){throw g.handleApiError(t,"Failed to fetch system settings")}}async updateSettings(t){try{return await this.client.patch("/admin/settings",{settings:t})}catch(i){throw g.handleApiError(i,"Failed to update system settings")}}}function k(){const{config:s,authState:t,_internal:i}=g.useCedrosLogin(),[a,o]=e.useState({}),[p,h]=e.useState(!1),[w,y]=e.useState(!1),[m,u]=e.useState(null),l=e.useRef(0),S=e.useMemo(()=>new q(s.serverUrl,s.requestTimeout,s.retryAttempts,i?.getAccessToken),[s.serverUrl,s.requestTimeout,s.retryAttempts,i]),f=e.useRef(S);f.current=S;const d=e.useCallback(async()=>{if(t!=="authenticated"){o({});return}h(!0),u(null);const n=++l.current;try{const r=await f.current.getSettings();if(n!==l.current)return;o(r.settings)}catch(r){if(n!==l.current)return;u(r instanceof Error?r:new Error("Failed to fetch settings"))}finally{n===l.current&&h(!1)}},[t]),C=e.useCallback(async n=>{if(t!=="authenticated")throw new Error("Not authenticated");y(!0),u(null);try{await f.current.updateSettings(n),await d()}catch(r){const c=r instanceof Error?r:new Error("Failed to update settings");throw u(c),c}finally{y(!1)}},[t,d]),E=e.useCallback(n=>{for(const r of Object.values(a)){const c=r.find(A=>A.key===n);if(c)return c.value}},[a]);return{settings:a,isLoading:p,isUpdating:w,error:m,fetchSettings:d,updateSettings:C,getValue:E}}exports.useSystemSettings=k;
