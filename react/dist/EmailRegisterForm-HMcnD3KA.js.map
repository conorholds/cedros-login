{"version":3,"file":"EmailRegisterForm-HMcnD3KA.js","sources":["../src/hooks/useRateLimiter.ts","../src/hooks/useEmailAuth.ts","../src/hooks/useInstantLink.ts","../src/components/email/PasswordInput.tsx","../src/hooks/useTotpVerify.ts","../src/components/totp/OtpInput.tsx","../src/components/totp/TotpVerify.tsx","../src/components/email/EmailLoginForm.tsx","../src/components/email/EmailRegisterForm.tsx"],"sourcesContent":["import { useRef, useCallback, useState, useEffect } from 'react';\n\nexport interface UseRateLimiterOptions {\n  /** Maximum number of attempts allowed within the window */\n  maxAttempts?: number;\n  /** Time window in milliseconds */\n  windowMs?: number;\n  /**\n   * UI-25: Set to true to enable the 1s countdown interval for displaying\n   * time-until-reset in the UI. When false (default), no interval is started,\n   * saving resources for callers that don't display a countdown.\n   */\n  showCountdown?: boolean;\n}\n\nexport interface UseRateLimiterReturn {\n  /**\n   * Check if an action is allowed. Throws an error if rate limited.\n   * Call this before performing the action.\n   */\n  checkLimit: () => void;\n  /**\n   * Check if an action is allowed without throwing.\n   * Returns true if allowed, false if rate limited.\n   */\n  isAllowed: () => boolean;\n  /**\n   * Get remaining attempts in current window\n   */\n  getRemainingAttempts: () => number;\n  /**\n   * Get time until rate limit resets (in ms)\n   */\n  getTimeUntilReset: () => number;\n  /**\n   * Reset the rate limiter (e.g., after successful action)\n   */\n  reset: () => void;\n}\n\n/**\n * Rate limiting hook to prevent excessive API calls from the client.\n *\n * @param options - Rate limiter configuration\n * @returns Rate limiter functions\n *\n * @example\n * ```tsx\n * function LoginForm() {\n *   const { checkLimit, getRemainingAttempts } = useRateLimiter({\n *     maxAttempts: 5,\n *     windowMs: 60000, // 1 minute\n *   });\n *\n *   const handleLogin = async () => {\n *     try {\n *       checkLimit(); // Throws if rate limited\n *       await login(email, password);\n *     } catch (err) {\n *       if (err.message.includes('Too many attempts')) {\n *         // Show rate limit message\n *       }\n *     }\n *   };\n * }\n * ```\n */\nexport function useRateLimiter(options: UseRateLimiterOptions = {}): UseRateLimiterReturn {\n  const { maxAttempts = 5, windowMs = 60000, showCountdown = false } = options;\n\n  // Store timestamps of recent attempts\n  const attemptsRef = useRef<number[]>([]);\n  const [hasAttempts, setHasAttempts] = useState(false);\n  const [, setTick] = useState(0);\n\n  const bump = useCallback(() => {\n    setTick((value) => value + 1);\n  }, []);\n\n  /**\n   * Remove expired attempts from the tracking array (no state update).\n   * Safe to call during render for getter functions.\n   */\n  const cleanupAttemptsArray = useCallback(() => {\n    const now = Date.now();\n    attemptsRef.current = attemptsRef.current.filter((timestamp) => now - timestamp < windowMs);\n  }, [windowMs]);\n\n  /**\n   * Remove expired attempts AND update hasAttempts state.\n   * M-04: Use functional setState to avoid hasAttempts dependency cascade.\n   * Only call from event handlers and effects, NOT during render.\n   */\n  const cleanupExpiredAttempts = useCallback(() => {\n    cleanupAttemptsArray();\n    // Functional update avoids dependency on hasAttempts\n    setHasAttempts((current) => (attemptsRef.current.length === 0 && current ? false : current));\n  }, [cleanupAttemptsArray]);\n\n  /**\n   * Get the number of remaining attempts\n   * Uses cleanupAttemptsArray (no state) so safe to call during render.\n   */\n  const getRemainingAttempts = useCallback((): number => {\n    cleanupAttemptsArray();\n    return Math.max(0, maxAttempts - attemptsRef.current.length);\n  }, [cleanupAttemptsArray, maxAttempts]);\n\n  /**\n   * Get time until rate limit resets\n   * Uses cleanupAttemptsArray (no state) so safe to call during render.\n   */\n  const getTimeUntilReset = useCallback((): number => {\n    cleanupAttemptsArray();\n    if (attemptsRef.current.length === 0) {\n      return 0;\n    }\n    const oldestAttempt = attemptsRef.current[0];\n    const resetTime = oldestAttempt + windowMs;\n    return Math.max(0, resetTime - Date.now());\n  }, [cleanupAttemptsArray, windowMs]);\n\n  /**\n   * Check if an action is allowed without throwing\n   * Uses cleanupAttemptsArray (no state) so safe to call during render.\n   */\n  const isAllowed = useCallback((): boolean => {\n    cleanupAttemptsArray();\n    return attemptsRef.current.length < maxAttempts;\n  }, [cleanupAttemptsArray, maxAttempts]);\n\n  /**\n   * Check rate limit and throw if exceeded\n   */\n  const checkLimit = useCallback((): void => {\n    cleanupExpiredAttempts();\n\n    if (attemptsRef.current.length >= maxAttempts) {\n      const waitTime = getTimeUntilReset();\n      const waitSeconds = Math.ceil(waitTime / 1000);\n      throw new Error(\n        `Too many attempts. Please wait ${waitSeconds} second${waitSeconds === 1 ? '' : 's'} before trying again.`\n      );\n    }\n\n    // Record this attempt\n    attemptsRef.current.push(Date.now());\n    // M-04: Functional update avoids hasAttempts dependency\n    setHasAttempts((current) => (current ? current : true));\n    bump();\n  }, [cleanupExpiredAttempts, maxAttempts, getTimeUntilReset, bump]);\n\n  /**\n   * Reset the rate limiter\n   */\n  const reset = useCallback((): void => {\n    attemptsRef.current = [];\n    // M-04: Functional update avoids hasAttempts dependency\n    setHasAttempts((current) => (current ? false : current));\n    bump();\n  }, [bump]);\n\n  // UI-25: Only start the 1s interval when the caller opts into countdown display.\n  // This avoids a tick firing every second for all callers that don't show a countdown.\n  useEffect(() => {\n    if (!hasAttempts || !showCountdown) return;\n    const intervalId = window.setInterval(() => {\n      cleanupExpiredAttempts();\n      bump();\n    }, 1000);\n    return () => {\n      window.clearInterval(intervalId);\n    };\n  }, [hasAttempts, showCountdown, bump, cleanupExpiredAttempts]);\n\n  return {\n    checkLimit,\n    isAllowed,\n    getRemainingAttempts,\n    getTimeUntilReset,\n    reset,\n  };\n}\n","import { useState, useCallback, useMemo } from 'react';\nimport { useCedrosLogin } from '../context/useCedrosLogin';\nimport { ApiClient, handleApiError } from '../utils/apiClient';\nimport { validateEmail } from '../utils/validation';\nimport { useRateLimiter } from './useRateLimiter';\nimport type { AuthResponse, AuthError } from '../types';\nimport type { MfaRequiredResponse } from '../types';\n\nfunction isMfaRequiredResponse(\n  response: AuthResponse | MfaRequiredResponse\n): response is MfaRequiredResponse {\n  return 'mfaRequired' in response && response.mfaRequired === true;\n}\n\n/** Result when MFA verification is required */\nexport interface MfaRequiredResult {\n  mfaRequired: true;\n  mfaToken: string;\n  email: string;\n  userId: string;\n}\n\n/** Result of successful login (no TOTP required or after TOTP verification) */\nexport interface LoginSuccessResult {\n  mfaRequired: false;\n  response: AuthResponse;\n}\n\n/** Union type for login result */\nexport type LoginResult = MfaRequiredResult | LoginSuccessResult;\n\nexport interface UseEmailAuthReturn {\n  /** Login - may return mfaRequired if 2FA is enabled */\n  login: (email: string, password: string) => Promise<LoginResult>;\n  register: (email: string, password: string, name?: string) => Promise<AuthResponse>;\n  isLoading: boolean;\n  error: AuthError | null;\n  clearError: () => void;\n  /**\n   * Number of remaining login attempts before rate limiting.\n   *\n   * M-10: Snapshot Behavior\n   * This value is a point-in-time snapshot computed at render time.\n   * It may be briefly stale during rapid requests or concurrent renders.\n   * For UI display only - actual rate limiting is enforced inside login/register.\n   */\n  remainingAttempts: number;\n  /**\n   * Time in ms until rate limit resets (0 if not rate limited).\n   *\n   * M-10: Snapshot Behavior\n   * This value is a point-in-time snapshot computed at render time.\n   * It may be briefly stale - use for UI display, not for logic decisions.\n   */\n  timeUntilReset: number;\n}\n\n/**\n * Hook for email/password authentication.\n *\n * @example\n * ```tsx\n * function LoginForm() {\n *   const { login, isLoading, error } = useEmailAuth();\n *\n *   const handleSubmit = async (e) => {\n *     e.preventDefault();\n *     try {\n *       await login(email, password);\n *     } catch (err) {\n *       // Handle error\n *     }\n *   };\n * }\n * ```\n */\nexport function useEmailAuth(): UseEmailAuthReturn {\n  const { config, _internal } = useCedrosLogin();\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<AuthError | null>(null);\n\n  // Rate limiter for login attempts (5 attempts per minute)\n  const {\n    checkLimit,\n    getRemainingAttempts,\n    getTimeUntilReset,\n    reset: resetRateLimit,\n  } = useRateLimiter({ maxAttempts: 5, windowMs: 60000 });\n\n  const apiClient = useMemo(\n    () =>\n      new ApiClient({\n        baseUrl: config.serverUrl,\n        timeoutMs: config.requestTimeout,\n        retryAttempts: config.retryAttempts,\n      }),\n    [config.serverUrl, config.requestTimeout, config.retryAttempts]\n  );\n\n  const callbacks = config.callbacks;\n  const walletEnrollmentEnabled = config.features?.walletEnrollment !== false;\n  const serverUrl = config.serverUrl;\n\n  const login = useCallback(\n    async (email: string, password: string): Promise<LoginResult> => {\n      // Validate email format before API call\n      if (!validateEmail(email)) {\n        const validationError: AuthError = {\n          code: 'VALIDATION_ERROR',\n          message: 'Please enter a valid email address',\n        };\n        setError(validationError);\n        throw validationError;\n      }\n\n      // UI-7: Rate limit is checked BEFORE API call intentionally.\n      // This prevents brute force attacks by limiting attempt frequency,\n      // not just successful request frequency.\n      try {\n        checkLimit();\n      } catch (err) {\n        const rateLimitError: AuthError = {\n          code: 'RATE_LIMITED',\n          message: err instanceof Error ? err.message : 'Too many attempts',\n        };\n        setError(rateLimitError);\n        throw rateLimitError;\n      }\n\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const data = await apiClient.post<AuthResponse | MfaRequiredResponse>('/login', {\n          email,\n          password,\n        });\n\n        // Check if MFA verification is required\n        if (isMfaRequiredResponse(data)) {\n          return {\n            mfaRequired: true,\n            mfaToken: data.mfaToken,\n            email,\n            userId: data.userId,\n          };\n        }\n\n        // Normal login success\n        const authResponse: AuthResponse = data;\n        callbacks?.onLoginSuccess?.(authResponse.user, 'email');\n        _internal?.handleLoginSuccess(authResponse.user, authResponse.tokens);\n        resetRateLimit(); // Reset on successful login\n        return {\n          mfaRequired: false,\n          response: authResponse,\n        };\n      } catch (err) {\n        const authError = handleApiError(err, 'Login failed');\n        setError(authError);\n        throw authError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [apiClient, callbacks, _internal, checkLimit, resetRateLimit]\n  );\n\n  const register = useCallback(\n    async (email: string, password: string, name?: string): Promise<AuthResponse> => {\n      // Validate email format before API call\n      if (!validateEmail(email)) {\n        const validationError: AuthError = {\n          code: 'VALIDATION_ERROR',\n          message: 'Please enter a valid email address',\n        };\n        setError(validationError);\n        throw validationError;\n      }\n\n      // UI-7: Rate limit is checked BEFORE API call intentionally.\n      // This prevents brute force attacks by limiting attempt frequency,\n      // not just successful request frequency.\n      try {\n        checkLimit();\n      } catch (err) {\n        const rateLimitError: AuthError = {\n          code: 'RATE_LIMITED',\n          message: err instanceof Error ? err.message : 'Too many attempts',\n        };\n        setError(rateLimitError);\n        throw rateLimitError;\n      }\n\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const data = await apiClient.post<AuthResponse>('/register', { email, password, name });\n        callbacks?.onLoginSuccess?.(data.user, 'email');\n        _internal?.handleLoginSuccess(data.user, data.tokens);\n        resetRateLimit(); // Reset on successful registration\n\n        // Auto-enroll embedded wallet in background (don't block registration)\n        // Uses password for Share A encryption. Recovery phrase can be retrieved later.\n        // UI-09: In cookie mode the accessToken is absent; add a short delay to allow\n        // the session cookie to be written before the enroll request is sent.\n        if (walletEnrollmentEnabled) {\n          const accessToken = data.tokens?.accessToken ?? '';\n          const isCookieMode = !accessToken;\n          const enrollDelay = isCookieMode ? 200 : 0;\n          void new Promise<void>((resolve) => setTimeout(resolve, enrollDelay))\n            .then(() => import('../utils/silentWalletEnroll'))\n            .then(({ silentWalletEnroll }) =>\n              silentWalletEnroll({\n                password,\n                serverUrl,\n                accessToken,\n              })\n            )\n            .then((result) => {\n              if (!result.success) {\n                // Log auto-enrollment failures for debugging\n                console.warn('[useEmailAuth] Wallet auto-enrollment failed:', result.error);\n              }\n            })\n            .catch((err) => {\n              const message = err instanceof Error ? err.message : 'Unknown error';\n              // Log enrollment errors for debugging\n              console.warn('[useEmailAuth] Wallet auto-enrollment unavailable:', message);\n            });\n        }\n\n        return data;\n      } catch (err) {\n        const authError = handleApiError(err, 'Registration failed');\n        setError(authError);\n        throw authError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [\n      apiClient,\n      callbacks,\n      _internal,\n      checkLimit,\n      resetRateLimit,\n      serverUrl,\n      walletEnrollmentEnabled,\n    ]\n  );\n\n  const clearError = useCallback(() => setError(null), []);\n\n  return {\n    login,\n    register,\n    isLoading,\n    error,\n    clearError,\n    // M-10: Point-in-time snapshots for UI display (see interface JSDoc)\n    remainingAttempts: getRemainingAttempts(),\n    timeUntilReset: getTimeUntilReset(),\n  };\n}\n","import { useState, useCallback, useMemo } from 'react';\nimport { useCedrosLogin } from '../context/useCedrosLogin';\nimport { validateEmail } from '../utils/validation';\nimport { useRateLimiter } from './useRateLimiter';\nimport { ApiClient, handleApiError } from '../utils/apiClient';\nimport type { AuthError, AuthResponse, MfaRequiredResponse } from '../types';\n\nfunction isMfaRequiredResponse(data: unknown): data is MfaRequiredResponse {\n  return (\n    typeof data === 'object' &&\n    data !== null &&\n    'mfaRequired' in data &&\n    (data as { mfaRequired?: unknown }).mfaRequired === true\n  );\n}\n\nexport interface UseInstantLinkReturn {\n  /** Send an instant link email to the given address */\n  sendInstantLink: (email: string) => Promise<void>;\n  /** Verify an instant link token and sign in */\n  verifyInstantLink: (token: string) => Promise<AuthResponse | MfaRequiredResponse>;\n  /** Whether a request is in progress */\n  isLoading: boolean;\n  /** Whether the instant link was sent successfully */\n  isSuccess: boolean;\n  /** Error from the last request */\n  error: AuthError | null;\n  /** Clear the error state */\n  clearError: () => void;\n  /** Reset to initial state */\n  reset: () => void;\n  /** Number of remaining attempts before rate limiting */\n  remainingAttempts: number;\n}\n\n/**\n * Hook for instant link (passwordless) authentication.\n *\n * Sends an instant link email that allows the user to sign in\n * without entering their password.\n *\n * @example\n * ```tsx\n * function InstantLinkForm() {\n *   const { sendInstantLink, isLoading, isSuccess, error } = useInstantLink();\n *\n *   const handleSubmit = async (e) => {\n *     e.preventDefault();\n *     await sendInstantLink(email);\n *   };\n *\n *   if (isSuccess) {\n *     return <p>Check your email for the sign-in link</p>;\n *   }\n * }\n * ```\n */\nexport function useInstantLink(): UseInstantLinkReturn {\n  const { config, _internal } = useCedrosLogin();\n  const [isLoading, setIsLoading] = useState(false);\n  const [isSuccess, setIsSuccess] = useState(false);\n  const [error, setError] = useState<AuthError | null>(null);\n\n  const apiClient = useMemo(\n    () =>\n      new ApiClient({\n        baseUrl: config.serverUrl,\n        timeoutMs: config.requestTimeout,\n        retryAttempts: config.retryAttempts,\n      }),\n    [config.serverUrl, config.requestTimeout, config.retryAttempts]\n  );\n\n  // Rate limiter for instant link attempts (3 attempts per 5 minutes)\n  const { checkLimit, getRemainingAttempts } = useRateLimiter({\n    maxAttempts: 3,\n    windowMs: 300000,\n  });\n\n  const sendInstantLink = useCallback(\n    async (email: string): Promise<void> => {\n      // Validate email format before API call\n      if (!validateEmail(email)) {\n        const validationError: AuthError = {\n          code: 'VALIDATION_ERROR',\n          message: 'Please enter a valid email address',\n        };\n        setError(validationError);\n        throw validationError;\n      }\n\n      // Check rate limit before API call\n      try {\n        checkLimit();\n      } catch (err) {\n        const rateLimitError: AuthError = {\n          code: 'RATE_LIMITED',\n          message: err instanceof Error ? err.message : 'Too many attempts',\n        };\n        setError(rateLimitError);\n        throw rateLimitError;\n      }\n\n      setIsLoading(true);\n      setError(null);\n      setIsSuccess(false);\n\n      try {\n        await apiClient.post('/instant-link', { email });\n        setIsSuccess(true);\n      } catch (err) {\n        const authError = handleApiError(err, 'Failed to send sign-in link');\n        setError(authError);\n        throw authError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [apiClient, checkLimit]\n  );\n\n  const verifyInstantLink = useCallback(\n    async (token: string): Promise<AuthResponse | MfaRequiredResponse> => {\n      if (!token || token.trim().length === 0) {\n        const validationError: AuthError = {\n          code: 'VALIDATION_ERROR',\n          message: 'Invalid or missing sign-in link token',\n        };\n        setError(validationError);\n        throw validationError;\n      }\n\n      setIsLoading(true);\n      setError(null);\n      setIsSuccess(false);\n\n      try {\n        const data = await apiClient.post<AuthResponse | MfaRequiredResponse>(\n          '/instant-link/verify',\n          {\n            token,\n          }\n        );\n\n        if (isMfaRequiredResponse(data)) {\n          return data;\n        }\n\n        // Successful login\n        config.callbacks?.onLoginSuccess?.(data.user, 'email');\n        _internal?.handleLoginSuccess(data.user, data.tokens);\n        return data;\n      } catch (err) {\n        const authError = handleApiError(err, 'Failed to verify sign-in link');\n        setError(authError);\n        throw authError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [apiClient, config.callbacks, _internal]\n  );\n\n  const clearError = useCallback(() => setError(null), []);\n\n  const reset = useCallback(() => {\n    setError(null);\n    setIsSuccess(false);\n    setIsLoading(false);\n  }, []);\n\n  return {\n    sendInstantLink,\n    verifyInstantLink,\n    isLoading,\n    isSuccess,\n    error,\n    clearError,\n    reset,\n    remainingAttempts: getRemainingAttempts(),\n  };\n}\n","import { useState, useId, type InputHTMLAttributes } from 'react';\nimport { validatePassword } from '../../utils/validation';\nimport type { PasswordValidation } from '../../types';\n\nexport interface PasswordInputProps extends Omit<InputHTMLAttributes<HTMLInputElement>, 'type'> {\n  label?: string;\n  /** Action element shown on the right side of the label (e.g., \"Forgot password?\" link) */\n  labelAction?: React.ReactNode;\n  showStrengthMeter?: boolean;\n  onValidationChange?: (validation: PasswordValidation) => void;\n  error?: string;\n}\n\n/**\n * Password input with visibility toggle and optional strength meter\n */\nexport function PasswordInput({\n  label = 'Password',\n  labelAction,\n  showStrengthMeter = false,\n  onValidationChange,\n  error,\n  className = '',\n  onChange,\n  value,\n  ...props\n}: PasswordInputProps) {\n  const [showPassword, setShowPassword] = useState(false);\n  const [validation, setValidation] = useState<PasswordValidation | null>(null);\n  const inputId = useId();\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const newValue = e.target.value;\n\n    if (showStrengthMeter || onValidationChange) {\n      const newValidation = validatePassword(newValue);\n      setValidation(newValidation);\n      onValidationChange?.(newValidation);\n    }\n\n    onChange?.(e);\n  };\n\n  const strengthColors = {\n    weak: 'var(--cedros-destructive, #ef4444)',\n    fair: 'var(--cedros-warning, #f59e0b)',\n    good: 'var(--cedros-success, #22c55e)',\n    strong: 'var(--cedros-success, #22c55e)',\n  };\n\n  return (\n    <div className={`cedros-password-input ${className}`}>\n      <div className=\"cedros-label-row\">\n        <label htmlFor={inputId} className=\"cedros-label\">\n          {label}\n        </label>\n        {labelAction}\n      </div>\n      <div className=\"cedros-password-wrapper\">\n        <input\n          id={inputId}\n          type={showPassword ? 'text' : 'password'}\n          className=\"cedros-input\"\n          onChange={handleChange}\n          value={value}\n          aria-invalid={error ? 'true' : undefined}\n          aria-describedby={error ? `${inputId}-error` : undefined}\n          {...props}\n        />\n        <button\n          type=\"button\"\n          className=\"cedros-password-toggle\"\n          onClick={() => setShowPassword(!showPassword)}\n          aria-label={showPassword ? 'Hide password' : 'Show password'}\n          aria-pressed={showPassword}\n        >\n          {showPassword ? (\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" aria-hidden=\"true\">\n              <path\n                d=\"M2.5 10s3-6 7.5-6 7.5 6 7.5 6-3 6-7.5 6-7.5-6-7.5-6z\"\n                stroke=\"currentColor\"\n                strokeWidth=\"1.5\"\n              />\n              <circle cx=\"10\" cy=\"10\" r=\"2.5\" stroke=\"currentColor\" strokeWidth=\"1.5\" />\n              <path d=\"M3 17L17 3\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" />\n            </svg>\n          ) : (\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" aria-hidden=\"true\">\n              <path\n                d=\"M2.5 10s3-6 7.5-6 7.5 6 7.5 6-3 6-7.5 6-7.5-6-7.5-6z\"\n                stroke=\"currentColor\"\n                strokeWidth=\"1.5\"\n              />\n              <circle cx=\"10\" cy=\"10\" r=\"2.5\" stroke=\"currentColor\" strokeWidth=\"1.5\" />\n            </svg>\n          )}\n        </button>\n      </div>\n\n      {error && (\n        <p id={`${inputId}-error`} className=\"cedros-input-error\">\n          {error}\n        </p>\n      )}\n\n      {showStrengthMeter && validation && (value as string)?.length > 0 && (\n        <div className=\"cedros-password-strength\">\n          <div className=\"cedros-strength-bar\">\n            <div\n              className=\"cedros-strength-fill\"\n              style={{\n                width: `${\n                  validation.strength === 'weak'\n                    ? 25\n                    : validation.strength === 'fair'\n                      ? 50\n                      : validation.strength === 'good'\n                        ? 75\n                        : 100\n                }%`,\n                backgroundColor: strengthColors[validation.strength],\n              }}\n            />\n          </div>\n          <span className=\"cedros-strength-label\">{validation.strength}</span>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useCallback, useMemo } from 'react';\nimport { useCedrosLogin } from '../context/useCedrosLogin';\nimport { ApiClient, handleApiError } from '../utils/apiClient';\nimport { useRateLimiter } from './useRateLimiter';\nimport type { AuthError, AuthResponse, TotpVerifyState } from '../types';\n\nexport interface UseTotpVerifyReturn {\n  /** Verification state */\n  state: TotpVerifyState;\n  /** Whether verification is in progress */\n  isLoading: boolean;\n  /** Error from the last request */\n  error: AuthError | null;\n  /** Verify MFA code during login */\n  verifyTotp: (mfaToken: string, code: string) => Promise<AuthResponse>;\n  /** Clear error state */\n  clearError: () => void;\n  /** Reset to initial state */\n  reset: () => void;\n  /** Number of remaining verification attempts before rate limiting */\n  remainingAttempts: number;\n  /** Time in ms until rate limit resets (0 if not rate limited) */\n  timeUntilReset: number;\n}\n\n/**\n * Hook for verifying TOTP codes during the login flow.\n *\n * Used when a user has TOTP enabled and needs to provide\n * their 6-digit code after password authentication.\n *\n * @example\n * ```tsx\n * function TotpVerifyStep({ mfaToken }) {\n *   const { verifyTotp, isLoading, error } = useTotpVerify();\n *\n *   const handleVerify = async (code: string) => {\n *     const response = await verifyTotp(mfaToken, code);\n *     // User is now authenticated\n *   };\n * }\n * ```\n */\nexport function useTotpVerify(): UseTotpVerifyReturn {\n  const { config, _internal } = useCedrosLogin();\n  const [state, setState] = useState<TotpVerifyState>('idle');\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<AuthError | null>(null);\n\n  // Rate limiter for TOTP verification (5 attempts per 2 minutes)\n  // Stricter than login to prevent brute force on short codes\n  const {\n    checkLimit,\n    getRemainingAttempts,\n    getTimeUntilReset,\n    reset: resetRateLimit,\n  } = useRateLimiter({ maxAttempts: 5, windowMs: 120000 });\n\n  const apiClient = useMemo(\n    () =>\n      new ApiClient({\n        baseUrl: config.serverUrl,\n        timeoutMs: config.requestTimeout,\n        retryAttempts: config.retryAttempts,\n      }),\n    [config.serverUrl, config.requestTimeout, config.retryAttempts]\n  );\n\n  const verifyTotp = useCallback(\n    async (mfaToken: string, code: string): Promise<AuthResponse> => {\n      // Validate code format (6 digits or recovery code)\n      const isRecoveryCode =\n        /^[A-Z0-9]{16}$/i.test(code) || /^[A-Z0-9]{4}(-[A-Z0-9]{4}){3}$/i.test(code);\n      const isValidCode = /^\\d{6}$/.test(code) || isRecoveryCode;\n      if (!isValidCode) {\n        const validationError: AuthError = {\n          code: 'VALIDATION_ERROR',\n          message: 'Please enter a valid 6-digit code or recovery code',\n        };\n        setError(validationError);\n        throw validationError;\n      }\n\n      // Rate limit check before API call to prevent brute force\n      try {\n        checkLimit();\n      } catch (err) {\n        const rateLimitError: AuthError = {\n          code: 'RATE_LIMITED',\n          message: err instanceof Error ? err.message : 'Too many attempts',\n        };\n        setError(rateLimitError);\n        throw rateLimitError;\n      }\n\n      setIsLoading(true);\n      setError(null);\n      setState('verifying');\n\n      try {\n        const response = await apiClient.post<AuthResponse>('/login/mfa', { mfaToken, code });\n\n        setState('success');\n        resetRateLimit(); // Reset on successful verification\n\n        // Complete authentication via internal API\n        if (_internal && response.user && response.tokens) {\n          _internal.handleLoginSuccess(response.user, response.tokens);\n        }\n\n        return response;\n      } catch (err) {\n        const authError = handleApiError(err, 'Invalid verification code');\n        setError(authError);\n        setState('error');\n        throw authError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [apiClient, _internal, checkLimit, resetRateLimit]\n  );\n\n  const clearError = useCallback(() => setError(null), []);\n\n  const reset = useCallback(() => {\n    setError(null);\n    setState('idle');\n    setIsLoading(false);\n  }, []);\n\n  return {\n    state,\n    isLoading,\n    error,\n    verifyTotp,\n    clearError,\n    reset,\n    // Point-in-time snapshots for UI display\n    remainingAttempts: getRemainingAttempts(),\n    timeUntilReset: getTimeUntilReset(),\n  };\n}\n","/**\n * OTP Input component (shadcn-style)\n *\n * A 6-digit input with separate boxes for each digit,\n * designed for TOTP verification codes.\n */\n\nimport { useRef, useCallback, useState, useEffect, useId } from 'react';\n\n/** Number of OTP digits */\nconst OTP_LENGTH = 6;\n\nexport interface OtpInputProps {\n  /** Current value (up to 6 digits) */\n  value?: string;\n  /** Called when the value changes */\n  onChange?: (value: string) => void;\n  /** Called when all 6 digits are entered */\n  onComplete?: (value: string) => void;\n  /** Whether the input is disabled */\n  disabled?: boolean;\n  /** Error message to display */\n  error?: string;\n  /** Auto-focus the first input on mount */\n  autoFocus?: boolean;\n  /** Additional CSS class */\n  className?: string;\n}\n\n/**\n * OTP input with separate boxes for each digit (shadcn pattern)\n *\n * Features:\n * - Auto-advances to next input on digit entry\n * - Backspace moves to previous input\n * - Supports paste of full code\n * - Numeric keyboard on mobile\n */\nexport function OtpInput({\n  value = '',\n  onChange,\n  onComplete,\n  disabled = false,\n  error,\n  autoFocus = false,\n  className = '',\n}: OtpInputProps) {\n  const inputRefs = useRef<(HTMLInputElement | null)[]>([]);\n  const [localValue, setLocalValue] = useState(value.padEnd(OTP_LENGTH, ''));\n  const id = useId();\n\n  // Sync with controlled value\n  useEffect(() => {\n    setLocalValue(value.padEnd(OTP_LENGTH, ''));\n  }, [value]);\n\n  const focusInput = useCallback((index: number) => {\n    if (index >= 0 && index < OTP_LENGTH) {\n      inputRefs.current[index]?.focus();\n    }\n  }, []);\n\n  const updateValue = useCallback(\n    (newValue: string) => {\n      const sanitized = newValue.replace(/\\D/g, '').slice(0, OTP_LENGTH);\n      setLocalValue(sanitized.padEnd(OTP_LENGTH, ''));\n      onChange?.(sanitized);\n\n      if (sanitized.length === OTP_LENGTH) {\n        onComplete?.(sanitized);\n      }\n    },\n    [onChange, onComplete]\n  );\n\n  const handleChange = useCallback(\n    (index: number, digit: string) => {\n      if (!/^\\d?$/.test(digit)) return;\n\n      const chars = localValue.split('');\n      chars[index] = digit;\n      const newValue = chars.join('').replace(/ /g, '');\n      updateValue(newValue);\n\n      // Move to next input if digit entered\n      if (digit && index < OTP_LENGTH - 1) {\n        focusInput(index + 1);\n      }\n    },\n    [localValue, updateValue, focusInput]\n  );\n\n  const handleKeyDown = useCallback(\n    (index: number, e: React.KeyboardEvent<HTMLInputElement>) => {\n      if (e.key === 'Backspace') {\n        e.preventDefault();\n        const chars = localValue.split('');\n\n        if (chars[index] && chars[index] !== ' ') {\n          // Clear current digit\n          chars[index] = ' ';\n          updateValue(chars.join('').replace(/ /g, ''));\n        } else if (index > 0) {\n          // Move to previous and clear it\n          chars[index - 1] = ' ';\n          updateValue(chars.join('').replace(/ /g, ''));\n          focusInput(index - 1);\n        }\n      } else if (e.key === 'ArrowLeft' && index > 0) {\n        e.preventDefault();\n        focusInput(index - 1);\n      } else if (e.key === 'ArrowRight' && index < OTP_LENGTH - 1) {\n        e.preventDefault();\n        focusInput(index + 1);\n      }\n    },\n    [localValue, updateValue, focusInput]\n  );\n\n  const handlePaste = useCallback(\n    (e: React.ClipboardEvent) => {\n      e.preventDefault();\n      const pasted = e.clipboardData.getData('text');\n      const digits = pasted.replace(/\\D/g, '').slice(0, OTP_LENGTH);\n      if (digits) {\n        updateValue(digits);\n        // Focus the next empty slot or the last one\n        focusInput(Math.min(digits.length, OTP_LENGTH - 1));\n      }\n    },\n    [updateValue, focusInput]\n  );\n\n  const handleFocus = useCallback((e: React.FocusEvent<HTMLInputElement>) => {\n    e.target.select();\n  }, []);\n\n  // Auto-focus first input\n  useEffect(() => {\n    if (autoFocus && !disabled) {\n      inputRefs.current[0]?.focus();\n    }\n  }, [autoFocus, disabled]);\n\n  return (\n    <div className={`cedros-otp-input ${className}`}>\n      <div className=\"cedros-otp-slots\" role=\"group\" aria-label=\"One-time password\">\n        {Array.from({ length: OTP_LENGTH }).map((_, index) => (\n          <input\n            key={index}\n            ref={(el) => {\n              inputRefs.current[index] = el;\n            }}\n            id={`${id}-${index}`}\n            type=\"text\"\n            inputMode=\"numeric\"\n            pattern=\"[0-9]*\"\n            maxLength={1}\n            className={`cedros-otp-slot ${error ? 'cedros-otp-slot-error' : ''}`}\n            value={localValue[index] === ' ' ? '' : localValue[index] || ''}\n            onChange={(e) => handleChange(index, e.target.value)}\n            onKeyDown={(e) => handleKeyDown(index, e)}\n            onPaste={handlePaste}\n            onFocus={handleFocus}\n            disabled={disabled}\n            autoComplete=\"one-time-code\"\n            aria-label={`Digit ${index + 1}`}\n            aria-invalid={error ? 'true' : undefined}\n          />\n        ))}\n      </div>\n      {error && (\n        <p className=\"cedros-otp-error\" role=\"alert\">\n          {error}\n        </p>\n      )}\n    </div>\n  );\n}\n","/**\n * TOTP Verification component for login flow\n *\n * Displayed when a user with 2FA enabled needs to\n * enter their verification code to complete login.\n */\n\nimport { useState } from 'react';\nimport { useTotpVerify } from '../../hooks/useTotpVerify';\nimport { OtpInput } from './OtpInput';\nimport { LoadingSpinner } from '../shared/LoadingSpinner';\n\nexport interface TotpVerifyProps {\n  /** Temporary token from password authentication */\n  mfaToken: string;\n  /** Email address (for display) */\n  email?: string;\n  /** Called when verification succeeds */\n  onSuccess?: () => void;\n  /** Called when user wants to go back */\n  onBack?: () => void;\n  /** Additional CSS class */\n  className?: string;\n}\n\n/**\n * Two-factor authentication verification for login.\n *\n * Accepts 6-digit codes from authenticator apps\n * or recovery codes for account recovery.\n */\nexport function TotpVerify({\n  mfaToken,\n  email,\n  onSuccess,\n  onBack,\n  className = '',\n}: TotpVerifyProps) {\n  const { verifyTotp, isLoading, error, clearError } = useTotpVerify();\n  const [code, setCode] = useState('');\n  const [useBackupCode, setUseBackupCode] = useState(false);\n  const [backupCode, setBackupCode] = useState('');\n\n  const handleVerify = async (verifyCode?: string) => {\n    const codeToVerify = verifyCode || (useBackupCode ? backupCode : code);\n    if (!codeToVerify) return;\n\n    try {\n      await verifyTotp(mfaToken, codeToVerify);\n      onSuccess?.();\n    } catch {\n      // Error handled by hook, clear the input\n      if (useBackupCode) {\n        setBackupCode('');\n      } else {\n        setCode('');\n      }\n    }\n  };\n\n  const handleOtpComplete = (value: string) => {\n    handleVerify(value);\n  };\n\n  const toggleBackupCode = () => {\n    setUseBackupCode(!useBackupCode);\n    clearError();\n    setCode('');\n    setBackupCode('');\n  };\n\n  return (\n    <div className={`cedros-totp-verify ${className}`}>\n      <div className=\"cedros-totp-verify-header\">\n        <svg\n          className=\"cedros-totp-verify-icon\"\n          width=\"48\"\n          height=\"48\"\n          viewBox=\"0 0 48 48\"\n          fill=\"none\"\n          aria-hidden=\"true\"\n        >\n          <rect x=\"8\" y=\"20\" width=\"32\" height=\"24\" rx=\"4\" stroke=\"currentColor\" strokeWidth=\"2\" />\n          <path\n            d=\"M16 20V14a8 8 0 1 1 16 0v6\"\n            stroke=\"currentColor\"\n            strokeWidth=\"2\"\n            strokeLinecap=\"round\"\n          />\n          <circle cx=\"24\" cy=\"32\" r=\"3\" fill=\"currentColor\" />\n        </svg>\n        <h3 className=\"cedros-totp-title\">Two-factor authentication</h3>\n        <p className=\"cedros-totp-description\">\n          {useBackupCode\n            ? 'Enter one of your recovery codes to sign in.'\n            : 'Enter the 6-digit code from your authenticator app.'}\n        </p>\n        {email && <p className=\"cedros-totp-email\">{email}</p>}\n      </div>\n\n      {useBackupCode ? (\n        <div className=\"cedros-totp-backup-input\">\n          <input\n            type=\"text\"\n            className={`cedros-input ${error ? 'cedros-input-error' : ''}`}\n            placeholder=\"Enter recovery code\"\n            value={backupCode}\n            onChange={(e) => {\n              setBackupCode(e.target.value.toUpperCase());\n              clearError();\n            }}\n            onKeyDown={(e) => {\n              if (e.key === 'Enter' && backupCode) {\n                handleVerify();\n              }\n            }}\n            disabled={isLoading}\n            autoFocus\n            autoComplete=\"one-time-code\"\n          />\n          {error && (\n            <p className=\"cedros-input-error\" role=\"alert\">\n              {error.message}\n            </p>\n          )}\n        </div>\n      ) : (\n        <OtpInput\n          value={code}\n          onChange={(value) => {\n            setCode(value);\n            clearError();\n          }}\n          onComplete={handleOtpComplete}\n          disabled={isLoading}\n          error={error?.message}\n          autoFocus\n        />\n      )}\n\n      <button\n        type=\"button\"\n        className=\"cedros-button cedros-button-primary cedros-button-md cedros-button-full\"\n        onClick={() => handleVerify()}\n        disabled={isLoading || (useBackupCode ? !backupCode : code.length !== 6)}\n      >\n        {isLoading ? (\n          <>\n            <LoadingSpinner size=\"sm\" />\n            <span>Verifying...</span>\n          </>\n        ) : (\n          'Verify'\n        )}\n      </button>\n\n      <div className=\"cedros-totp-verify-footer\">\n        <button\n          type=\"button\"\n          className=\"cedros-link cedros-link-sm\"\n          onClick={toggleBackupCode}\n          disabled={isLoading}\n        >\n          {useBackupCode ? 'Use authenticator app' : 'Use a recovery code'}\n        </button>\n\n        {onBack && (\n          <>\n            <span className=\"cedros-totp-verify-divider\">â€¢</span>\n            <button\n              type=\"button\"\n              className=\"cedros-link cedros-link-sm\"\n              onClick={onBack}\n              disabled={isLoading}\n            >\n              Back to login\n            </button>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n","import { useState, type FormEvent } from 'react';\nimport { useCedrosLogin } from '../../context/useCedrosLogin';\nimport { useEmailAuth } from '../../hooks/useEmailAuth';\nimport { useInstantLink } from '../../hooks/useInstantLink';\nimport { PasswordInput } from './PasswordInput';\nimport { LoadingSpinner } from '../shared/LoadingSpinner';\nimport { ErrorMessage } from '../shared/ErrorMessage';\nimport { TotpVerify } from '../totp/TotpVerify';\n// COMP-01: Email validation now handled by useInstantLink hook internally\n\nexport interface EmailLoginFormProps {\n  onSuccess?: () => void;\n  onSwitchToRegister?: () => void;\n  /** Called when user clicks \"Forgot password?\" (only in 'reset' mode) */\n  onForgotPassword?: () => void;\n  className?: string;\n}\n\n/**\n * Email/password login form\n */\nexport function EmailLoginForm({\n  onSuccess,\n  onSwitchToRegister,\n  onForgotPassword,\n  className = '',\n}: EmailLoginFormProps) {\n  const { config } = useCedrosLogin();\n  const { login, isLoading, error, clearError } = useEmailAuth();\n  const {\n    sendInstantLink,\n    isLoading: isInstantLinkLoading,\n    isSuccess: isInstantLinkSuccess,\n    error: instantLinkError,\n    clearError: clearInstantLinkError,\n    reset: resetInstantLink,\n  } = useInstantLink();\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  // MFA state for 2FA flow\n  const [mfaToken, setMfaToken] = useState<string | null>(null);\n  const [mfaEmail, setMfaEmail] = useState<string>('');\n\n  const forgotPasswordMode = config.forms?.forgotPassword?.mode ?? 'reset';\n\n  const handleSubmit = async (e: FormEvent) => {\n    e.preventDefault();\n    try {\n      const result = await login(email, password);\n      if (result.mfaRequired) {\n        // MFA verification needed\n        setMfaToken(result.mfaToken);\n        setMfaEmail(result.email);\n      } else {\n        // Login successful\n        onSuccess?.();\n      }\n    } catch {\n      // Error is handled by the hook\n    }\n  };\n\n  const handleTotpSuccess = () => {\n    setMfaToken(null);\n    setMfaEmail('');\n    onSuccess?.();\n  };\n\n  const handleTotpBack = () => {\n    setMfaToken(null);\n    setMfaEmail('');\n    setPassword(''); // Clear password for security\n  };\n\n  const handleForgotPassword = async () => {\n    if (forgotPasswordMode === 'instantLink') {\n      // COMP-01: In instant link mode, call sendInstantLink directly.\n      // The hook validates email and sets error state if invalid.\n      try {\n        await sendInstantLink(email);\n      } catch {\n        // Error handled by hook's error state\n      }\n    } else {\n      // In reset mode, call the callback\n      onForgotPassword?.();\n    }\n  };\n\n  // Show TOTP verification step\n  if (mfaToken) {\n    return (\n      <TotpVerify\n        mfaToken={mfaToken}\n        email={mfaEmail}\n        onSuccess={handleTotpSuccess}\n        onBack={handleTotpBack}\n        className={className}\n      />\n    );\n  }\n\n  // Show instant link success state\n  if (isInstantLinkSuccess) {\n    return (\n      <div className={`cedros-instant-link-success ${className}`}>\n        <svg\n          className=\"cedros-success-icon\"\n          width=\"48\"\n          height=\"48\"\n          viewBox=\"0 0 48 48\"\n          fill=\"none\"\n          aria-hidden=\"true\"\n        >\n          <circle cx=\"24\" cy=\"24\" r=\"22\" stroke=\"currentColor\" strokeWidth=\"2\" />\n          <path\n            d=\"M14 24l7 7 13-13\"\n            stroke=\"currentColor\"\n            strokeWidth=\"2\"\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n          />\n        </svg>\n        <h3 className=\"cedros-success-title\">Check your email</h3>\n        <p className=\"cedros-success-message\">\n          We sent a sign-in link to <strong>{email}</strong>. Click the link to sign in.\n        </p>\n        <button\n          type=\"button\"\n          className=\"cedros-button cedros-button-md cedros-button-outline\"\n          onClick={resetInstantLink}\n        >\n          Back to login\n        </button>\n      </div>\n    );\n  }\n\n  const combinedError = error || instantLinkError;\n  const combinedClearError = () => {\n    clearError();\n    clearInstantLinkError();\n  };\n  const isAnyLoading = isLoading || isInstantLinkLoading;\n\n  return (\n    <form onSubmit={handleSubmit} className={`cedros-form ${className}`}>\n      <div className=\"cedros-form-field\">\n        <label htmlFor=\"email\" className=\"cedros-label\">\n          Email\n        </label>\n        <input\n          id=\"email\"\n          type=\"email\"\n          className=\"cedros-input\"\n          value={email}\n          onChange={(e) => setEmail(e.target.value)}\n          placeholder=\"you@example.com\"\n          required\n          aria-required=\"true\"\n          autoComplete=\"email\"\n          disabled={isAnyLoading}\n        />\n      </div>\n\n      <div className=\"cedros-form-field\">\n        <PasswordInput\n          value={password}\n          onChange={(e) => setPassword(e.target.value)}\n          placeholder=\"Enter your password\"\n          required\n          autoComplete=\"current-password\"\n          disabled={isAnyLoading}\n          labelAction={\n            onForgotPassword || forgotPasswordMode === 'instantLink' ? (\n              <button\n                type=\"button\"\n                className=\"cedros-link cedros-link-sm\"\n                onClick={handleForgotPassword}\n                disabled={isInstantLinkLoading}\n              >\n                {isInstantLinkLoading ? 'Sending...' : 'Forgot your password?'}\n              </button>\n            ) : undefined\n          }\n        />\n      </div>\n\n      <ErrorMessage error={combinedError} onDismiss={combinedClearError} />\n\n      <button\n        type=\"submit\"\n        className=\"cedros-button cedros-button-primary cedros-button-md cedros-button-full\"\n        disabled={isAnyLoading || !email || !password}\n        aria-busy={isLoading}\n      >\n        {isLoading ? (\n          <>\n            <LoadingSpinner size=\"sm\" announce label=\"Signing in\" />\n            <span>Signing in...</span>\n          </>\n        ) : (\n          'Sign in'\n        )}\n      </button>\n\n      {onSwitchToRegister && (\n        <p className=\"cedros-form-footer\">\n          Don&apos;t have an account?{' '}\n          <button type=\"button\" className=\"cedros-link\" onClick={onSwitchToRegister}>\n            Sign up\n          </button>\n        </p>\n      )}\n    </form>\n  );\n}\n","import { useState, type FormEvent } from 'react';\nimport { useCedrosLogin } from '../../context/useCedrosLogin';\nimport { useEmailAuth } from '../../hooks/useEmailAuth';\nimport { PasswordInput } from './PasswordInput';\nimport { LoadingSpinner } from '../shared/LoadingSpinner';\nimport { ErrorMessage } from '../shared/ErrorMessage';\nimport { sanitizeExternalUrl } from '../../utils/sanitization';\nimport type { PasswordValidation, AuthError } from '../../types';\n\nexport interface EmailRegisterFormProps {\n  onSuccess?: () => void;\n  onSwitchToLogin?: () => void;\n  className?: string;\n}\n\n/** Values collected from the registration form (for callback) */\nexport interface RegistrationData {\n  termsAccepted: boolean;\n  emailOptIn: boolean;\n}\n\n/**\n * Email/password registration form\n */\nexport function EmailRegisterForm({\n  onSuccess,\n  onSwitchToLogin,\n  className = '',\n}: EmailRegisterFormProps) {\n  const { config } = useCedrosLogin();\n  const { register, isLoading, error, clearError } = useEmailAuth();\n  const [name, setName] = useState('');\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [passwordValidation, setPasswordValidation] = useState<PasswordValidation | null>(null);\n  const [termsError, setTermsError] = useState<AuthError | null>(null);\n\n  // Get form configuration\n  const termsConfig = config.forms?.termsOfService;\n  const emailOptInConfig = config.forms?.emailOptIn;\n\n  const showTerms = termsConfig?.show ?? false;\n  const termsRequired = termsConfig?.required ?? true;\n  const termsDefaultChecked = termsConfig?.defaultChecked ?? false;\n  const termsLabel = termsConfig?.label ?? 'I agree to the Terms of Service';\n  const termsUrl = termsConfig?.url;\n  const safeTermsUrl = sanitizeExternalUrl(termsUrl);\n\n  const showEmailOptIn = emailOptInConfig?.show ?? false;\n  const emailOptInDefaultChecked = emailOptInConfig?.defaultChecked ?? false;\n  const emailOptInLabel = emailOptInConfig?.label ?? 'Send me updates and news';\n\n  // Initialize checkbox states with defaults\n  const [termsAccepted, setTermsAccepted] = useState(termsDefaultChecked);\n  const [emailOptIn, setEmailOptIn] = useState(emailOptInDefaultChecked);\n\n  const passwordsMatch = password === confirmPassword;\n  const isPasswordValid = passwordValidation?.isValid ?? false;\n\n  // Terms must be accepted if shown and required\n  const termsValid = !showTerms || !termsRequired || termsAccepted;\n\n  const canSubmit =\n    email &&\n    password &&\n    confirmPassword &&\n    passwordsMatch &&\n    isPasswordValid &&\n    termsValid &&\n    !isLoading;\n\n  const handleSubmit = async (e: FormEvent) => {\n    e.preventDefault();\n\n    // Clear any previous terms error\n    setTermsError(null);\n\n    // Validate terms if required\n    if (showTerms && termsRequired && !termsAccepted) {\n      setTermsError({\n        code: 'VALIDATION_ERROR',\n        message: 'You must agree to the Terms of Service to continue',\n      });\n      return;\n    }\n\n    if (!canSubmit) return;\n\n    try {\n      // Note: termsAccepted and emailOptIn values can be passed to the backend\n      // via the register function if needed. For now, we call register with the\n      // standard params, but the backend could be extended to accept these values.\n      await register(email, password, name || undefined);\n      onSuccess?.();\n    } catch {\n      // Error is handled by the hook\n    }\n  };\n\n  const combinedError = error || termsError;\n  const combinedClearError = () => {\n    clearError();\n    setTermsError(null);\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className={`cedros-form ${className}`}>\n      <div className=\"cedros-form-field\">\n        <label htmlFor=\"name\" className=\"cedros-label\">\n          Name <span className=\"cedros-optional\">(optional)</span>\n        </label>\n        <input\n          id=\"name\"\n          type=\"text\"\n          className=\"cedros-input\"\n          value={name}\n          onChange={(e) => setName(e.target.value)}\n          placeholder=\"Your name\"\n          autoComplete=\"name\"\n          disabled={isLoading}\n        />\n      </div>\n\n      <div className=\"cedros-form-field\">\n        <label htmlFor=\"register-email\" className=\"cedros-label\">\n          Email\n        </label>\n        <input\n          id=\"register-email\"\n          type=\"email\"\n          className=\"cedros-input\"\n          value={email}\n          onChange={(e) => setEmail(e.target.value)}\n          placeholder=\"you@example.com\"\n          required\n          aria-required=\"true\"\n          autoComplete=\"email\"\n          disabled={isLoading}\n        />\n      </div>\n\n      <div className=\"cedros-form-field\">\n        <PasswordInput\n          value={password}\n          onChange={(e) => setPassword(e.target.value)}\n          placeholder=\"Create a password\"\n          required\n          autoComplete=\"new-password\"\n          disabled={isLoading}\n          showStrengthMeter\n          onValidationChange={setPasswordValidation}\n        />\n      </div>\n\n      <div className=\"cedros-form-field\">\n        <label htmlFor=\"confirm-password\" className=\"cedros-label\">\n          Confirm Password\n        </label>\n        <input\n          id=\"confirm-password\"\n          type=\"password\"\n          className=\"cedros-input\"\n          value={confirmPassword}\n          onChange={(e) => setConfirmPassword(e.target.value)}\n          placeholder=\"Confirm your password\"\n          required\n          aria-required=\"true\"\n          autoComplete=\"new-password\"\n          disabled={isLoading}\n          aria-invalid={confirmPassword && !passwordsMatch ? 'true' : undefined}\n          aria-describedby={\n            confirmPassword && !passwordsMatch ? 'confirm-password-error' : undefined\n          }\n        />\n        {confirmPassword && !passwordsMatch && (\n          <p id=\"confirm-password-error\" className=\"cedros-input-error\" role=\"alert\">\n            Passwords do not match\n          </p>\n        )}\n      </div>\n\n      {/* Terms of Service checkbox */}\n      {showTerms && (\n        <div className=\"cedros-form-field cedros-checkbox-field\">\n          <label className=\"cedros-checkbox-label\">\n            <input\n              type=\"checkbox\"\n              className=\"cedros-checkbox\"\n              checked={termsAccepted}\n              onChange={(e) => setTermsAccepted(e.target.checked)}\n              disabled={isLoading}\n              aria-required={termsRequired}\n            />\n            <span className=\"cedros-checkbox-text\">\n              {safeTermsUrl ? (\n                <>\n                  {termsLabel.replace('Terms of Service', '').trim() || 'I agree to the'}{' '}\n                  <a\n                    href={safeTermsUrl}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"cedros-link\"\n                  >\n                    Terms of Service\n                  </a>\n                </>\n              ) : (\n                termsLabel\n              )}\n              {termsRequired && <span className=\"cedros-required\">*</span>}\n            </span>\n          </label>\n        </div>\n      )}\n\n      {/* Email opt-in checkbox */}\n      {showEmailOptIn && (\n        <div className=\"cedros-form-field cedros-checkbox-field\">\n          <label className=\"cedros-checkbox-label\">\n            <input\n              type=\"checkbox\"\n              className=\"cedros-checkbox\"\n              checked={emailOptIn}\n              onChange={(e) => setEmailOptIn(e.target.checked)}\n              disabled={isLoading}\n            />\n            <span className=\"cedros-checkbox-text\">{emailOptInLabel}</span>\n          </label>\n        </div>\n      )}\n\n      <ErrorMessage error={combinedError} onDismiss={combinedClearError} />\n\n      <button\n        type=\"submit\"\n        className=\"cedros-button cedros-button-primary cedros-button-md cedros-button-full\"\n        disabled={!canSubmit}\n        aria-busy={isLoading}\n      >\n        {isLoading ? (\n          <>\n            <LoadingSpinner size=\"sm\" announce label=\"Creating account\" />\n            <span>Creating account...</span>\n          </>\n        ) : (\n          'Create account'\n        )}\n      </button>\n\n      {onSwitchToLogin && (\n        <p className=\"cedros-form-footer\">\n          Already have an account?{' '}\n          <button type=\"button\" className=\"cedros-link\" onClick={onSwitchToLogin}>\n            Sign in\n          </button>\n        </p>\n      )}\n    </form>\n  );\n}\n"],"names":["useRateLimiter","options","maxAttempts","windowMs","showCountdown","attemptsRef","useRef","hasAttempts","setHasAttempts","useState","setTick","bump","useCallback","value","cleanupAttemptsArray","now","timestamp","cleanupExpiredAttempts","current","getRemainingAttempts","getTimeUntilReset","resetTime","isAllowed","checkLimit","waitTime","waitSeconds","reset","useEffect","intervalId","isMfaRequiredResponse","response","useEmailAuth","config","_internal","useCedrosLogin","isLoading","setIsLoading","error","setError","resetRateLimit","apiClient","useMemo","ApiClient","callbacks","walletEnrollmentEnabled","serverUrl","login","email","password","validateEmail","validationError","err","rateLimitError","data","authResponse","authError","handleApiError","register","name","accessToken","enrollDelay","resolve","silentWalletEnroll","result","message","clearError","useInstantLink","isSuccess","setIsSuccess","sendInstantLink","verifyInstantLink","token","PasswordInput","label","labelAction","showStrengthMeter","onValidationChange","className","onChange","props","showPassword","setShowPassword","validation","setValidation","inputId","useId","handleChange","e","newValue","newValidation","validatePassword","strengthColors","jsxs","jsx","useTotpVerify","state","setState","verifyTotp","mfaToken","code","isRecoveryCode","OTP_LENGTH","OtpInput","onComplete","disabled","autoFocus","inputRefs","localValue","setLocalValue","id","focusInput","index","updateValue","sanitized","digit","chars","handleKeyDown","handlePaste","digits","handleFocus","_","el","TotpVerify","onSuccess","onBack","setCode","useBackupCode","setUseBackupCode","backupCode","setBackupCode","handleVerify","verifyCode","codeToVerify","handleOtpComplete","toggleBackupCode","Fragment","LoadingSpinner","EmailLoginForm","onSwitchToRegister","onForgotPassword","isInstantLinkLoading","isInstantLinkSuccess","instantLinkError","clearInstantLinkError","resetInstantLink","setEmail","setPassword","setMfaToken","mfaEmail","setMfaEmail","forgotPasswordMode","handleSubmit","handleTotpSuccess","handleTotpBack","handleForgotPassword","combinedError","combinedClearError","isAnyLoading","ErrorMessage","EmailRegisterForm","onSwitchToLogin","setName","confirmPassword","setConfirmPassword","passwordValidation","setPasswordValidation","termsError","setTermsError","termsConfig","emailOptInConfig","showTerms","termsRequired","termsDefaultChecked","termsLabel","termsUrl","safeTermsUrl","sanitizeExternalUrl","showEmailOptIn","emailOptInDefaultChecked","emailOptInLabel","termsAccepted","setTermsAccepted","emailOptIn","setEmailOptIn","passwordsMatch","isPasswordValid","canSubmit"],"mappings":"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"}