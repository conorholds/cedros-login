{"version":3,"file":"UsersSection-Dbh9PTSA.js","sources":["../src/admin/sections/UsersSection.tsx"],"sourcesContent":["/**\n * Users Section - Plugin wrapper\n *\n * Admin user management with list and detail views.\n */\n\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport type { AdminSectionProps } from '../types';\nimport { AdminUserList } from '../../components/admin/AdminUserList';\nimport { AdminUserDetail } from '../../components/admin/AdminUserDetail';\nimport { StatsBar } from '../../components/admin/StatsBar';\nimport { useAdminUsers } from '../../hooks/useAdminUsers';\nimport { useSystemSettings } from '../../hooks/useSystemSettings';\nimport type { AdminUser, AdminUserStatsResponse } from '../../types';\n\nconst METHOD_ORDER = ['email', 'google', 'apple', 'solana', 'webauthn', 'sso'] as const;\n\nconst METHOD_LABELS: Record<(typeof METHOD_ORDER)[number], string> = {\n  email: 'Email Users',\n  google: 'Google Users',\n  apple: 'Apple Users',\n  solana: 'Solana Users',\n  webauthn: 'Passkey Users',\n  sso: 'SSO Provider Users',\n};\n\nconst METHOD_SETTINGS: Record<(typeof METHOD_ORDER)[number], string> = {\n  email: 'auth_email_enabled',\n  google: 'auth_google_enabled',\n  apple: 'auth_apple_enabled',\n  solana: 'auth_solana_enabled',\n  webauthn: 'auth_webauthn_enabled',\n  sso: 'feature_sso',\n};\n\nfunction useUsersStats() {\n  const { getStats } = useAdminUsers();\n  const { fetchSettings, getValue } = useSystemSettings();\n  const [stats, setStats] = useState<AdminUserStatsResponse | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [settingsFetched, setSettingsFetched] = useState(false);\n\n  useEffect(() => {\n    if (!settingsFetched) {\n      fetchSettings();\n      setSettingsFetched(true);\n    }\n  }, [fetchSettings, settingsFetched]);\n\n  const isSettingEnabled = useCallback(\n    (key: string): boolean => {\n      const value = getValue(key);\n      if (value === undefined) return false;\n      return value === 'true' || value === '1';\n    },\n    [getValue]\n  );\n\n  const fetchStats = useCallback(async () => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const result = await getStats();\n      setStats(result);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to load user stats');\n    } finally {\n      setIsLoading(false);\n    }\n  }, [getStats]);\n\n  useEffect(() => {\n    fetchStats();\n  }, [fetchStats]);\n\n  const statsItems = useMemo(() => {\n    const items = [{ label: 'Total Users', value: stats?.total ?? 'â€”' }];\n\n    METHOD_ORDER.forEach((method) => {\n      if (!isSettingEnabled(METHOD_SETTINGS[method])) return;\n      items.push({\n        label: METHOD_LABELS[method],\n        value: stats?.authMethodCounts[method] ?? 0,\n      });\n    });\n\n    return items;\n  }, [stats, isSettingEnabled]);\n\n  return { statsItems, isLoading, error, refresh: fetchStats };\n}\n\nexport default function UsersSection({\n  pluginContext,\n  pageSize = 20,\n}: AdminSectionProps): React.JSX.Element {\n  const [selectedUser, setSelectedUser] = useState<AdminUser | null>(null);\n  const { statsItems, isLoading, error, refresh } = useUsersStats();\n\n  if (selectedUser) {\n    return (\n      <div className=\"cedros-dashboard__section\">\n        <AdminUserDetail\n          userId={selectedUser.id}\n          onBack={() => setSelectedUser(null)}\n          currentUserId={pluginContext.userId}\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"cedros-dashboard__section\">\n      <StatsBar stats={statsItems} isLoading={isLoading} onRefresh={refresh} />\n      {error && <p className=\"cedros-admin-error-inline\">{error}</p>}\n      <p className=\"cedros-dashboard__text-muted\">\n        All registered users in the system. Requires system admin privileges.\n      </p>\n      <AdminUserList\n        pageSize={pageSize}\n        currentUserId={pluginContext.userId}\n        onUserClick={(user) => setSelectedUser(user)}\n      />\n    </div>\n  );\n}\n"],"names":["METHOD_ORDER","METHOD_LABELS","METHOD_SETTINGS","useUsersStats","getStats","useAdminUsers","fetchSettings","getValue","useSystemSettings","stats","setStats","useState","isLoading","setIsLoading","error","setError","settingsFetched","setSettingsFetched","useEffect","isSettingEnabled","useCallback","key","value","fetchStats","result","err","useMemo","items","method","UsersSection","pluginContext","pageSize","selectedUser","setSelectedUser","statsItems","refresh","jsx","AdminUserDetail","jsxs","StatsBar","AdminUserList","user"],"mappings":"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"}