"use strict";const t=require("react/jsx-runtime"),a=require("react"),M=require("./useAdminDeposits-BkkCwHWp.cjs"),O=require("./StatsBar-DTUZCwDD.cjs");function q({refreshInterval:s=0,refreshSignal:r,className:p="",onLoad:h}){const{getStats:f,isLoading:v,error:j,clearError:w}=M.useAdminDeposits(),[d,D]=a.useState(null),[A,u]=a.useState(null),c=a.useCallback(async()=>{try{const i=await f();D(i),h?.(i),u(null)}catch(i){const N=i&&typeof i=="object"&&"message"in i?String(i.message):"Failed to load stats";u(N)}},[f,h]);a.useEffect(()=>{c()},[c]),a.useEffect(()=>{r!==void 0&&c()},[r,c]),a.useEffect(()=>{if(r!==void 0||s<=0)return;const i=setInterval(c,s);return()=>clearInterval(i)},[s,r,c]);const g=A||j;return g?t.jsxs("div",{className:`cedros-admin-stats cedros-admin-stats-error ${p}`,children:[t.jsx("p",{className:"cedros-admin-error",children:g}),t.jsx("button",{type:"button",className:"cedros-button cedros-button-outline",onClick:()=>{w(),u(null),c()},children:"Retry"})]}):v&&!d?t.jsxs("div",{className:`cedros-admin-stats cedros-admin-stats-loading ${p}`,children:[t.jsx("span",{className:"cedros-admin-loading-indicator"}),t.jsx("span",{className:"cedros-admin-loading-text",children:"Loading statistics..."})]}):d?t.jsx("div",{className:`cedros-admin-stats ${p}`,children:t.jsx(O.StatsBar,{stats:[{label:"Total Deposits",value:d.totalDeposits},{label:"Private Deposits",value:d.inPrivacyPeriodCount??0},{label:"Standard Deposits",value:d.readyForWithdrawalCount??0},{label:"Microdeposits",value:d.nativeSolDepositCount??0}],isLoading:v,onRefresh:c})}):null}function _(s){return{pending:"Pending",detected:"Detected",processing:"Processing",completed:"Completed",withdrawn:"Withdrawn",partially_withdrawn:"Partially Withdrawn",expired:"Expired",failed:"Failed"}[s]||s}function W(s){return s==="completed"||s==="withdrawn"||s==="partially_withdrawn"?"cedros-admin-deposit-success":s==="failed"||s==="expired"?"cedros-admin-deposit-error":s==="processing"||s==="detected"?"cedros-admin-deposit-processing":"cedros-admin-deposit-pending"}function B(s){return s==null?"—":`${(s/1e9).toFixed(4)} SOL`}function V(s){return new Date(s).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function I(s){return s.length<=12?s:`${s.slice(0,6)}...${s.slice(-4)}`}function K({statusFilter:s,pageSize:r=20,refreshInterval:p=0,refreshSignal:h,className:f="",onLoad:v,onDepositClick:j}){const{listDeposits:w,isLoading:d,error:D,clearError:A}=M.useAdminDeposits(),[u,c]=a.useState([]),[g,i]=a.useState(0),[N,k]=a.useState(0),[F,C]=a.useState(null),[n,R]=a.useState("createdAt"),[l,E]=a.useState("desc"),y=e=>{n===e?E(l==="asc"?"desc":"asc"):(R(e),E("desc"))},T=a.useMemo(()=>[...u].sort((e,o)=>{let x,b;switch(n){case"userId":x=e.userId.toLowerCase(),b=o.userId.toLowerCase();break;case"amountLamports":x=e.amountLamports??0,b=o.amountLamports??0;break;case"status":x=e.status,b=o.status;break;case"createdAt":x=new Date(e.createdAt).getTime(),b=new Date(o.createdAt).getTime();break;case"txSignature":x=e.txSignature||"",b=o.txSignature||"";break;default:return 0}return x<b?l==="asc"?-1:1:x>b?l==="asc"?1:-1:0}),[u,n,l]),m=a.useCallback(async()=>{try{const e=await w({status:s,limit:r,offset:N});c(e.deposits),i(e.total),v?.(e),C(null)}catch(e){const o=e&&typeof e=="object"&&"message"in e?String(e.message):"Failed to load deposits";C(o)}},[s,r,N,w,v]);a.useEffect(()=>{k(0)},[s,r]),a.useEffect(()=>{m()},[m]),a.useEffect(()=>{h!==void 0&&m()},[h,m]),a.useEffect(()=>{if(h!==void 0||p<=0)return;const e=setInterval(m,p);return()=>clearInterval(e)},[p,h,m]);const L=Math.ceil(g/r),S=Math.floor(N/r)+1,$=e=>{const o=(e-1)*r;k(Math.max(0,Math.min(o,Math.max(0,g-1))))},P=F||D;return P?t.jsxs("div",{className:`cedros-admin-deposit-list cedros-admin-deposit-list-error ${f}`,children:[t.jsx("p",{className:"cedros-admin-error",children:P}),t.jsx("button",{type:"button",className:"cedros-button cedros-button-outline",onClick:()=>{A(),C(null),m()},children:"Retry"})]}):d&&u.length===0?t.jsxs("div",{className:`cedros-admin-deposit-list cedros-admin-deposit-list-loading ${f}`,children:[t.jsx("span",{className:"cedros-admin-loading-indicator"}),t.jsx("span",{className:"cedros-admin-loading-text",children:"Loading deposits..."})]}):t.jsxs("div",{className:`cedros-admin-deposit-list ${f}`,children:[t.jsxs("div",{className:"cedros-admin-deposit-list-header",children:[t.jsx("h4",{className:"cedros-admin-deposit-list-title",children:"All Deposits"}),t.jsx("button",{type:"button",className:"cedros-admin__stats-bar-refresh",onClick:m,disabled:d,title:"Refresh deposits","aria-label":"Refresh deposits",children:d?"...":"↻"})]}),u.length===0?t.jsx("div",{className:"cedros-admin-empty",children:t.jsx("p",{className:"cedros-admin-empty-message",children:"No deposits found."})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"cedros-admin-deposit-table",children:[t.jsxs("div",{className:"cedros-admin-deposit-thead",children:[t.jsx("div",{className:"cedros-admin-deposit-th",children:t.jsxs("button",{type:"button",className:`cedros-admin-sort-button ${n==="userId"?"cedros-admin-sort-active":""}`,onClick:()=>y("userId"),"aria-label":"Sort by user",children:["User"," ",t.jsx("span",{className:"cedros-admin-sort-icon",children:n==="userId"?l==="asc"?"↑":"↓":"↕"})]})}),t.jsx("div",{className:"cedros-admin-deposit-th",children:t.jsxs("button",{type:"button",className:`cedros-admin-sort-button ${n==="amountLamports"?"cedros-admin-sort-active":""}`,onClick:()=>y("amountLamports"),"aria-label":"Sort by amount",children:["Amount"," ",t.jsx("span",{className:"cedros-admin-sort-icon",children:n==="amountLamports"?l==="asc"?"↑":"↓":"↕"})]})}),t.jsx("div",{className:"cedros-admin-deposit-th",children:t.jsxs("button",{type:"button",className:`cedros-admin-sort-button ${n==="status"?"cedros-admin-sort-active":""}`,onClick:()=>y("status"),"aria-label":"Sort by status",children:["Status"," ",t.jsx("span",{className:"cedros-admin-sort-icon",children:n==="status"?l==="asc"?"↑":"↓":"↕"})]})}),t.jsx("div",{className:"cedros-admin-deposit-th",children:t.jsxs("button",{type:"button",className:`cedros-admin-sort-button ${n==="createdAt"?"cedros-admin-sort-active":""}`,onClick:()=>y("createdAt"),"aria-label":"Sort by created",children:["Created"," ",t.jsx("span",{className:"cedros-admin-sort-icon",children:n==="createdAt"?l==="asc"?"↑":"↓":"↕"})]})}),t.jsx("div",{className:"cedros-admin-deposit-th",children:t.jsxs("button",{type:"button",className:`cedros-admin-sort-button ${n==="txSignature"?"cedros-admin-sort-active":""}`,onClick:()=>y("txSignature"),"aria-label":"Sort by transaction",children:["Tx"," ",t.jsx("span",{className:"cedros-admin-sort-icon",children:n==="txSignature"?l==="asc"?"↑":"↓":"↕"})]})})]}),T.map(e=>t.jsxs("div",{className:`cedros-admin-deposit-row ${W(e.status)}`,onClick:()=>j?.(e),onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),j?.(e))},role:j?"button":void 0,tabIndex:j?0:void 0,children:[t.jsx("div",{className:"cedros-admin-deposit-td",title:e.userId,children:I(e.userId)}),t.jsx("div",{className:"cedros-admin-deposit-td",children:B(e.amountLamports)}),t.jsx("div",{className:"cedros-admin-deposit-td",children:t.jsx("span",{className:"cedros-admin-status-badge",children:_(e.status)})}),t.jsx("div",{className:"cedros-admin-deposit-td",children:V(e.createdAt)}),t.jsx("div",{className:"cedros-admin-deposit-td",title:e.txSignature||void 0,children:e.txSignature?I(e.txSignature):"—"})]},e.id))]}),L>1&&t.jsxs("div",{className:"cedros-admin-pagination",children:[t.jsx("button",{type:"button",className:"cedros-button cedros-button-outline cedros-button-sm",onClick:()=>$(S-1),disabled:S<=1,children:"Previous"}),t.jsxs("span",{className:"cedros-admin-page-info",children:["Page ",S," of ",L," (",g," total)"]}),t.jsx("button",{type:"button",className:"cedros-button cedros-button-outline cedros-button-sm",onClick:()=>$(S+1),disabled:S>=L,children:"Next"})]})]})]})}exports.AdminDepositList=K;exports.AdminDepositStats=q;
