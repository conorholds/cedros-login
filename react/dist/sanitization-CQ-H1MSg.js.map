{"version":3,"file":"sanitization-CQ-H1MSg.js","sources":["../src/utils/sanitization.ts"],"sourcesContent":["/**\n * Input sanitization utilities for security\n */\n\n/**\n * Allowed image URL protocols\n */\nconst SAFE_PROTOCOLS = ['https:'];\n\n/**\n * Dangerous protocols that should never be allowed\n */\nconst DANGEROUS_PROTOCOLS = ['javascript:', 'data:', 'vbscript:', 'file:'];\n\n/**\n * Sanitizes an image URL to prevent XSS and other attacks.\n *\n * ## Security Properties\n *\n * - Only allows HTTPS URLs (prevents protocol-based attacks)\n * - Blocks javascript:, data:, vbscript:, file: protocols\n * - Returns undefined for invalid URLs\n *\n * ## Limitations (S-20/SEC-08)\n *\n * This function validates the URL protocol but does NOT validate the domain.\n * Any HTTPS URL will pass validation, including URLs from untrusted domains.\n * This is intentional - domain allowlisting is application-specific and should\n * be implemented at the consumer level (see example below).\n *\n * If your application requires domain validation (e.g., only allowing images\n * from trusted CDNs), implement additional validation:\n *\n * @example Domain allowlisting (application-level)\n * ```ts\n * const ALLOWED_DOMAINS = ['cdn.example.com', 'images.trusted.org'];\n *\n * function isAllowedImageUrl(url: string): boolean {\n *   const sanitized = sanitizeImageUrl(url);\n *   if (!sanitized) return false;\n *\n *   try {\n *     const hostname = new URL(sanitized).hostname;\n *     return ALLOWED_DOMAINS.some(d => hostname === d || hostname.endsWith('.' + d));\n *   } catch {\n *     return false;\n *   }\n * }\n * ```\n *\n * @param url - The URL to sanitize\n * @returns The sanitized URL or undefined if invalid\n *\n * @example Basic usage\n * ```ts\n * sanitizeImageUrl('https://example.com/avatar.png') // 'https://example.com/avatar.png'\n * sanitizeImageUrl('javascript:alert(1)') // undefined\n * sanitizeImageUrl('data:image/svg+xml,...') // undefined\n * ```\n */\nexport function sanitizeImageUrl(url: string | undefined | null): string | undefined {\n  if (!url || typeof url !== 'string') {\n    return undefined;\n  }\n\n  // Trim whitespace\n  const trimmedUrl = url.trim();\n  if (!trimmedUrl) {\n    return undefined;\n  }\n\n  // Check for dangerous protocols (case-insensitive)\n  const lowerUrl = trimmedUrl.toLowerCase();\n  for (const protocol of DANGEROUS_PROTOCOLS) {\n    if (lowerUrl.startsWith(protocol)) {\n      return undefined;\n    }\n  }\n\n  // Try to parse as URL\n  try {\n    const parsed = new URL(trimmedUrl);\n\n    // Only allow safe protocols\n    if (!SAFE_PROTOCOLS.includes(parsed.protocol)) {\n      return undefined;\n    }\n\n    // Return the original URL (preserves case)\n    return trimmedUrl;\n  } catch {\n    // Invalid URL\n    return undefined;\n  }\n}\n\n/**\n * Sanitizes an external link URL for use in href attributes.\n *\n * Security goals:\n * - Block dangerous protocols (javascript:, data:, vbscript:, file:)\n * - Only allow http/https absolute URLs\n */\nexport function sanitizeExternalUrl(url: string | undefined | null): string | undefined {\n  if (!url || typeof url !== 'string') {\n    return undefined;\n  }\n\n  const trimmedUrl = url.trim();\n  if (!trimmedUrl) {\n    return undefined;\n  }\n\n  const lowerUrl = trimmedUrl.toLowerCase();\n  for (const protocol of DANGEROUS_PROTOCOLS) {\n    if (lowerUrl.startsWith(protocol)) {\n      return undefined;\n    }\n  }\n\n  try {\n    const parsed = new URL(trimmedUrl);\n    if (parsed.protocol !== 'https:' && parsed.protocol !== 'http:') {\n      return undefined;\n    }\n    return trimmedUrl;\n  } catch {\n    return undefined;\n  }\n}\n\n/**\n * Sanitizes user-provided text to prevent XSS in text content.\n * Escapes HTML special characters.\n *\n * @param text - The text to sanitize\n * @returns The sanitized text\n */\nexport function sanitizeText(text: string | undefined | null): string {\n  if (!text || typeof text !== 'string') {\n    return '';\n  }\n\n  return text\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#x27;');\n}\n"],"names":["SAFE_PROTOCOLS","DANGEROUS_PROTOCOLS","sanitizeImageUrl","url","trimmedUrl","lowerUrl","protocol","parsed","sanitizeExternalUrl"],"mappings":"AAOA,MAAMA,IAAiB,CAAC,QAAQ,GAK1BC,IAAsB,CAAC,eAAe,SAAS,aAAa,OAAO;AAgDlE,SAASC,EAAiBC,GAAoD;AACnF,MAAI,CAACA,KAAO,OAAOA,KAAQ;AACzB;AAIF,QAAMC,IAAaD,EAAI,KAAA;AACvB,MAAI,CAACC;AACH;AAIF,QAAMC,IAAWD,EAAW,YAAA;AAC5B,aAAWE,KAAYL;AACrB,QAAII,EAAS,WAAWC,CAAQ;AAC9B;AAKJ,MAAI;AACF,UAAMC,IAAS,IAAI,IAAIH,CAAU;AAGjC,WAAKJ,EAAe,SAASO,EAAO,QAAQ,IAKrCH,IAJL;AAAA,EAKJ,QAAQ;AAEN;AAAA,EACF;AACF;AASO,SAASI,EAAoBL,GAAoD;AACtF,MAAI,CAACA,KAAO,OAAOA,KAAQ;AACzB;AAGF,QAAMC,IAAaD,EAAI,KAAA;AACvB,MAAI,CAACC;AACH;AAGF,QAAMC,IAAWD,EAAW,YAAA;AAC5B,aAAWE,KAAYL;AACrB,QAAII,EAAS,WAAWC,CAAQ;AAC9B;AAIJ,MAAI;AACF,UAAMC,IAAS,IAAI,IAAIH,CAAU;AACjC,WAAIG,EAAO,aAAa,YAAYA,EAAO,aAAa,UACtD,SAEKH;AAAA,EACT,QAAQ;AACN;AAAA,EACF;AACF;"}