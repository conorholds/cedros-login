{"version":3,"file":"EmbeddedWalletSettings-C7H0E8Uz.cjs","sources":["../src/components/admin/settings/EmbeddedWalletSettings.tsx"],"sourcesContent":["/**\n * Embedded Wallet settings page - enable/disable and configure recovery\n */\nimport { useEffect, useMemo } from 'react';\nimport { LoadingSpinner } from '../../shared/LoadingSpinner';\nimport { ErrorMessage } from '../../shared/ErrorMessage';\nimport { useSettingsAutosave } from '../../../hooks/useSettingsAutosave';\nimport { SettingsSection } from './settingsInputs';\nimport { AutosaveStatus } from './AutosaveStatus';\n\n/** Keys to show on this page (excluding the master toggle which is in header) */\nconst SETTINGS_KEYS = ['wallet_recovery_mode'];\n\nexport interface EmbeddedWalletSettingsProps {\n  className?: string;\n}\n\nexport function EmbeddedWalletSettings({ className }: EmbeddedWalletSettingsProps) {\n  const {\n    settings,\n    edits,\n    isLoading,\n    autosaveStatus,\n    autosaveError,\n    error,\n    fetchSettings,\n    handleChange,\n    getEffectiveValue,\n  } = useSettingsAutosave();\n\n  useEffect(() => {\n    fetchSettings();\n  }, [fetchSettings]);\n\n  // Get wallet settings from features category\n  const featuresSettings = settings['features'] ?? [];\n  const currentSettings = featuresSettings\n    .filter((s) => SETTINGS_KEYS.includes(s.key))\n    .sort((a, b) => SETTINGS_KEYS.indexOf(a.key) - SETTINGS_KEYS.indexOf(b.key));\n\n  // Embedded wallet master toggle\n  const walletEnabled = getEffectiveValue('feature_wallet_signing') === 'true';\n  const handleWalletToggle = () => {\n    handleChange('feature_wallet_signing', walletEnabled ? 'false' : 'true');\n  };\n\n  // User withdrawals toggle (only visible when wallet is enabled)\n  const withdrawalsEnabled = getEffectiveValue('feature_user_withdrawals') === 'true';\n  const handleWithdrawalsToggle = () => {\n    handleChange('feature_user_withdrawals', withdrawalsEnabled ? 'false' : 'true');\n  };\n\n  // Cross-category mismatch detection\n  const privateDepositsEnabled = getEffectiveValue('deposit_privacy_enabled') === 'true';\n  const recoveryMode = getEffectiveValue('wallet_recovery_mode');\n  const recoveryMismatch = privateDepositsEnabled && recoveryMode !== 'none';\n  const walletMismatch = privateDepositsEnabled && !walletEnabled;\n\n  // Inline warning on recovery mode row\n  const externalWarnings = useMemo(() => {\n    if (!recoveryMismatch) return undefined;\n    return {\n      wallet_recovery_mode:\n        'Private deposits require No Recovery mode. Deposits will fail with the current setting.',\n    };\n  }, [recoveryMismatch]);\n\n  if (isLoading && Object.keys(settings).length === 0) {\n    return (\n      <div className={`cedros-system-settings cedros-system-settings-loading ${className ?? ''}`}>\n        <LoadingSpinner />\n        <span>Loading settings...</span>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className={`cedros-system-settings ${className ?? ''}`}>\n        <ErrorMessage error={error.message} />\n      </div>\n    );\n  }\n\n  return (\n    <div className={`cedros-system-settings ${className ?? ''}`}>\n      <div className=\"cedros-settings-page-header\">\n        <div className=\"cedros-settings-page-header-content\">\n          <h2 className=\"cedros-settings-page-title\">Embedded Wallet</h2>\n          <p className=\"cedros-settings-page-description\">\n            Configure the embedded wallet for transaction signing.\n          </p>\n        </div>\n        <div className=\"cedros-settings-page-header-actions\">\n          <button\n            type=\"button\"\n            role=\"switch\"\n            aria-checked={walletEnabled}\n            className={`cedros-toggle ${walletEnabled ? 'cedros-toggle-on' : 'cedros-toggle-off'}`}\n            onClick={handleWalletToggle}\n          >\n            <span className=\"cedros-toggle-track\">\n              <span className=\"cedros-toggle-thumb\" />\n            </span>\n            <span className=\"cedros-toggle-label\">{walletEnabled ? 'Enabled' : 'Disabled'}</span>\n          </button>\n          <AutosaveStatus status={autosaveStatus} error={autosaveError} />\n        </div>\n      </div>\n\n      {/* User Withdrawals toggle (only visible when wallet is enabled) */}\n      {walletEnabled && (\n        <div className=\"cedros-settings-subsection\">\n          <div className=\"cedros-settings-subsection-header\">\n            <div>\n              <h3 className=\"cedros-settings-subsection-title\">User Withdrawals</h3>\n              <p className=\"cedros-settings-subsection-description\">\n                Allow users to withdraw SOL/SPL tokens from their embedded wallet to external\n                addresses.\n              </p>\n            </div>\n            <button\n              type=\"button\"\n              role=\"switch\"\n              aria-checked={withdrawalsEnabled}\n              className={`cedros-toggle ${withdrawalsEnabled ? 'cedros-toggle-on' : 'cedros-toggle-off'}`}\n              onClick={handleWithdrawalsToggle}\n            >\n              <span className=\"cedros-toggle-track\">\n                <span className=\"cedros-toggle-thumb\" />\n              </span>\n              <span className=\"cedros-toggle-label\">\n                {withdrawalsEnabled ? 'Enabled' : 'Disabled'}\n              </span>\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Mismatch warnings */}\n      {recoveryMismatch && (\n        <div className=\"cedros-settings-warning-banner\">\n          Private deposits are enabled but require No Recovery mode. Users will see an error when\n          attempting private deposits until recovery mode is changed below.\n        </div>\n      )}\n      {walletMismatch && (\n        <div className=\"cedros-settings-warning-banner\">\n          Private deposits are enabled but require the embedded wallet. Enable it above.\n        </div>\n      )}\n\n      {/* Settings content */}\n      <div className=\"cedros-admin-tab-content\">\n        {currentSettings.length === 0 ? (\n          <div className=\"cedros-system-settings-empty\">\n            <p>No additional settings available.</p>\n          </div>\n        ) : (\n          <SettingsSection\n            settings={currentSettings}\n            edits={edits}\n            onChange={handleChange}\n            externalWarnings={externalWarnings}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":["SETTINGS_KEYS","EmbeddedWalletSettings","className","settings","edits","isLoading","autosaveStatus","autosaveError","error","fetchSettings","handleChange","getEffectiveValue","useSettingsAutosave","useEffect","currentSettings","s","a","b","walletEnabled","handleWalletToggle","withdrawalsEnabled","handleWithdrawalsToggle","privateDepositsEnabled","recoveryMode","recoveryMismatch","walletMismatch","externalWarnings","useMemo","jsx","LoadingSpinner","ErrorMessage","jsxs","AutosaveStatus","SettingsSection"],"mappings":"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"}