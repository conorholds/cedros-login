{"version":3,"file":"useSystemSettings-DBlAMjFi.js","sources":["../src/utils/systemSettingsApi.ts","../src/hooks/useSystemSettings.ts"],"sourcesContent":["import type {\n  ListSystemSettingsResponse,\n  UpdateSettingRequest,\n  UpdateSystemSettingsResponse,\n} from '../types';\nimport { ApiClient, handleApiError } from './apiClient';\n\n/**\n * API client for system settings operations (admin only)\n */\nexport class SystemSettingsApiClient {\n  private client: ApiClient;\n\n  constructor(\n    baseUrl: string,\n    timeoutMs?: number,\n    retryAttempts?: number,\n    getAccessToken?: () => string | null\n  ) {\n    this.client = new ApiClient({ baseUrl, timeoutMs, retryAttempts, getAccessToken });\n  }\n\n  /**\n   * Get all system settings grouped by category\n   * Requires system admin privileges\n   */\n  async getSettings(): Promise<ListSystemSettingsResponse> {\n    try {\n      return await this.client.get<ListSystemSettingsResponse>('/admin/settings');\n    } catch (error) {\n      throw handleApiError(error, 'Failed to fetch system settings');\n    }\n  }\n\n  /**\n   * Update one or more system settings\n   * Requires system admin privileges\n   */\n  async updateSettings(settings: UpdateSettingRequest[]): Promise<UpdateSystemSettingsResponse> {\n    try {\n      return await this.client.patch<UpdateSystemSettingsResponse>('/admin/settings', {\n        settings,\n      });\n    } catch (error) {\n      throw handleApiError(error, 'Failed to update system settings');\n    }\n  }\n}\n","import { useState, useCallback, useMemo, useRef } from 'react';\nimport type { SystemSetting, UpdateSettingRequest, UseSystemSettingsReturn } from '../types';\nimport { useCedrosLogin } from '../context/useCedrosLogin';\nimport { SystemSettingsApiClient } from '../utils/systemSettingsApi';\n\n/**\n * Hook for managing system settings (admin only).\n *\n * Provides CRUD operations for system-wide configuration settings\n * stored in the database. Only accessible to system administrators.\n *\n * @example\n * ```tsx\n * function SystemSettingsPanel() {\n *   const {\n *     settings,\n *     isLoading,\n *     error,\n *     fetchSettings,\n *     updateSettings,\n *     getValue,\n *   } = useSystemSettings();\n *\n *   useEffect(() => {\n *     fetchSettings();\n *   }, [fetchSettings]);\n *\n *   const handleSave = async () => {\n *     await updateSettings([\n *       { key: 'privacy_period_secs', value: '1209600' },\n *     ]);\n *   };\n *\n *   return (\n *     <div>\n *       {Object.entries(settings).map(([category, items]) => (\n *         <section key={category}>\n *           <h3>{category}</h3>\n *           {items.map(item => (\n *             <div key={item.key}>\n *               {item.key}: {item.value}\n *             </div>\n *           ))}\n *         </section>\n *       ))}\n *     </div>\n *   );\n * }\n * ```\n */\nexport function useSystemSettings(): UseSystemSettingsReturn {\n  const { config, authState, _internal } = useCedrosLogin();\n\n  const [settings, setSettings] = useState<Record<string, SystemSetting[]>>({});\n  const [isLoading, setIsLoading] = useState(false);\n  const [isUpdating, setIsUpdating] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n  const requestIdRef = useRef(0);\n\n  const apiClient = useMemo(\n    () =>\n      new SystemSettingsApiClient(\n        config.serverUrl,\n        config.requestTimeout,\n        config.retryAttempts,\n        _internal?.getAccessToken\n      ),\n    [config.serverUrl, config.requestTimeout, config.retryAttempts, _internal]\n  );\n\n  // Use ref to avoid apiClient in callback dependencies\n  const apiClientRef = useRef(apiClient);\n  apiClientRef.current = apiClient;\n\n  const fetchSettings = useCallback(async () => {\n    if (authState !== 'authenticated') {\n      setSettings({});\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n    const requestId = ++requestIdRef.current;\n\n    try {\n      const response = await apiClientRef.current.getSettings();\n      if (requestId !== requestIdRef.current) return;\n      setSettings(response.settings);\n    } catch (err) {\n      if (requestId !== requestIdRef.current) return;\n      setError(err instanceof Error ? err : new Error('Failed to fetch settings'));\n    } finally {\n      if (requestId === requestIdRef.current) {\n        setIsLoading(false);\n      }\n    }\n  }, [authState]);\n\n  const updateSettings = useCallback(\n    async (updates: UpdateSettingRequest[]): Promise<void> => {\n      if (authState !== 'authenticated') {\n        throw new Error('Not authenticated');\n      }\n\n      setIsUpdating(true);\n      setError(null);\n\n      try {\n        await apiClientRef.current.updateSettings(updates);\n        // Refresh settings after update\n        await fetchSettings();\n      } catch (err) {\n        const error = err instanceof Error ? err : new Error('Failed to update settings');\n        setError(error);\n        throw error;\n      } finally {\n        setIsUpdating(false);\n      }\n    },\n    [authState, fetchSettings]\n  );\n\n  const getValue = useCallback(\n    (key: string): string | undefined => {\n      for (const categorySettings of Object.values(settings)) {\n        const found = categorySettings.find((s) => s.key === key);\n        if (found) return found.value;\n      }\n      return undefined;\n    },\n    [settings]\n  );\n\n  return {\n    settings,\n    isLoading,\n    isUpdating,\n    error,\n    fetchSettings,\n    updateSettings,\n    getValue,\n  };\n}\n"],"names":["SystemSettingsApiClient","baseUrl","timeoutMs","retryAttempts","getAccessToken","ApiClient","error","handleApiError","settings","useSystemSettings","config","authState","_internal","useCedrosLogin","setSettings","useState","isLoading","setIsLoading","isUpdating","setIsUpdating","setError","requestIdRef","useRef","apiClient","useMemo","apiClientRef","fetchSettings","useCallback","requestId","response","err","updateSettings","updates","getValue","key","categorySettings","found","s"],"mappings":"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"}