{"version":3,"file":"TeamSection-CvrCoa9D.js","sources":["../src/admin/sections/TeamSection.tsx"],"sourcesContent":["/**\n * Team Section - Plugin wrapper\n *\n * Combined team member management and invites for organizations.\n */\n\nimport React, { useMemo, useState, useEffect } from 'react';\nimport type { AdminSectionProps } from '../types';\nimport { MemberList } from '../../components/members/MemberList';\nimport { InviteForm } from '../../components/invites/InviteForm';\nimport { InviteList } from '../../components/invites/InviteList';\nimport { StatsBar } from '../../components/admin/StatsBar';\nimport { PermissionsSection } from '../../components/admin/PermissionsSection';\nimport { useOrgs } from '../../hooks/useOrgs';\nimport { useMembers } from '../../hooks/useMembers';\nimport { useInvites } from '../../hooks/useInvites';\n\ntype TeamTab = 'members' | 'invites' | 'permissions';\n\nexport default function TeamSection({ pluginContext }: AdminSectionProps): React.JSX.Element {\n  const [activeTab, setActiveTab] = useState<TeamTab>('members');\n  const {\n    activeOrg,\n    hasPermission,\n    role,\n    isLoading: orgsLoading,\n    error: orgsError,\n    fetchOrgs,\n  } = useOrgs();\n\n  const {\n    members,\n    isLoading: membersLoading,\n    error: membersError,\n    fetchMembers,\n    updateMemberRole,\n    removeMember,\n  } = useMembers(activeOrg?.id ?? '');\n  const {\n    invites,\n    isLoading: invitesLoading,\n    error: invitesError,\n    fetchInvites,\n    createInvite,\n    cancelInvite,\n    resendInvite,\n  } = useInvites(activeOrg?.id ?? '');\n\n  useEffect(() => {\n    if (activeOrg?.id) {\n      fetchMembers();\n      fetchInvites();\n    }\n  }, [activeOrg?.id, fetchMembers, fetchInvites]);\n\n  // P-01: Compute role counts BEFORE any early return to follow React Hooks rules\n  const roleCounts = useMemo(\n    () =>\n      members.reduce(\n        (acc, member) => {\n          acc[member.role] = (acc[member.role] ?? 0) + 1;\n          return acc;\n        },\n        {} as Record<string, number>\n      ),\n    [members]\n  );\n\n  if (orgsLoading && !activeOrg) {\n    return (\n      <div className=\"cedros-dashboard__section\">\n        <div className=\"cedros-dashboard__empty\">\n          <span className=\"cedros-admin-loading-indicator\" />\n          <span className=\"cedros-admin-loading-text\">Loading organization...</span>\n        </div>\n      </div>\n    );\n  }\n\n  if (orgsError && !activeOrg) {\n    return (\n      <div className=\"cedros-dashboard__section\">\n        <div className=\"cedros-dashboard__empty\">\n          <p className=\"cedros-admin-error\">{orgsError.message}</p>\n          <button type=\"button\" className=\"cedros-button cedros-button-outline\" onClick={fetchOrgs}>\n            Retry\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (!activeOrg) {\n    return (\n      <div className=\"cedros-dashboard__section\">\n        <div className=\"cedros-dashboard__empty\">No organizations found.</div>\n      </div>\n    );\n  }\n\n  const canInvite = hasPermission('invite:create');\n  const canCancel = hasPermission('invite:cancel');\n  const pendingCount = invites.length;\n  const ownerCount = roleCounts.owner ?? 0;\n  const adminCount = roleCounts.admin ?? 0;\n  const memberCount = roleCounts.member ?? 0;\n\n  return (\n    <div className=\"cedros-dashboard__team\">\n      <StatsBar\n        stats={[\n          { label: 'Owners', value: ownerCount },\n          { label: 'Admins', value: adminCount },\n          { label: 'Members', value: memberCount },\n          { label: 'Pending Invites', value: pendingCount },\n        ]}\n      />\n      {/* Tabs */}\n      <div className=\"cedros-admin-tabs cedros-admin-tabs--line\">\n        <button\n          type=\"button\"\n          className={`cedros-admin-tab ${activeTab === 'members' ? 'cedros-admin-tab-active' : ''}`}\n          onClick={() => setActiveTab('members')}\n          aria-selected={activeTab === 'members'}\n          role=\"tab\"\n        >\n          Members\n        </button>\n        <button\n          type=\"button\"\n          className={`cedros-admin-tab ${activeTab === 'invites' ? 'cedros-admin-tab-active' : ''}`}\n          onClick={() => setActiveTab('invites')}\n          aria-selected={activeTab === 'invites'}\n          role=\"tab\"\n        >\n          Pending Invites{pendingCount > 0 && ` (${pendingCount})`}\n        </button>\n        {role === 'owner' && (\n          <button\n            type=\"button\"\n            className={`cedros-admin-tab ${activeTab === 'permissions' ? 'cedros-admin-tab-active' : ''}`}\n            onClick={() => setActiveTab('permissions')}\n            aria-selected={activeTab === 'permissions'}\n            role=\"tab\"\n          >\n            Permissions\n          </button>\n        )}\n      </div>\n\n      {/* Tab content */}\n      <div className=\"cedros-admin-tab-content\" role=\"tabpanel\">\n        {activeTab === 'members' && (\n          <MemberList\n            members={members}\n            currentUserId={pluginContext.userId}\n            isLoading={membersLoading}\n            error={membersError?.message}\n            canManage={hasPermission('member:remove')}\n            canChangeRoles={hasPermission('member:role_change')}\n            onUpdateRole={updateMemberRole}\n            onRemove={removeMember}\n          />\n        )}\n\n        {activeTab === 'invites' && (\n          <div className=\"cedros-dashboard__invites\">\n            {canInvite && (\n              <div className=\"cedros-dashboard__section\">\n                <div className=\"cedros-dashboard__section-header\">\n                  <h3 className=\"cedros-dashboard__section-title\">Send Invitation</h3>\n                </div>\n                <InviteForm\n                  onSubmit={createInvite}\n                  isLoading={invitesLoading}\n                  error={invitesError?.message}\n                />\n              </div>\n            )}\n\n            <div className=\"cedros-dashboard__section\">\n              <InviteList\n                invites={invites}\n                isLoading={invitesLoading}\n                error={invitesError?.message}\n                canManage={canCancel || canInvite}\n                onCancel={canCancel ? cancelInvite : undefined}\n                onResend={canInvite ? resendInvite : undefined}\n              />\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'permissions' && role === 'owner' && <PermissionsSection userRole={role} />}\n      </div>\n    </div>\n  );\n}\n"],"names":["TeamSection","pluginContext","activeTab","setActiveTab","useState","activeOrg","hasPermission","role","orgsLoading","orgsError","fetchOrgs","useOrgs","members","membersLoading","membersError","fetchMembers","updateMemberRole","removeMember","useMembers","invites","invitesLoading","invitesError","fetchInvites","createInvite","cancelInvite","resendInvite","useInvites","useEffect","roleCounts","useMemo","acc","member","jsxs","jsx","canInvite","canCancel","pendingCount","ownerCount","adminCount","memberCount","StatsBar","MemberList","InviteForm","InviteList","PermissionsSection"],"mappings":"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"}