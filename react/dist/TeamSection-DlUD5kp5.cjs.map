{"version":3,"file":"TeamSection-DlUD5kp5.cjs","sources":["../src/admin/sections/TeamSection.tsx"],"sourcesContent":["/**\n * Team Section - Plugin wrapper\n *\n * Combined team member management and invites for organizations.\n */\n\nimport React, { useMemo, useState, useEffect } from 'react';\nimport type { AdminSectionProps } from '../types';\nimport { MemberList } from '../../components/members/MemberList';\nimport { InviteForm } from '../../components/invites/InviteForm';\nimport { InviteList } from '../../components/invites/InviteList';\nimport { StatsBar } from '../../components/admin/StatsBar';\nimport { PermissionsSection } from '../../components/admin/PermissionsSection';\nimport { useOrgs } from '../../hooks/useOrgs';\nimport { useMembers } from '../../hooks/useMembers';\nimport { useInvites } from '../../hooks/useInvites';\n\ntype TeamTab = 'members' | 'invites' | 'permissions';\n\nexport default function TeamSection({ pluginContext }: AdminSectionProps): React.JSX.Element {\n  const [activeTab, setActiveTab] = useState<TeamTab>('members');\n  const {\n    activeOrg,\n    hasPermission,\n    role,\n    isLoading: orgsLoading,\n    error: orgsError,\n    fetchOrgs,\n  } = useOrgs();\n\n  const {\n    members,\n    isLoading: membersLoading,\n    error: membersError,\n    fetchMembers,\n    updateMemberRole,\n    removeMember,\n  } = useMembers(activeOrg?.id ?? '');\n  const {\n    invites,\n    isLoading: invitesLoading,\n    error: invitesError,\n    fetchInvites,\n    createInvite,\n    cancelInvite,\n    resendInvite,\n  } = useInvites(activeOrg?.id ?? '');\n\n  useEffect(() => {\n    if (activeOrg?.id) {\n      fetchMembers();\n      fetchInvites();\n    }\n  }, [activeOrg?.id, fetchMembers, fetchInvites]);\n\n  // P-01: Compute role counts BEFORE any early return to follow React Hooks rules\n  const roleCounts = useMemo(\n    () =>\n      members.reduce(\n        (acc, member) => {\n          acc[member.role] = (acc[member.role] ?? 0) + 1;\n          return acc;\n        },\n        {} as Record<string, number>\n      ),\n    [members]\n  );\n\n  if (orgsLoading && !activeOrg) {\n    return (\n      <div className=\"cedros-dashboard__section\">\n        <div className=\"cedros-dashboard__empty\">\n          <span className=\"cedros-admin-loading-indicator\" />\n          <span className=\"cedros-admin-loading-text\">Loading organization...</span>\n        </div>\n      </div>\n    );\n  }\n\n  if (orgsError && !activeOrg) {\n    return (\n      <div className=\"cedros-dashboard__section\">\n        <div className=\"cedros-dashboard__empty\">\n          <p className=\"cedros-admin-error\">{orgsError.message}</p>\n          <button type=\"button\" className=\"cedros-button cedros-button-outline\" onClick={fetchOrgs}>\n            Retry\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (!activeOrg) {\n    return (\n      <div className=\"cedros-dashboard__section\">\n        <div className=\"cedros-dashboard__empty\">No organizations found.</div>\n      </div>\n    );\n  }\n\n  const canInvite = hasPermission('invite:create');\n  const canCancel = hasPermission('invite:cancel');\n  const pendingCount = invites.length;\n  const ownerCount = roleCounts.owner ?? 0;\n  const adminCount = roleCounts.admin ?? 0;\n  const memberCount = roleCounts.member ?? 0;\n\n  return (\n    <div className=\"cedros-dashboard__team\">\n      <StatsBar\n        stats={[\n          { label: 'Owners', value: ownerCount },\n          { label: 'Admins', value: adminCount },\n          { label: 'Members', value: memberCount },\n          { label: 'Pending Invites', value: pendingCount },\n        ]}\n      />\n      {/* Tabs */}\n      <div className=\"cedros-admin-tabs cedros-admin-tabs--line\">\n        <button\n          type=\"button\"\n          className={`cedros-admin-tab ${activeTab === 'members' ? 'cedros-admin-tab-active' : ''}`}\n          onClick={() => setActiveTab('members')}\n          aria-selected={activeTab === 'members'}\n          role=\"tab\"\n        >\n          Members\n        </button>\n        <button\n          type=\"button\"\n          className={`cedros-admin-tab ${activeTab === 'invites' ? 'cedros-admin-tab-active' : ''}`}\n          onClick={() => setActiveTab('invites')}\n          aria-selected={activeTab === 'invites'}\n          role=\"tab\"\n        >\n          Pending Invites{pendingCount > 0 && ` (${pendingCount})`}\n        </button>\n        {role === 'owner' && (\n          <button\n            type=\"button\"\n            className={`cedros-admin-tab ${activeTab === 'permissions' ? 'cedros-admin-tab-active' : ''}`}\n            onClick={() => setActiveTab('permissions')}\n            aria-selected={activeTab === 'permissions'}\n            role=\"tab\"\n          >\n            Permissions\n          </button>\n        )}\n      </div>\n\n      {/* Tab content */}\n      <div className=\"cedros-admin-tab-content\" role=\"tabpanel\">\n        {activeTab === 'members' && (\n          <MemberList\n            members={members}\n            currentUserId={pluginContext.userId}\n            isLoading={membersLoading}\n            error={membersError?.message}\n            canManage={hasPermission('member:remove')}\n            canChangeRoles={hasPermission('member:role_change')}\n            onUpdateRole={updateMemberRole}\n            onRemove={removeMember}\n          />\n        )}\n\n        {activeTab === 'invites' && (\n          <div className=\"cedros-dashboard__invites\">\n            {canInvite && (\n              <div className=\"cedros-dashboard__section\">\n                <div className=\"cedros-dashboard__section-header\">\n                  <h3 className=\"cedros-dashboard__section-title\">Send Invitation</h3>\n                </div>\n                <InviteForm\n                  onSubmit={createInvite}\n                  isLoading={invitesLoading}\n                  error={invitesError?.message}\n                />\n              </div>\n            )}\n\n            <div className=\"cedros-dashboard__section\">\n              <InviteList\n                invites={invites}\n                isLoading={invitesLoading}\n                error={invitesError?.message}\n                canManage={canCancel || canInvite}\n                onCancel={canCancel ? cancelInvite : undefined}\n                onResend={canInvite ? resendInvite : undefined}\n              />\n            </div>\n          </div>\n        )}\n\n        {activeTab === 'permissions' && role === 'owner' && <PermissionsSection userRole={role} />}\n      </div>\n    </div>\n  );\n}\n"],"names":["TeamSection","pluginContext","activeTab","setActiveTab","useState","activeOrg","hasPermission","role","orgsLoading","orgsError","fetchOrgs","useOrgs","members","membersLoading","membersError","fetchMembers","updateMemberRole","removeMember","useMembers","invites","invitesLoading","invitesError","fetchInvites","createInvite","cancelInvite","resendInvite","useInvites","useEffect","roleCounts","useMemo","acc","member","jsxs","jsx","canInvite","canCancel","pendingCount","ownerCount","adminCount","memberCount","StatsBar","MemberList","InviteForm","InviteList","PermissionsSection"],"mappings":"gQAmBA,SAAwBA,EAAY,CAAE,cAAAC,GAAuD,CAC3F,KAAM,CAACC,EAAWC,CAAY,EAAIC,EAAAA,SAAkB,SAAS,EACvD,CACJ,UAAAC,EACA,cAAAC,EACA,KAAAC,EACA,UAAWC,EACX,MAAOC,EACP,UAAAC,CAAA,EACEC,UAAA,EAEE,CACJ,QAAAC,EACA,UAAWC,EACX,MAAOC,EACP,aAAAC,EACA,iBAAAC,EACA,aAAAC,CAAA,EACEC,aAAWb,GAAW,IAAM,EAAE,EAC5B,CACJ,QAAAc,EACA,UAAWC,EACX,MAAOC,EACP,aAAAC,EACA,aAAAC,EACA,aAAAC,EACA,aAAAC,CAAA,EACEC,aAAWrB,GAAW,IAAM,EAAE,EAElCsB,EAAAA,UAAU,IAAM,CACVtB,GAAW,KACbU,EAAA,EACAO,EAAA,EAEJ,EAAG,CAACjB,GAAW,GAAIU,EAAcO,CAAY,CAAC,EAG9C,MAAMM,EAAaC,EAAAA,QACjB,IACEjB,EAAQ,OACN,CAACkB,EAAKC,KACJD,EAAIC,EAAO,IAAI,GAAKD,EAAIC,EAAO,IAAI,GAAK,GAAK,EACtCD,GAET,CAAA,CAAC,EAEL,CAAClB,CAAO,CAAA,EAGV,GAAIJ,GAAe,CAACH,EAClB,aACG,MAAA,CAAI,UAAU,4BACb,SAAA2B,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAAC,OAAA,CAAK,UAAU,gCAAA,CAAiC,EACjDA,EAAAA,IAAC,OAAA,CAAK,UAAU,4BAA4B,SAAA,yBAAA,CAAuB,CAAA,CAAA,CACrE,CAAA,CACF,EAIJ,GAAIxB,GAAa,CAACJ,EAChB,aACG,MAAA,CAAI,UAAU,4BACb,SAAA2B,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAAC,IAAA,CAAE,UAAU,qBAAsB,SAAAxB,EAAU,QAAQ,EACrDwB,EAAAA,IAAC,UAAO,KAAK,SAAS,UAAU,sCAAsC,QAASvB,EAAW,SAAA,OAAA,CAE1F,CAAA,CAAA,CACF,CAAA,CACF,EAIJ,GAAI,CAACL,EACH,OACE4B,EAAAA,IAAC,OAAI,UAAU,4BACb,eAAC,MAAA,CAAI,UAAU,0BAA0B,SAAA,yBAAA,CAAuB,CAAA,CAClE,EAIJ,MAAMC,EAAY5B,EAAc,eAAe,EACzC6B,EAAY7B,EAAc,eAAe,EACzC8B,EAAejB,EAAQ,OACvBkB,EAAaT,EAAW,OAAS,EACjCU,EAAaV,EAAW,OAAS,EACjCW,EAAcX,EAAW,QAAU,EAEzC,OACEI,EAAAA,KAAC,MAAA,CAAI,UAAU,yBACb,SAAA,CAAAC,EAAAA,IAACO,EAAAA,SAAA,CACC,MAAO,CACL,CAAE,MAAO,SAAU,MAAOH,CAAA,EAC1B,CAAE,MAAO,SAAU,MAAOC,CAAA,EAC1B,CAAE,MAAO,UAAW,MAAOC,CAAA,EAC3B,CAAE,MAAO,kBAAmB,MAAOH,CAAA,CAAa,CAClD,CAAA,EAGFJ,EAAAA,KAAC,MAAA,CAAI,UAAU,4CACb,SAAA,CAAAC,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,UAAW,oBAAoB/B,IAAc,UAAY,0BAA4B,EAAE,GACvF,QAAS,IAAMC,EAAa,SAAS,EACrC,gBAAeD,IAAc,UAC7B,KAAK,MACN,SAAA,SAAA,CAAA,EAGD8B,EAAAA,KAAC,SAAA,CACC,KAAK,SACL,UAAW,oBAAoB9B,IAAc,UAAY,0BAA4B,EAAE,GACvF,QAAS,IAAMC,EAAa,SAAS,EACrC,gBAAeD,IAAc,UAC7B,KAAK,MACN,SAAA,CAAA,kBACiBkC,EAAe,GAAK,KAAKA,CAAY,GAAA,CAAA,CAAA,EAEtD7B,IAAS,SACR0B,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,UAAW,oBAAoB/B,IAAc,cAAgB,0BAA4B,EAAE,GAC3F,QAAS,IAAMC,EAAa,aAAa,EACzC,gBAAeD,IAAc,cAC7B,KAAK,MACN,SAAA,aAAA,CAAA,CAED,EAEJ,EAGA8B,EAAAA,KAAC,MAAA,CAAI,UAAU,2BAA2B,KAAK,WAC5C,SAAA,CAAA9B,IAAc,WACb+B,EAAAA,IAACQ,EAAAA,WAAA,CACC,QAAA7B,EACA,cAAeX,EAAc,OAC7B,UAAWY,EACX,MAAOC,GAAc,QACrB,UAAWR,EAAc,eAAe,EACxC,eAAgBA,EAAc,oBAAoB,EAClD,aAAcU,EACd,SAAUC,CAAA,CAAA,EAIbf,IAAc,WACb8B,OAAC,MAAA,CAAI,UAAU,4BACZ,SAAA,CAAAE,GACCF,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,mCACb,SAAAA,EAAAA,IAAC,MAAG,UAAU,kCAAkC,2BAAe,CAAA,CACjE,EACAA,EAAAA,IAACS,EAAAA,WAAA,CACC,SAAUnB,EACV,UAAWH,EACX,MAAOC,GAAc,OAAA,CAAA,CACvB,EACF,EAGFY,EAAAA,IAAC,MAAA,CAAI,UAAU,4BACb,SAAAA,EAAAA,IAACU,EAAAA,WAAA,CACC,QAAAxB,EACA,UAAWC,EACX,MAAOC,GAAc,QACrB,UAAWc,GAAaD,EACxB,SAAUC,EAAYX,EAAe,OACrC,SAAUU,EAAYT,EAAe,MAAA,CAAA,CACvC,CACF,CAAA,EACF,EAGDvB,IAAc,eAAiBK,IAAS,SAAW0B,EAAAA,IAACW,qBAAA,CAAmB,SAAUrC,CAAA,CAAM,CAAA,CAAA,CAC1F,CAAA,EACF,CAEJ"}