{"version":3,"file":"useAdminDeposits-BDY5KJ0-.js","sources":["../src/hooks/useAdminDeposits.ts"],"sourcesContent":["/**\n * Hook for admin Privacy Cash deposit operations\n *\n * Provides admin-only access to view all deposits, statistics, and pending withdrawals.\n * Requires system admin privileges.\n *\n * Safe to call outside CedrosLoginProvider (returns no-op functions).\n */\n\nimport { useState, useCallback, useMemo } from 'react';\nimport { useCedrosLoginOptional } from '../context/useCedrosLogin';\nimport { ApiClient, handleApiError } from '../utils/apiClient';\nimport type {\n  UseAdminDepositsReturn,\n  AdminDepositListResponse,\n  AdminDepositStatsResponse,\n  ProcessWithdrawalRequest,\n  ProcessWithdrawalResponse,\n  ProcessAllWithdrawalsResponse,\n  PrivacyStatusResponse,\n  AdminCreditStatsResponse,\n} from '../types/deposit';\n\nexport type { UseAdminDepositsReturn } from '../types/deposit';\n\n/**\n * Hook for admin Privacy Cash deposit operations\n *\n * Requires system admin privileges. All methods will fail with 403 if not admin.\n *\n * Safe to call outside CedrosLoginProvider - returns no-op functions that throw.\n */\nexport function useAdminDeposits(): UseAdminDepositsReturn {\n  const context = useCedrosLoginOptional();\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const apiClient = useMemo(() => {\n    if (!context) return null;\n    return new ApiClient({\n      baseUrl: context.config.serverUrl,\n      timeoutMs: context.config.requestTimeout,\n      retryAttempts: context.config.retryAttempts,\n      getAccessToken: context._internal?.getAccessToken,\n    });\n  }, [context]);\n\n  const clearError = useCallback(() => {\n    setError(null);\n  }, []);\n\n  const listDeposits = useCallback(\n    async (options?: {\n      status?: string;\n      limit?: number;\n      offset?: number;\n    }): Promise<AdminDepositListResponse> => {\n      if (!apiClient) {\n        throw new Error('useAdminDeposits must be used within a CedrosLoginProvider');\n      }\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const params = new URLSearchParams();\n        if (options?.status) params.set('status', options.status);\n        if (options?.limit !== undefined) params.set('limit', String(options.limit));\n        if (options?.offset !== undefined) params.set('offset', String(options.offset));\n        const query = params.toString();\n        const url = query ? `/admin/deposits?${query}` : '/admin/deposits';\n        const data = await apiClient.get<AdminDepositListResponse>(url);\n        return data;\n      } catch (err) {\n        const apiError = handleApiError(err, 'Failed to list deposits');\n        setError(apiError.message);\n        throw apiError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [apiClient]\n  );\n\n  const getStats = useCallback(async (): Promise<AdminDepositStatsResponse> => {\n    if (!apiClient) {\n      throw new Error('useAdminDeposits must be used within a CedrosLoginProvider');\n    }\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const data = await apiClient.get<AdminDepositStatsResponse>('/admin/deposits/stats');\n      return data;\n    } catch (err) {\n      const apiError = handleApiError(err, 'Failed to get deposit stats');\n      setError(apiError.message);\n      throw apiError;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [apiClient]);\n\n  const listInPrivacyPeriod = useCallback(\n    async (options?: { limit?: number; offset?: number }): Promise<AdminDepositListResponse> => {\n      if (!apiClient) {\n        throw new Error('useAdminDeposits must be used within a CedrosLoginProvider');\n      }\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const params = new URLSearchParams();\n        if (options?.limit !== undefined) params.set('limit', String(options.limit));\n        if (options?.offset !== undefined) params.set('offset', String(options.offset));\n        const query = params.toString();\n        const url = query\n          ? `/admin/deposits/in-privacy-period?${query}`\n          : '/admin/deposits/in-privacy-period';\n        const data = await apiClient.get<AdminDepositListResponse>(url);\n        return data;\n      } catch (err) {\n        const apiError = handleApiError(err, 'Failed to list deposits in privacy period');\n        setError(apiError.message);\n        throw apiError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [apiClient]\n  );\n\n  const listPendingWithdrawals = useCallback(\n    async (options?: { limit?: number; offset?: number }): Promise<AdminDepositListResponse> => {\n      if (!apiClient) {\n        throw new Error('useAdminDeposits must be used within a CedrosLoginProvider');\n      }\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const params = new URLSearchParams();\n        if (options?.limit !== undefined) params.set('limit', String(options.limit));\n        if (options?.offset !== undefined) params.set('offset', String(options.offset));\n        const query = params.toString();\n        const url = query ? `/admin/withdrawals/pending?${query}` : '/admin/withdrawals/pending';\n        const data = await apiClient.get<AdminDepositListResponse>(url);\n        return data;\n      } catch (err) {\n        const apiError = handleApiError(err, 'Failed to list pending withdrawals');\n        setError(apiError.message);\n        throw apiError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [apiClient]\n  );\n\n  const processWithdrawal = useCallback(\n    async (\n      sessionId: string,\n      options?: ProcessWithdrawalRequest\n    ): Promise<ProcessWithdrawalResponse> => {\n      if (!apiClient) {\n        throw new Error('useAdminDeposits must be used within a CedrosLoginProvider');\n      }\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const data = await apiClient.post<ProcessWithdrawalResponse>(\n          `/admin/withdrawals/${sessionId}/process`,\n          options ?? {}\n        );\n        return data;\n      } catch (err) {\n        const apiError = handleApiError(err, 'Failed to process withdrawal');\n        setError(apiError.message);\n        throw apiError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [apiClient]\n  );\n\n  const processAllWithdrawals = useCallback(async (): Promise<ProcessAllWithdrawalsResponse> => {\n    if (!apiClient) {\n      throw new Error('useAdminDeposits must be used within a CedrosLoginProvider');\n    }\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const data = await apiClient.post<ProcessAllWithdrawalsResponse>(\n        '/admin/withdrawals/process-all',\n        {}\n      );\n      return data;\n    } catch (err) {\n      const apiError = handleApiError(err, 'Failed to process withdrawals');\n      setError(apiError.message);\n      throw apiError;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [apiClient]);\n\n  const getPrivacyStatus = useCallback(async (): Promise<PrivacyStatusResponse> => {\n    if (!apiClient) {\n      throw new Error('useAdminDeposits must be used within a CedrosLoginProvider');\n    }\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const data = await apiClient.get<PrivacyStatusResponse>('/admin/privacy/status');\n      return data;\n    } catch (err) {\n      const apiError = handleApiError(err, 'Failed to get privacy status');\n      setError(apiError.message);\n      throw apiError;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [apiClient]);\n\n  const getCreditStats = useCallback(async (): Promise<AdminCreditStatsResponse> => {\n    if (!apiClient) {\n      throw new Error('useAdminDeposits must be used within a CedrosLoginProvider');\n    }\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const data = await apiClient.get<AdminCreditStatsResponse>('/admin/credits/stats');\n      return data;\n    } catch (err) {\n      const apiError = handleApiError(err, 'Failed to get credit stats');\n      setError(apiError.message);\n      throw apiError;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [apiClient]);\n\n  return {\n    listDeposits,\n    getStats,\n    listInPrivacyPeriod,\n    listPendingWithdrawals,\n    processWithdrawal,\n    processAllWithdrawals,\n    getPrivacyStatus,\n    getCreditStats,\n    isLoading,\n    error,\n    clearError,\n  };\n}\n"],"names":["useAdminDeposits","context","useCedrosLoginOptional","isLoading","setIsLoading","useState","error","setError","apiClient","useMemo","ApiClient","clearError","useCallback","listDeposits","options","params","query","url","err","apiError","handleApiError","getStats","listInPrivacyPeriod","listPendingWithdrawals","processWithdrawal","sessionId","processAllWithdrawals","getPrivacyStatus","getCreditStats"],"mappings":"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"}