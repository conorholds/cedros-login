{"version":3,"file":"useAdminDeposits-Dvx3_UUE.cjs","sources":["../src/hooks/useAdminDeposits.ts"],"sourcesContent":["/**\n * Hook for admin Privacy Cash deposit operations\n *\n * Provides admin-only access to view all deposits, statistics, and pending withdrawals.\n * Requires system admin privileges.\n *\n * Safe to call outside CedrosLoginProvider (returns no-op functions).\n */\n\nimport { useState, useCallback, useMemo } from 'react';\nimport { useCedrosLoginOptional } from '../context/useCedrosLogin';\nimport { ApiClient, handleApiError } from '../utils/apiClient';\nimport type {\n  UseAdminDepositsReturn,\n  AdminDepositListResponse,\n  AdminDepositStatsResponse,\n  ProcessWithdrawalRequest,\n  ProcessWithdrawalResponse,\n  ProcessAllWithdrawalsResponse,\n  PrivacyStatusResponse,\n  AdminCreditStatsResponse,\n} from '../types/deposit';\n\nexport type { UseAdminDepositsReturn } from '../types/deposit';\n\n/**\n * Hook for admin Privacy Cash deposit operations\n *\n * Requires system admin privileges. All methods will fail with 403 if not admin.\n *\n * Safe to call outside CedrosLoginProvider - returns no-op functions that throw.\n */\nexport function useAdminDeposits(): UseAdminDepositsReturn {\n  const context = useCedrosLoginOptional();\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const apiClient = useMemo(() => {\n    if (!context) return null;\n    return new ApiClient({\n      baseUrl: context.config.serverUrl,\n      timeoutMs: context.config.requestTimeout,\n      retryAttempts: context.config.retryAttempts,\n      getAccessToken: context._internal?.getAccessToken,\n    });\n  }, [context]);\n\n  const clearError = useCallback(() => {\n    setError(null);\n  }, []);\n\n  const listDeposits = useCallback(\n    async (options?: {\n      status?: string;\n      limit?: number;\n      offset?: number;\n    }): Promise<AdminDepositListResponse> => {\n      if (!apiClient) {\n        throw new Error('useAdminDeposits must be used within a CedrosLoginProvider');\n      }\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const params = new URLSearchParams();\n        if (options?.status) params.set('status', options.status);\n        if (options?.limit !== undefined) params.set('limit', String(options.limit));\n        if (options?.offset !== undefined) params.set('offset', String(options.offset));\n        const query = params.toString();\n        const url = query ? `/admin/deposits?${query}` : '/admin/deposits';\n        const data = await apiClient.get<AdminDepositListResponse>(url);\n        return data;\n      } catch (err) {\n        const apiError = handleApiError(err, 'Failed to list deposits');\n        setError(apiError.message);\n        throw apiError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [apiClient]\n  );\n\n  const getStats = useCallback(async (): Promise<AdminDepositStatsResponse> => {\n    if (!apiClient) {\n      throw new Error('useAdminDeposits must be used within a CedrosLoginProvider');\n    }\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const data = await apiClient.get<AdminDepositStatsResponse>('/admin/deposits/stats');\n      return data;\n    } catch (err) {\n      const apiError = handleApiError(err, 'Failed to get deposit stats');\n      setError(apiError.message);\n      throw apiError;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [apiClient]);\n\n  const listInPrivacyPeriod = useCallback(\n    async (options?: { limit?: number; offset?: number }): Promise<AdminDepositListResponse> => {\n      if (!apiClient) {\n        throw new Error('useAdminDeposits must be used within a CedrosLoginProvider');\n      }\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const params = new URLSearchParams();\n        if (options?.limit !== undefined) params.set('limit', String(options.limit));\n        if (options?.offset !== undefined) params.set('offset', String(options.offset));\n        const query = params.toString();\n        const url = query\n          ? `/admin/deposits/in-privacy-period?${query}`\n          : '/admin/deposits/in-privacy-period';\n        const data = await apiClient.get<AdminDepositListResponse>(url);\n        return data;\n      } catch (err) {\n        const apiError = handleApiError(err, 'Failed to list deposits in privacy period');\n        setError(apiError.message);\n        throw apiError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [apiClient]\n  );\n\n  const listPendingWithdrawals = useCallback(\n    async (options?: { limit?: number; offset?: number }): Promise<AdminDepositListResponse> => {\n      if (!apiClient) {\n        throw new Error('useAdminDeposits must be used within a CedrosLoginProvider');\n      }\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const params = new URLSearchParams();\n        if (options?.limit !== undefined) params.set('limit', String(options.limit));\n        if (options?.offset !== undefined) params.set('offset', String(options.offset));\n        const query = params.toString();\n        const url = query ? `/admin/withdrawals/pending?${query}` : '/admin/withdrawals/pending';\n        const data = await apiClient.get<AdminDepositListResponse>(url);\n        return data;\n      } catch (err) {\n        const apiError = handleApiError(err, 'Failed to list pending withdrawals');\n        setError(apiError.message);\n        throw apiError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [apiClient]\n  );\n\n  const processWithdrawal = useCallback(\n    async (\n      sessionId: string,\n      options?: ProcessWithdrawalRequest\n    ): Promise<ProcessWithdrawalResponse> => {\n      if (!apiClient) {\n        throw new Error('useAdminDeposits must be used within a CedrosLoginProvider');\n      }\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const data = await apiClient.post<ProcessWithdrawalResponse>(\n          `/admin/withdrawals/${sessionId}/process`,\n          options ?? {}\n        );\n        return data;\n      } catch (err) {\n        const apiError = handleApiError(err, 'Failed to process withdrawal');\n        setError(apiError.message);\n        throw apiError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [apiClient]\n  );\n\n  const processAllWithdrawals = useCallback(async (): Promise<ProcessAllWithdrawalsResponse> => {\n    if (!apiClient) {\n      throw new Error('useAdminDeposits must be used within a CedrosLoginProvider');\n    }\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const data = await apiClient.post<ProcessAllWithdrawalsResponse>(\n        '/admin/withdrawals/process-all',\n        {}\n      );\n      return data;\n    } catch (err) {\n      const apiError = handleApiError(err, 'Failed to process withdrawals');\n      setError(apiError.message);\n      throw apiError;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [apiClient]);\n\n  const getPrivacyStatus = useCallback(async (): Promise<PrivacyStatusResponse> => {\n    if (!apiClient) {\n      throw new Error('useAdminDeposits must be used within a CedrosLoginProvider');\n    }\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const data = await apiClient.get<PrivacyStatusResponse>('/admin/privacy/status');\n      return data;\n    } catch (err) {\n      const apiError = handleApiError(err, 'Failed to get privacy status');\n      setError(apiError.message);\n      throw apiError;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [apiClient]);\n\n  const getCreditStats = useCallback(async (): Promise<AdminCreditStatsResponse> => {\n    if (!apiClient) {\n      throw new Error('useAdminDeposits must be used within a CedrosLoginProvider');\n    }\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const data = await apiClient.get<AdminCreditStatsResponse>('/admin/credits/stats');\n      return data;\n    } catch (err) {\n      const apiError = handleApiError(err, 'Failed to get credit stats');\n      setError(apiError.message);\n      throw apiError;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [apiClient]);\n\n  return {\n    listDeposits,\n    getStats,\n    listInPrivacyPeriod,\n    listPendingWithdrawals,\n    processWithdrawal,\n    processAllWithdrawals,\n    getPrivacyStatus,\n    getCreditStats,\n    isLoading,\n    error,\n    clearError,\n  };\n}\n"],"names":["useAdminDeposits","context","useCedrosLoginOptional","isLoading","setIsLoading","useState","error","setError","apiClient","useMemo","ApiClient","clearError","useCallback","listDeposits","options","params","query","url","err","apiError","handleApiError","getStats","listInPrivacyPeriod","listPendingWithdrawals","processWithdrawal","sessionId","processAllWithdrawals","getPrivacyStatus","getCreditStats"],"mappings":"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"}