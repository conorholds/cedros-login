{"version":3,"file":"EmailSettings-CLMdw3rB.js","sources":["../src/components/admin/settings/EmailSettings.tsx"],"sourcesContent":["/**\n * Email settings page - SMTP configuration with provider-aware auto-fill\n */\nimport { useEffect, useMemo } from 'react';\nimport { LoadingSpinner } from '../../shared/LoadingSpinner';\nimport { ErrorMessage } from '../../shared/ErrorMessage';\nimport { useSettingsAutosave } from '../../../hooks/useSettingsAutosave';\nimport { SettingsSection } from './settingsInputs';\nimport { AutosaveStatus } from './AutosaveStatus';\n\n/** SMTP hosts auto-filled when selecting a known provider */\nexport const PROVIDER_SMTP_HOSTS: Record<string, string> = {\n  mailgun: 'smtp.mailgun.org',\n  sendgrid: 'smtp.sendgrid.net',\n  postmark: 'smtp.postmarkapp.com',\n  ses: 'email-smtp.us-east-1.amazonaws.com',\n  resend: 'smtp.resend.com',\n};\n\n/** Simplified fields for known providers (host/port/tls auto-configured) */\nexport const SIMPLIFIED_EMAIL_FIELDS = [\n  'email_provider',\n  'email_smtp_password',\n  'email_from_address',\n  'email_from_name',\n];\n\n/** All fields for custom SMTP */\nexport const ALL_EMAIL_FIELDS = [\n  'email_provider',\n  'email_smtp_host',\n  'email_smtp_port',\n  'email_smtp_user',\n  'email_smtp_password',\n  'email_smtp_tls',\n  'email_from_address',\n  'email_from_name',\n];\n\nexport interface EmailSettingsProps {\n  className?: string;\n}\n\nexport function EmailSettings({ className }: EmailSettingsProps) {\n  const {\n    settings,\n    edits,\n    isLoading,\n    autosaveStatus,\n    autosaveError,\n    error,\n    fetchSettings,\n    handleChange,\n    getEffectiveValue,\n  } = useSettingsAutosave();\n\n  useEffect(() => {\n    fetchSettings();\n  }, [fetchSettings]);\n\n  const emailProvider = getEffectiveValue('email_provider') || 'custom';\n  const isCustomProvider = emailProvider === 'custom';\n\n  // Check if SMTP is configured\n  const smtpHost = getEffectiveValue('email_smtp_host');\n  const isSmtpConfigured = !isCustomProvider || (smtpHost != null && smtpHost !== '');\n\n  // Filter and order fields based on provider mode\n  const currentSettings = useMemo(() => {\n    const categorySettings = settings['email'] ?? [];\n    const fieldsToShow = isCustomProvider ? ALL_EMAIL_FIELDS : SIMPLIFIED_EMAIL_FIELDS;\n    return categorySettings\n      .filter((s) => fieldsToShow.includes(s.key))\n      .sort((a, b) => fieldsToShow.indexOf(a.key) - fieldsToShow.indexOf(b.key));\n  }, [settings, isCustomProvider]);\n\n  // Auto-set SMTP host/port/tls when provider changes\n  const handleProviderAwareChange = (key: string, value: string) => {\n    handleChange(key, value);\n    if (key === 'email_provider' && value !== 'custom') {\n      const host = PROVIDER_SMTP_HOSTS[value];\n      if (host) {\n        handleChange('email_smtp_host', host);\n        handleChange('email_smtp_port', '587');\n        handleChange('email_smtp_tls', 'true');\n      }\n    }\n  };\n\n  if (isLoading && Object.keys(settings).length === 0) {\n    return (\n      <div className={`cedros-system-settings cedros-system-settings-loading ${className ?? ''}`}>\n        <LoadingSpinner />\n        <span>Loading settings...</span>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className={`cedros-system-settings ${className ?? ''}`}>\n        <ErrorMessage error={error.message} />\n      </div>\n    );\n  }\n\n  return (\n    <div className={`cedros-system-settings ${className ?? ''}`}>\n      <div className=\"cedros-settings-page-header\">\n        <div className=\"cedros-settings-page-header-content\">\n          <h2 className=\"cedros-settings-page-title\">Email & SMTP</h2>\n          <p className=\"cedros-settings-page-description\">\n            Configure email delivery for verification emails, password resets, and instant link\n            login.\n          </p>\n        </div>\n        <AutosaveStatus status={autosaveStatus} error={autosaveError} />\n      </div>\n\n      {!isSmtpConfigured && (\n        <div className=\"cedros-settings-warning-banner\">\n          Email features (verification, password reset, instant link) are disabled until SMTP is\n          configured. Select a provider or enter custom SMTP settings below.\n        </div>\n      )}\n\n      {currentSettings.length === 0 ? (\n        <div className=\"cedros-system-settings-empty\">\n          <p>No settings found for this section.</p>\n        </div>\n      ) : (\n        <SettingsSection\n          settings={currentSettings}\n          edits={edits}\n          onChange={handleProviderAwareChange}\n        />\n      )}\n    </div>\n  );\n}\n"],"names":["PROVIDER_SMTP_HOSTS","SIMPLIFIED_EMAIL_FIELDS","ALL_EMAIL_FIELDS","EmailSettings","className","settings","edits","isLoading","autosaveStatus","autosaveError","error","fetchSettings","handleChange","getEffectiveValue","useSettingsAutosave","useEffect","isCustomProvider","smtpHost","isSmtpConfigured","currentSettings","useMemo","categorySettings","fieldsToShow","s","a","b","handleProviderAwareChange","key","value","host","jsx","LoadingSpinner","ErrorMessage","jsxs","AutosaveStatus","SettingsSection"],"mappings":"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"}