{"version":3,"file":"sanitization-Bo_tn-L2.cjs","sources":["../src/utils/sanitization.ts"],"sourcesContent":["/**\n * Input sanitization utilities for security\n */\n\n/**\n * Allowed image URL protocols\n */\nconst SAFE_PROTOCOLS = ['https:'];\n\n/**\n * Dangerous protocols that should never be allowed\n */\nconst DANGEROUS_PROTOCOLS = ['javascript:', 'data:', 'vbscript:', 'file:'];\n\n/**\n * Sanitizes an image URL to prevent XSS and other attacks.\n *\n * ## Security Properties\n *\n * - Only allows HTTPS URLs (prevents protocol-based attacks)\n * - Blocks javascript:, data:, vbscript:, file: protocols\n * - Returns undefined for invalid URLs\n *\n * ## Limitations (S-20/SEC-08)\n *\n * This function validates the URL protocol but does NOT validate the domain.\n * Any HTTPS URL will pass validation, including URLs from untrusted domains.\n * This is intentional - domain allowlisting is application-specific and should\n * be implemented at the consumer level (see example below).\n *\n * If your application requires domain validation (e.g., only allowing images\n * from trusted CDNs), implement additional validation:\n *\n * @example Domain allowlisting (application-level)\n * ```ts\n * const ALLOWED_DOMAINS = ['cdn.example.com', 'images.trusted.org'];\n *\n * function isAllowedImageUrl(url: string): boolean {\n *   const sanitized = sanitizeImageUrl(url);\n *   if (!sanitized) return false;\n *\n *   try {\n *     const hostname = new URL(sanitized).hostname;\n *     return ALLOWED_DOMAINS.some(d => hostname === d || hostname.endsWith('.' + d));\n *   } catch {\n *     return false;\n *   }\n * }\n * ```\n *\n * @param url - The URL to sanitize\n * @returns The sanitized URL or undefined if invalid\n *\n * @example Basic usage\n * ```ts\n * sanitizeImageUrl('https://example.com/avatar.png') // 'https://example.com/avatar.png'\n * sanitizeImageUrl('javascript:alert(1)') // undefined\n * sanitizeImageUrl('data:image/svg+xml,...') // undefined\n * ```\n */\nexport function sanitizeImageUrl(url: string | undefined | null): string | undefined {\n  if (!url || typeof url !== 'string') {\n    return undefined;\n  }\n\n  // Trim whitespace\n  const trimmedUrl = url.trim();\n  if (!trimmedUrl) {\n    return undefined;\n  }\n\n  // Check for dangerous protocols (case-insensitive)\n  const lowerUrl = trimmedUrl.toLowerCase();\n  for (const protocol of DANGEROUS_PROTOCOLS) {\n    if (lowerUrl.startsWith(protocol)) {\n      return undefined;\n    }\n  }\n\n  // Try to parse as URL\n  try {\n    const parsed = new URL(trimmedUrl);\n\n    // Only allow safe protocols\n    if (!SAFE_PROTOCOLS.includes(parsed.protocol)) {\n      return undefined;\n    }\n\n    // Return the original URL (preserves case)\n    return trimmedUrl;\n  } catch {\n    // Invalid URL\n    return undefined;\n  }\n}\n\n/**\n * Sanitizes an external link URL for use in href attributes.\n *\n * Security goals:\n * - Block dangerous protocols (javascript:, data:, vbscript:, file:)\n * - Only allow http/https absolute URLs\n */\nexport function sanitizeExternalUrl(url: string | undefined | null): string | undefined {\n  if (!url || typeof url !== 'string') {\n    return undefined;\n  }\n\n  const trimmedUrl = url.trim();\n  if (!trimmedUrl) {\n    return undefined;\n  }\n\n  const lowerUrl = trimmedUrl.toLowerCase();\n  for (const protocol of DANGEROUS_PROTOCOLS) {\n    if (lowerUrl.startsWith(protocol)) {\n      return undefined;\n    }\n  }\n\n  try {\n    const parsed = new URL(trimmedUrl);\n    if (parsed.protocol !== 'https:' && parsed.protocol !== 'http:') {\n      return undefined;\n    }\n    return trimmedUrl;\n  } catch {\n    return undefined;\n  }\n}\n\n/**\n * Sanitizes user-provided text to prevent XSS in text content.\n * Escapes HTML special characters.\n *\n * @param text - The text to sanitize\n * @returns The sanitized text\n */\nexport function sanitizeText(text: string | undefined | null): string {\n  if (!text || typeof text !== 'string') {\n    return '';\n  }\n\n  return text\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#x27;');\n}\n"],"names":["SAFE_PROTOCOLS","DANGEROUS_PROTOCOLS","sanitizeImageUrl","url","trimmedUrl","lowerUrl","protocol","parsed","sanitizeExternalUrl"],"mappings":"aAOA,MAAMA,EAAiB,CAAC,QAAQ,EAK1BC,EAAsB,CAAC,cAAe,QAAS,YAAa,OAAO,EAgDlE,SAASC,EAAiBC,EAAoD,CACnF,GAAI,CAACA,GAAO,OAAOA,GAAQ,SACzB,OAIF,MAAMC,EAAaD,EAAI,KAAA,EACvB,GAAI,CAACC,EACH,OAIF,MAAMC,EAAWD,EAAW,YAAA,EAC5B,UAAWE,KAAYL,EACrB,GAAII,EAAS,WAAWC,CAAQ,EAC9B,OAKJ,GAAI,CACF,MAAMC,EAAS,IAAI,IAAIH,CAAU,EAGjC,OAAKJ,EAAe,SAASO,EAAO,QAAQ,EAKrCH,EAJL,MAKJ,MAAQ,CAEN,MACF,CACF,CASO,SAASI,EAAoBL,EAAoD,CACtF,GAAI,CAACA,GAAO,OAAOA,GAAQ,SACzB,OAGF,MAAMC,EAAaD,EAAI,KAAA,EACvB,GAAI,CAACC,EACH,OAGF,MAAMC,EAAWD,EAAW,YAAA,EAC5B,UAAWE,KAAYL,EACrB,GAAII,EAAS,WAAWC,CAAQ,EAC9B,OAIJ,GAAI,CACF,MAAMC,EAAS,IAAI,IAAIH,CAAU,EACjC,OAAIG,EAAO,WAAa,UAAYA,EAAO,WAAa,QACtD,OAEKH,CACT,MAAQ,CACN,MACF,CACF"}