{"version":3,"file":"UsersSection-C2U8Tb7V.cjs","sources":["../src/admin/sections/UsersSection.tsx"],"sourcesContent":["/**\n * Users Section - Plugin wrapper\n *\n * Admin user management with list and detail views.\n */\n\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport type { AdminSectionProps } from '../types';\nimport { AdminUserList } from '../../components/admin/AdminUserList';\nimport { AdminUserDetail } from '../../components/admin/AdminUserDetail';\nimport { StatsBar } from '../../components/admin/StatsBar';\nimport { useAdminUsers } from '../../hooks/useAdminUsers';\nimport { useSystemSettings } from '../../hooks/useSystemSettings';\nimport type { AdminUser, AdminUserStatsResponse } from '../../types';\n\nconst METHOD_ORDER = ['email', 'google', 'apple', 'solana', 'webauthn', 'sso'] as const;\n\nconst METHOD_LABELS: Record<(typeof METHOD_ORDER)[number], string> = {\n  email: 'Email Users',\n  google: 'Google Users',\n  apple: 'Apple Users',\n  solana: 'Solana Users',\n  webauthn: 'Passkey Users',\n  sso: 'SSO Provider Users',\n};\n\nconst METHOD_SETTINGS: Record<(typeof METHOD_ORDER)[number], string> = {\n  email: 'auth_email_enabled',\n  google: 'auth_google_enabled',\n  apple: 'auth_apple_enabled',\n  solana: 'auth_solana_enabled',\n  webauthn: 'auth_webauthn_enabled',\n  sso: 'feature_sso',\n};\n\nfunction useUsersStats() {\n  const { getStats } = useAdminUsers();\n  const { fetchSettings, getValue } = useSystemSettings();\n  const [stats, setStats] = useState<AdminUserStatsResponse | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [settingsFetched, setSettingsFetched] = useState(false);\n\n  useEffect(() => {\n    if (!settingsFetched) {\n      fetchSettings();\n      setSettingsFetched(true);\n    }\n  }, [fetchSettings, settingsFetched]);\n\n  const isSettingEnabled = useCallback(\n    (key: string): boolean => {\n      const value = getValue(key);\n      if (value === undefined) return false;\n      return value === 'true' || value === '1';\n    },\n    [getValue]\n  );\n\n  const fetchStats = useCallback(async () => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const result = await getStats();\n      setStats(result);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to load user stats');\n    } finally {\n      setIsLoading(false);\n    }\n  }, [getStats]);\n\n  useEffect(() => {\n    fetchStats();\n  }, [fetchStats]);\n\n  const statsItems = useMemo(() => {\n    const items = [{ label: 'Total Users', value: stats?.total ?? 'â€”' }];\n\n    METHOD_ORDER.forEach((method) => {\n      if (!isSettingEnabled(METHOD_SETTINGS[method])) return;\n      items.push({\n        label: METHOD_LABELS[method],\n        value: stats?.authMethodCounts[method] ?? 0,\n      });\n    });\n\n    return items;\n  }, [stats, isSettingEnabled]);\n\n  return { statsItems, isLoading, error, refresh: fetchStats };\n}\n\nexport default function UsersSection({\n  pluginContext,\n  pageSize = 20,\n}: AdminSectionProps): React.JSX.Element {\n  const [selectedUser, setSelectedUser] = useState<AdminUser | null>(null);\n  const { statsItems, isLoading, error, refresh } = useUsersStats();\n\n  if (selectedUser) {\n    return (\n      <div className=\"cedros-dashboard__section\">\n        <AdminUserDetail\n          userId={selectedUser.id}\n          onBack={() => setSelectedUser(null)}\n          currentUserId={pluginContext.userId}\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"cedros-dashboard__section\">\n      <StatsBar stats={statsItems} isLoading={isLoading} onRefresh={refresh} />\n      {error && <p className=\"cedros-admin-error-inline\">{error}</p>}\n      <p className=\"cedros-dashboard__text-muted\">\n        All registered users in the system. Requires system admin privileges.\n      </p>\n      <AdminUserList\n        pageSize={pageSize}\n        currentUserId={pluginContext.userId}\n        onUserClick={(user) => setSelectedUser(user)}\n      />\n    </div>\n  );\n}\n"],"names":["METHOD_ORDER","METHOD_LABELS","METHOD_SETTINGS","useUsersStats","getStats","useAdminUsers","fetchSettings","getValue","useSystemSettings","stats","setStats","useState","isLoading","setIsLoading","error","setError","settingsFetched","setSettingsFetched","useEffect","isSettingEnabled","useCallback","key","value","fetchStats","result","err","useMemo","items","method","UsersSection","pluginContext","pageSize","selectedUser","setSelectedUser","statsItems","refresh","jsx","AdminUserDetail","jsxs","StatsBar","AdminUserList","user"],"mappings":"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"}