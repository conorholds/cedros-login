{"version":3,"file":"EmailRegisterForm-CxktR-4J.cjs","sources":["../src/hooks/useRateLimiter.ts","../src/hooks/useEmailAuth.ts","../src/hooks/useInstantLink.ts","../src/components/email/PasswordInput.tsx","../src/hooks/useTotpVerify.ts","../src/components/totp/OtpInput.tsx","../src/components/totp/TotpVerify.tsx","../src/components/email/EmailLoginForm.tsx","../src/components/email/EmailRegisterForm.tsx"],"sourcesContent":["import { useRef, useCallback, useState, useEffect } from 'react';\n\nexport interface UseRateLimiterOptions {\n  /** Maximum number of attempts allowed within the window */\n  maxAttempts?: number;\n  /** Time window in milliseconds */\n  windowMs?: number;\n  /**\n   * UI-25: Set to true to enable the 1s countdown interval for displaying\n   * time-until-reset in the UI. When false (default), no interval is started,\n   * saving resources for callers that don't display a countdown.\n   */\n  showCountdown?: boolean;\n}\n\nexport interface UseRateLimiterReturn {\n  /**\n   * Check if an action is allowed. Throws an error if rate limited.\n   * Call this before performing the action.\n   */\n  checkLimit: () => void;\n  /**\n   * Check if an action is allowed without throwing.\n   * Returns true if allowed, false if rate limited.\n   */\n  isAllowed: () => boolean;\n  /**\n   * Get remaining attempts in current window\n   */\n  getRemainingAttempts: () => number;\n  /**\n   * Get time until rate limit resets (in ms)\n   */\n  getTimeUntilReset: () => number;\n  /**\n   * Reset the rate limiter (e.g., after successful action)\n   */\n  reset: () => void;\n}\n\n/**\n * Rate limiting hook to prevent excessive API calls from the client.\n *\n * @param options - Rate limiter configuration\n * @returns Rate limiter functions\n *\n * @example\n * ```tsx\n * function LoginForm() {\n *   const { checkLimit, getRemainingAttempts } = useRateLimiter({\n *     maxAttempts: 5,\n *     windowMs: 60000, // 1 minute\n *   });\n *\n *   const handleLogin = async () => {\n *     try {\n *       checkLimit(); // Throws if rate limited\n *       await login(email, password);\n *     } catch (err) {\n *       if (err.message.includes('Too many attempts')) {\n *         // Show rate limit message\n *       }\n *     }\n *   };\n * }\n * ```\n */\nexport function useRateLimiter(options: UseRateLimiterOptions = {}): UseRateLimiterReturn {\n  const { maxAttempts = 5, windowMs = 60000, showCountdown = false } = options;\n\n  // Store timestamps of recent attempts\n  const attemptsRef = useRef<number[]>([]);\n  const [hasAttempts, setHasAttempts] = useState(false);\n  const [, setTick] = useState(0);\n\n  const bump = useCallback(() => {\n    setTick((value) => value + 1);\n  }, []);\n\n  /**\n   * Remove expired attempts from the tracking array (no state update).\n   * Safe to call during render for getter functions.\n   */\n  const cleanupAttemptsArray = useCallback(() => {\n    const now = Date.now();\n    attemptsRef.current = attemptsRef.current.filter((timestamp) => now - timestamp < windowMs);\n  }, [windowMs]);\n\n  /**\n   * Remove expired attempts AND update hasAttempts state.\n   * M-04: Use functional setState to avoid hasAttempts dependency cascade.\n   * Only call from event handlers and effects, NOT during render.\n   */\n  const cleanupExpiredAttempts = useCallback(() => {\n    cleanupAttemptsArray();\n    // Functional update avoids dependency on hasAttempts\n    setHasAttempts((current) => (attemptsRef.current.length === 0 && current ? false : current));\n  }, [cleanupAttemptsArray]);\n\n  /**\n   * Get the number of remaining attempts\n   * Uses cleanupAttemptsArray (no state) so safe to call during render.\n   */\n  const getRemainingAttempts = useCallback((): number => {\n    cleanupAttemptsArray();\n    return Math.max(0, maxAttempts - attemptsRef.current.length);\n  }, [cleanupAttemptsArray, maxAttempts]);\n\n  /**\n   * Get time until rate limit resets\n   * Uses cleanupAttemptsArray (no state) so safe to call during render.\n   */\n  const getTimeUntilReset = useCallback((): number => {\n    cleanupAttemptsArray();\n    if (attemptsRef.current.length === 0) {\n      return 0;\n    }\n    const oldestAttempt = attemptsRef.current[0];\n    const resetTime = oldestAttempt + windowMs;\n    return Math.max(0, resetTime - Date.now());\n  }, [cleanupAttemptsArray, windowMs]);\n\n  /**\n   * Check if an action is allowed without throwing\n   * Uses cleanupAttemptsArray (no state) so safe to call during render.\n   */\n  const isAllowed = useCallback((): boolean => {\n    cleanupAttemptsArray();\n    return attemptsRef.current.length < maxAttempts;\n  }, [cleanupAttemptsArray, maxAttempts]);\n\n  /**\n   * Check rate limit and throw if exceeded\n   */\n  const checkLimit = useCallback((): void => {\n    cleanupExpiredAttempts();\n\n    if (attemptsRef.current.length >= maxAttempts) {\n      const waitTime = getTimeUntilReset();\n      const waitSeconds = Math.ceil(waitTime / 1000);\n      throw new Error(\n        `Too many attempts. Please wait ${waitSeconds} second${waitSeconds === 1 ? '' : 's'} before trying again.`\n      );\n    }\n\n    // Record this attempt\n    attemptsRef.current.push(Date.now());\n    // M-04: Functional update avoids hasAttempts dependency\n    setHasAttempts((current) => (current ? current : true));\n    bump();\n  }, [cleanupExpiredAttempts, maxAttempts, getTimeUntilReset, bump]);\n\n  /**\n   * Reset the rate limiter\n   */\n  const reset = useCallback((): void => {\n    attemptsRef.current = [];\n    // M-04: Functional update avoids hasAttempts dependency\n    setHasAttempts((current) => (current ? false : current));\n    bump();\n  }, [bump]);\n\n  // UI-25: Only start the 1s interval when the caller opts into countdown display.\n  // This avoids a tick firing every second for all callers that don't show a countdown.\n  useEffect(() => {\n    if (!hasAttempts || !showCountdown) return;\n    const intervalId = window.setInterval(() => {\n      cleanupExpiredAttempts();\n      bump();\n    }, 1000);\n    return () => {\n      window.clearInterval(intervalId);\n    };\n  }, [hasAttempts, showCountdown, bump, cleanupExpiredAttempts]);\n\n  return {\n    checkLimit,\n    isAllowed,\n    getRemainingAttempts,\n    getTimeUntilReset,\n    reset,\n  };\n}\n","import { useState, useCallback, useMemo } from 'react';\nimport { useCedrosLogin } from '../context/useCedrosLogin';\nimport { ApiClient, handleApiError } from '../utils/apiClient';\nimport { validateEmail } from '../utils/validation';\nimport { useRateLimiter } from './useRateLimiter';\nimport type { AuthResponse, AuthError } from '../types';\nimport type { MfaRequiredResponse } from '../types';\n\nfunction isMfaRequiredResponse(\n  response: AuthResponse | MfaRequiredResponse\n): response is MfaRequiredResponse {\n  return 'mfaRequired' in response && response.mfaRequired === true;\n}\n\n/** Result when MFA verification is required */\nexport interface MfaRequiredResult {\n  mfaRequired: true;\n  mfaToken: string;\n  email: string;\n  userId: string;\n}\n\n/** Result of successful login (no TOTP required or after TOTP verification) */\nexport interface LoginSuccessResult {\n  mfaRequired: false;\n  response: AuthResponse;\n}\n\n/** Union type for login result */\nexport type LoginResult = MfaRequiredResult | LoginSuccessResult;\n\nexport interface UseEmailAuthReturn {\n  /** Login - may return mfaRequired if 2FA is enabled */\n  login: (email: string, password: string) => Promise<LoginResult>;\n  register: (email: string, password: string, name?: string) => Promise<AuthResponse>;\n  isLoading: boolean;\n  error: AuthError | null;\n  clearError: () => void;\n  /**\n   * Number of remaining login attempts before rate limiting.\n   *\n   * M-10: Snapshot Behavior\n   * This value is a point-in-time snapshot computed at render time.\n   * It may be briefly stale during rapid requests or concurrent renders.\n   * For UI display only - actual rate limiting is enforced inside login/register.\n   */\n  remainingAttempts: number;\n  /**\n   * Time in ms until rate limit resets (0 if not rate limited).\n   *\n   * M-10: Snapshot Behavior\n   * This value is a point-in-time snapshot computed at render time.\n   * It may be briefly stale - use for UI display, not for logic decisions.\n   */\n  timeUntilReset: number;\n}\n\n/**\n * Hook for email/password authentication.\n *\n * @example\n * ```tsx\n * function LoginForm() {\n *   const { login, isLoading, error } = useEmailAuth();\n *\n *   const handleSubmit = async (e) => {\n *     e.preventDefault();\n *     try {\n *       await login(email, password);\n *     } catch (err) {\n *       // Handle error\n *     }\n *   };\n * }\n * ```\n */\nexport function useEmailAuth(): UseEmailAuthReturn {\n  const { config, _internal } = useCedrosLogin();\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<AuthError | null>(null);\n\n  // Rate limiter for login attempts (5 attempts per minute)\n  const {\n    checkLimit,\n    getRemainingAttempts,\n    getTimeUntilReset,\n    reset: resetRateLimit,\n  } = useRateLimiter({ maxAttempts: 5, windowMs: 60000 });\n\n  const apiClient = useMemo(\n    () =>\n      new ApiClient({\n        baseUrl: config.serverUrl,\n        timeoutMs: config.requestTimeout,\n        retryAttempts: config.retryAttempts,\n      }),\n    [config.serverUrl, config.requestTimeout, config.retryAttempts]\n  );\n\n  const callbacks = config.callbacks;\n  const walletEnrollmentEnabled = config.features?.walletEnrollment !== false;\n  const serverUrl = config.serverUrl;\n\n  const login = useCallback(\n    async (email: string, password: string): Promise<LoginResult> => {\n      // Validate email format before API call\n      if (!validateEmail(email)) {\n        const validationError: AuthError = {\n          code: 'VALIDATION_ERROR',\n          message: 'Please enter a valid email address',\n        };\n        setError(validationError);\n        throw validationError;\n      }\n\n      // UI-7: Rate limit is checked BEFORE API call intentionally.\n      // This prevents brute force attacks by limiting attempt frequency,\n      // not just successful request frequency.\n      try {\n        checkLimit();\n      } catch (err) {\n        const rateLimitError: AuthError = {\n          code: 'RATE_LIMITED',\n          message: err instanceof Error ? err.message : 'Too many attempts',\n        };\n        setError(rateLimitError);\n        throw rateLimitError;\n      }\n\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const data = await apiClient.post<AuthResponse | MfaRequiredResponse>('/login', {\n          email,\n          password,\n        });\n\n        // Check if MFA verification is required\n        if (isMfaRequiredResponse(data)) {\n          return {\n            mfaRequired: true,\n            mfaToken: data.mfaToken,\n            email,\n            userId: data.userId,\n          };\n        }\n\n        // Normal login success\n        const authResponse: AuthResponse = data;\n        callbacks?.onLoginSuccess?.(authResponse.user, 'email');\n        _internal?.handleLoginSuccess(authResponse.user, authResponse.tokens);\n        resetRateLimit(); // Reset on successful login\n        return {\n          mfaRequired: false,\n          response: authResponse,\n        };\n      } catch (err) {\n        const authError = handleApiError(err, 'Login failed');\n        setError(authError);\n        throw authError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [apiClient, callbacks, _internal, checkLimit, resetRateLimit]\n  );\n\n  const register = useCallback(\n    async (email: string, password: string, name?: string): Promise<AuthResponse> => {\n      // Validate email format before API call\n      if (!validateEmail(email)) {\n        const validationError: AuthError = {\n          code: 'VALIDATION_ERROR',\n          message: 'Please enter a valid email address',\n        };\n        setError(validationError);\n        throw validationError;\n      }\n\n      // UI-7: Rate limit is checked BEFORE API call intentionally.\n      // This prevents brute force attacks by limiting attempt frequency,\n      // not just successful request frequency.\n      try {\n        checkLimit();\n      } catch (err) {\n        const rateLimitError: AuthError = {\n          code: 'RATE_LIMITED',\n          message: err instanceof Error ? err.message : 'Too many attempts',\n        };\n        setError(rateLimitError);\n        throw rateLimitError;\n      }\n\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const data = await apiClient.post<AuthResponse>('/register', { email, password, name });\n        callbacks?.onLoginSuccess?.(data.user, 'email');\n        _internal?.handleLoginSuccess(data.user, data.tokens);\n        resetRateLimit(); // Reset on successful registration\n\n        // Auto-enroll embedded wallet in background (don't block registration)\n        // Uses password for Share A encryption. Recovery phrase can be retrieved later.\n        // UI-09: In cookie mode the accessToken is absent; add a short delay to allow\n        // the session cookie to be written before the enroll request is sent.\n        if (walletEnrollmentEnabled) {\n          const accessToken = data.tokens?.accessToken ?? '';\n          const isCookieMode = !accessToken;\n          const enrollDelay = isCookieMode ? 200 : 0;\n          void new Promise<void>((resolve) => setTimeout(resolve, enrollDelay))\n            .then(() => import('../utils/silentWalletEnroll'))\n            .then(({ silentWalletEnroll }) =>\n              silentWalletEnroll({\n                password,\n                serverUrl,\n                accessToken,\n              })\n            )\n            .then((result) => {\n              if (!result.success) {\n                // Log auto-enrollment failures for debugging\n                console.warn('[useEmailAuth] Wallet auto-enrollment failed:', result.error);\n              }\n            })\n            .catch((err) => {\n              const message = err instanceof Error ? err.message : 'Unknown error';\n              // Log enrollment errors for debugging\n              console.warn('[useEmailAuth] Wallet auto-enrollment unavailable:', message);\n            });\n        }\n\n        return data;\n      } catch (err) {\n        const authError = handleApiError(err, 'Registration failed');\n        setError(authError);\n        throw authError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [\n      apiClient,\n      callbacks,\n      _internal,\n      checkLimit,\n      resetRateLimit,\n      serverUrl,\n      walletEnrollmentEnabled,\n    ]\n  );\n\n  const clearError = useCallback(() => setError(null), []);\n\n  return {\n    login,\n    register,\n    isLoading,\n    error,\n    clearError,\n    // M-10: Point-in-time snapshots for UI display (see interface JSDoc)\n    remainingAttempts: getRemainingAttempts(),\n    timeUntilReset: getTimeUntilReset(),\n  };\n}\n","import { useState, useCallback, useMemo } from 'react';\nimport { useCedrosLogin } from '../context/useCedrosLogin';\nimport { validateEmail } from '../utils/validation';\nimport { useRateLimiter } from './useRateLimiter';\nimport { ApiClient, handleApiError } from '../utils/apiClient';\nimport type { AuthError, AuthResponse, MfaRequiredResponse } from '../types';\n\nfunction isMfaRequiredResponse(data: unknown): data is MfaRequiredResponse {\n  return (\n    typeof data === 'object' &&\n    data !== null &&\n    'mfaRequired' in data &&\n    (data as { mfaRequired?: unknown }).mfaRequired === true\n  );\n}\n\nexport interface UseInstantLinkReturn {\n  /** Send an instant link email to the given address */\n  sendInstantLink: (email: string) => Promise<void>;\n  /** Verify an instant link token and sign in */\n  verifyInstantLink: (token: string) => Promise<AuthResponse | MfaRequiredResponse>;\n  /** Whether a request is in progress */\n  isLoading: boolean;\n  /** Whether the instant link was sent successfully */\n  isSuccess: boolean;\n  /** Error from the last request */\n  error: AuthError | null;\n  /** Clear the error state */\n  clearError: () => void;\n  /** Reset to initial state */\n  reset: () => void;\n  /** Number of remaining attempts before rate limiting */\n  remainingAttempts: number;\n}\n\n/**\n * Hook for instant link (passwordless) authentication.\n *\n * Sends an instant link email that allows the user to sign in\n * without entering their password.\n *\n * @example\n * ```tsx\n * function InstantLinkForm() {\n *   const { sendInstantLink, isLoading, isSuccess, error } = useInstantLink();\n *\n *   const handleSubmit = async (e) => {\n *     e.preventDefault();\n *     await sendInstantLink(email);\n *   };\n *\n *   if (isSuccess) {\n *     return <p>Check your email for the sign-in link</p>;\n *   }\n * }\n * ```\n */\nexport function useInstantLink(): UseInstantLinkReturn {\n  const { config, _internal } = useCedrosLogin();\n  const [isLoading, setIsLoading] = useState(false);\n  const [isSuccess, setIsSuccess] = useState(false);\n  const [error, setError] = useState<AuthError | null>(null);\n\n  const apiClient = useMemo(\n    () =>\n      new ApiClient({\n        baseUrl: config.serverUrl,\n        timeoutMs: config.requestTimeout,\n        retryAttempts: config.retryAttempts,\n      }),\n    [config.serverUrl, config.requestTimeout, config.retryAttempts]\n  );\n\n  // Rate limiter for instant link attempts (3 attempts per 5 minutes)\n  const { checkLimit, getRemainingAttempts } = useRateLimiter({\n    maxAttempts: 3,\n    windowMs: 300000,\n  });\n\n  const sendInstantLink = useCallback(\n    async (email: string): Promise<void> => {\n      // Validate email format before API call\n      if (!validateEmail(email)) {\n        const validationError: AuthError = {\n          code: 'VALIDATION_ERROR',\n          message: 'Please enter a valid email address',\n        };\n        setError(validationError);\n        throw validationError;\n      }\n\n      // Check rate limit before API call\n      try {\n        checkLimit();\n      } catch (err) {\n        const rateLimitError: AuthError = {\n          code: 'RATE_LIMITED',\n          message: err instanceof Error ? err.message : 'Too many attempts',\n        };\n        setError(rateLimitError);\n        throw rateLimitError;\n      }\n\n      setIsLoading(true);\n      setError(null);\n      setIsSuccess(false);\n\n      try {\n        await apiClient.post('/instant-link', { email });\n        setIsSuccess(true);\n      } catch (err) {\n        const authError = handleApiError(err, 'Failed to send sign-in link');\n        setError(authError);\n        throw authError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [apiClient, checkLimit]\n  );\n\n  const verifyInstantLink = useCallback(\n    async (token: string): Promise<AuthResponse | MfaRequiredResponse> => {\n      if (!token || token.trim().length === 0) {\n        const validationError: AuthError = {\n          code: 'VALIDATION_ERROR',\n          message: 'Invalid or missing sign-in link token',\n        };\n        setError(validationError);\n        throw validationError;\n      }\n\n      setIsLoading(true);\n      setError(null);\n      setIsSuccess(false);\n\n      try {\n        const data = await apiClient.post<AuthResponse | MfaRequiredResponse>(\n          '/instant-link/verify',\n          {\n            token,\n          }\n        );\n\n        if (isMfaRequiredResponse(data)) {\n          return data;\n        }\n\n        // Successful login\n        config.callbacks?.onLoginSuccess?.(data.user, 'email');\n        _internal?.handleLoginSuccess(data.user, data.tokens);\n        return data;\n      } catch (err) {\n        const authError = handleApiError(err, 'Failed to verify sign-in link');\n        setError(authError);\n        throw authError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [apiClient, config.callbacks, _internal]\n  );\n\n  const clearError = useCallback(() => setError(null), []);\n\n  const reset = useCallback(() => {\n    setError(null);\n    setIsSuccess(false);\n    setIsLoading(false);\n  }, []);\n\n  return {\n    sendInstantLink,\n    verifyInstantLink,\n    isLoading,\n    isSuccess,\n    error,\n    clearError,\n    reset,\n    remainingAttempts: getRemainingAttempts(),\n  };\n}\n","import { useState, useId, type InputHTMLAttributes } from 'react';\nimport { validatePassword } from '../../utils/validation';\nimport type { PasswordValidation } from '../../types';\n\nexport interface PasswordInputProps extends Omit<InputHTMLAttributes<HTMLInputElement>, 'type'> {\n  label?: string;\n  /** Action element shown on the right side of the label (e.g., \"Forgot password?\" link) */\n  labelAction?: React.ReactNode;\n  showStrengthMeter?: boolean;\n  onValidationChange?: (validation: PasswordValidation) => void;\n  error?: string;\n}\n\n/**\n * Password input with visibility toggle and optional strength meter\n */\nexport function PasswordInput({\n  label = 'Password',\n  labelAction,\n  showStrengthMeter = false,\n  onValidationChange,\n  error,\n  className = '',\n  onChange,\n  value,\n  ...props\n}: PasswordInputProps) {\n  const [showPassword, setShowPassword] = useState(false);\n  const [validation, setValidation] = useState<PasswordValidation | null>(null);\n  const inputId = useId();\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const newValue = e.target.value;\n\n    if (showStrengthMeter || onValidationChange) {\n      const newValidation = validatePassword(newValue);\n      setValidation(newValidation);\n      onValidationChange?.(newValidation);\n    }\n\n    onChange?.(e);\n  };\n\n  const strengthColors = {\n    weak: 'var(--cedros-destructive, #ef4444)',\n    fair: 'var(--cedros-warning, #f59e0b)',\n    good: 'var(--cedros-success, #22c55e)',\n    strong: 'var(--cedros-success, #22c55e)',\n  };\n\n  return (\n    <div className={`cedros-password-input ${className}`}>\n      <div className=\"cedros-label-row\">\n        <label htmlFor={inputId} className=\"cedros-label\">\n          {label}\n        </label>\n        {labelAction}\n      </div>\n      <div className=\"cedros-password-wrapper\">\n        <input\n          id={inputId}\n          type={showPassword ? 'text' : 'password'}\n          className=\"cedros-input\"\n          onChange={handleChange}\n          value={value}\n          aria-invalid={error ? 'true' : undefined}\n          aria-describedby={error ? `${inputId}-error` : undefined}\n          {...props}\n        />\n        <button\n          type=\"button\"\n          className=\"cedros-password-toggle\"\n          onClick={() => setShowPassword(!showPassword)}\n          aria-label={showPassword ? 'Hide password' : 'Show password'}\n          aria-pressed={showPassword}\n        >\n          {showPassword ? (\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" aria-hidden=\"true\">\n              <path\n                d=\"M2.5 10s3-6 7.5-6 7.5 6 7.5 6-3 6-7.5 6-7.5-6-7.5-6z\"\n                stroke=\"currentColor\"\n                strokeWidth=\"1.5\"\n              />\n              <circle cx=\"10\" cy=\"10\" r=\"2.5\" stroke=\"currentColor\" strokeWidth=\"1.5\" />\n              <path d=\"M3 17L17 3\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" />\n            </svg>\n          ) : (\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" aria-hidden=\"true\">\n              <path\n                d=\"M2.5 10s3-6 7.5-6 7.5 6 7.5 6-3 6-7.5 6-7.5-6-7.5-6z\"\n                stroke=\"currentColor\"\n                strokeWidth=\"1.5\"\n              />\n              <circle cx=\"10\" cy=\"10\" r=\"2.5\" stroke=\"currentColor\" strokeWidth=\"1.5\" />\n            </svg>\n          )}\n        </button>\n      </div>\n\n      {error && (\n        <p id={`${inputId}-error`} className=\"cedros-input-error\">\n          {error}\n        </p>\n      )}\n\n      {showStrengthMeter && validation && (value as string)?.length > 0 && (\n        <div className=\"cedros-password-strength\">\n          <div className=\"cedros-strength-bar\">\n            <div\n              className=\"cedros-strength-fill\"\n              style={{\n                width: `${\n                  validation.strength === 'weak'\n                    ? 25\n                    : validation.strength === 'fair'\n                      ? 50\n                      : validation.strength === 'good'\n                        ? 75\n                        : 100\n                }%`,\n                backgroundColor: strengthColors[validation.strength],\n              }}\n            />\n          </div>\n          <span className=\"cedros-strength-label\">{validation.strength}</span>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useCallback, useMemo } from 'react';\nimport { useCedrosLogin } from '../context/useCedrosLogin';\nimport { ApiClient, handleApiError } from '../utils/apiClient';\nimport { useRateLimiter } from './useRateLimiter';\nimport type { AuthError, AuthResponse, TotpVerifyState } from '../types';\n\nexport interface UseTotpVerifyReturn {\n  /** Verification state */\n  state: TotpVerifyState;\n  /** Whether verification is in progress */\n  isLoading: boolean;\n  /** Error from the last request */\n  error: AuthError | null;\n  /** Verify MFA code during login */\n  verifyTotp: (mfaToken: string, code: string) => Promise<AuthResponse>;\n  /** Clear error state */\n  clearError: () => void;\n  /** Reset to initial state */\n  reset: () => void;\n  /** Number of remaining verification attempts before rate limiting */\n  remainingAttempts: number;\n  /** Time in ms until rate limit resets (0 if not rate limited) */\n  timeUntilReset: number;\n}\n\n/**\n * Hook for verifying TOTP codes during the login flow.\n *\n * Used when a user has TOTP enabled and needs to provide\n * their 6-digit code after password authentication.\n *\n * @example\n * ```tsx\n * function TotpVerifyStep({ mfaToken }) {\n *   const { verifyTotp, isLoading, error } = useTotpVerify();\n *\n *   const handleVerify = async (code: string) => {\n *     const response = await verifyTotp(mfaToken, code);\n *     // User is now authenticated\n *   };\n * }\n * ```\n */\nexport function useTotpVerify(): UseTotpVerifyReturn {\n  const { config, _internal } = useCedrosLogin();\n  const [state, setState] = useState<TotpVerifyState>('idle');\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<AuthError | null>(null);\n\n  // Rate limiter for TOTP verification (5 attempts per 2 minutes)\n  // Stricter than login to prevent brute force on short codes\n  const {\n    checkLimit,\n    getRemainingAttempts,\n    getTimeUntilReset,\n    reset: resetRateLimit,\n  } = useRateLimiter({ maxAttempts: 5, windowMs: 120000 });\n\n  const apiClient = useMemo(\n    () =>\n      new ApiClient({\n        baseUrl: config.serverUrl,\n        timeoutMs: config.requestTimeout,\n        retryAttempts: config.retryAttempts,\n      }),\n    [config.serverUrl, config.requestTimeout, config.retryAttempts]\n  );\n\n  const verifyTotp = useCallback(\n    async (mfaToken: string, code: string): Promise<AuthResponse> => {\n      // Validate code format (6 digits or recovery code)\n      const isRecoveryCode =\n        /^[A-Z0-9]{16}$/i.test(code) || /^[A-Z0-9]{4}(-[A-Z0-9]{4}){3}$/i.test(code);\n      const isValidCode = /^\\d{6}$/.test(code) || isRecoveryCode;\n      if (!isValidCode) {\n        const validationError: AuthError = {\n          code: 'VALIDATION_ERROR',\n          message: 'Please enter a valid 6-digit code or recovery code',\n        };\n        setError(validationError);\n        throw validationError;\n      }\n\n      // Rate limit check before API call to prevent brute force\n      try {\n        checkLimit();\n      } catch (err) {\n        const rateLimitError: AuthError = {\n          code: 'RATE_LIMITED',\n          message: err instanceof Error ? err.message : 'Too many attempts',\n        };\n        setError(rateLimitError);\n        throw rateLimitError;\n      }\n\n      setIsLoading(true);\n      setError(null);\n      setState('verifying');\n\n      try {\n        const response = await apiClient.post<AuthResponse>('/login/mfa', { mfaToken, code });\n\n        setState('success');\n        resetRateLimit(); // Reset on successful verification\n\n        // Complete authentication via internal API\n        if (_internal && response.user && response.tokens) {\n          _internal.handleLoginSuccess(response.user, response.tokens);\n        }\n\n        return response;\n      } catch (err) {\n        const authError = handleApiError(err, 'Invalid verification code');\n        setError(authError);\n        setState('error');\n        throw authError;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [apiClient, _internal, checkLimit, resetRateLimit]\n  );\n\n  const clearError = useCallback(() => setError(null), []);\n\n  const reset = useCallback(() => {\n    setError(null);\n    setState('idle');\n    setIsLoading(false);\n  }, []);\n\n  return {\n    state,\n    isLoading,\n    error,\n    verifyTotp,\n    clearError,\n    reset,\n    // Point-in-time snapshots for UI display\n    remainingAttempts: getRemainingAttempts(),\n    timeUntilReset: getTimeUntilReset(),\n  };\n}\n","/**\n * OTP Input component (shadcn-style)\n *\n * A 6-digit input with separate boxes for each digit,\n * designed for TOTP verification codes.\n */\n\nimport { useRef, useCallback, useState, useEffect, useId } from 'react';\n\n/** Number of OTP digits */\nconst OTP_LENGTH = 6;\n\nexport interface OtpInputProps {\n  /** Current value (up to 6 digits) */\n  value?: string;\n  /** Called when the value changes */\n  onChange?: (value: string) => void;\n  /** Called when all 6 digits are entered */\n  onComplete?: (value: string) => void;\n  /** Whether the input is disabled */\n  disabled?: boolean;\n  /** Error message to display */\n  error?: string;\n  /** Auto-focus the first input on mount */\n  autoFocus?: boolean;\n  /** Additional CSS class */\n  className?: string;\n}\n\n/**\n * OTP input with separate boxes for each digit (shadcn pattern)\n *\n * Features:\n * - Auto-advances to next input on digit entry\n * - Backspace moves to previous input\n * - Supports paste of full code\n * - Numeric keyboard on mobile\n */\nexport function OtpInput({\n  value = '',\n  onChange,\n  onComplete,\n  disabled = false,\n  error,\n  autoFocus = false,\n  className = '',\n}: OtpInputProps) {\n  const inputRefs = useRef<(HTMLInputElement | null)[]>([]);\n  const [localValue, setLocalValue] = useState(value.padEnd(OTP_LENGTH, ''));\n  const id = useId();\n\n  // Sync with controlled value\n  useEffect(() => {\n    setLocalValue(value.padEnd(OTP_LENGTH, ''));\n  }, [value]);\n\n  const focusInput = useCallback((index: number) => {\n    if (index >= 0 && index < OTP_LENGTH) {\n      inputRefs.current[index]?.focus();\n    }\n  }, []);\n\n  const updateValue = useCallback(\n    (newValue: string) => {\n      const sanitized = newValue.replace(/\\D/g, '').slice(0, OTP_LENGTH);\n      setLocalValue(sanitized.padEnd(OTP_LENGTH, ''));\n      onChange?.(sanitized);\n\n      if (sanitized.length === OTP_LENGTH) {\n        onComplete?.(sanitized);\n      }\n    },\n    [onChange, onComplete]\n  );\n\n  const handleChange = useCallback(\n    (index: number, digit: string) => {\n      if (!/^\\d?$/.test(digit)) return;\n\n      const chars = localValue.split('');\n      chars[index] = digit;\n      const newValue = chars.join('').replace(/ /g, '');\n      updateValue(newValue);\n\n      // Move to next input if digit entered\n      if (digit && index < OTP_LENGTH - 1) {\n        focusInput(index + 1);\n      }\n    },\n    [localValue, updateValue, focusInput]\n  );\n\n  const handleKeyDown = useCallback(\n    (index: number, e: React.KeyboardEvent<HTMLInputElement>) => {\n      if (e.key === 'Backspace') {\n        e.preventDefault();\n        const chars = localValue.split('');\n\n        if (chars[index] && chars[index] !== ' ') {\n          // Clear current digit\n          chars[index] = ' ';\n          updateValue(chars.join('').replace(/ /g, ''));\n        } else if (index > 0) {\n          // Move to previous and clear it\n          chars[index - 1] = ' ';\n          updateValue(chars.join('').replace(/ /g, ''));\n          focusInput(index - 1);\n        }\n      } else if (e.key === 'ArrowLeft' && index > 0) {\n        e.preventDefault();\n        focusInput(index - 1);\n      } else if (e.key === 'ArrowRight' && index < OTP_LENGTH - 1) {\n        e.preventDefault();\n        focusInput(index + 1);\n      }\n    },\n    [localValue, updateValue, focusInput]\n  );\n\n  const handlePaste = useCallback(\n    (e: React.ClipboardEvent) => {\n      e.preventDefault();\n      const pasted = e.clipboardData.getData('text');\n      const digits = pasted.replace(/\\D/g, '').slice(0, OTP_LENGTH);\n      if (digits) {\n        updateValue(digits);\n        // Focus the next empty slot or the last one\n        focusInput(Math.min(digits.length, OTP_LENGTH - 1));\n      }\n    },\n    [updateValue, focusInput]\n  );\n\n  const handleFocus = useCallback((e: React.FocusEvent<HTMLInputElement>) => {\n    e.target.select();\n  }, []);\n\n  // Auto-focus first input\n  useEffect(() => {\n    if (autoFocus && !disabled) {\n      inputRefs.current[0]?.focus();\n    }\n  }, [autoFocus, disabled]);\n\n  return (\n    <div className={`cedros-otp-input ${className}`}>\n      <div className=\"cedros-otp-slots\" role=\"group\" aria-label=\"One-time password\">\n        {Array.from({ length: OTP_LENGTH }).map((_, index) => (\n          <input\n            key={index}\n            ref={(el) => {\n              inputRefs.current[index] = el;\n            }}\n            id={`${id}-${index}`}\n            type=\"text\"\n            inputMode=\"numeric\"\n            pattern=\"[0-9]*\"\n            maxLength={1}\n            className={`cedros-otp-slot ${error ? 'cedros-otp-slot-error' : ''}`}\n            value={localValue[index] === ' ' ? '' : localValue[index] || ''}\n            onChange={(e) => handleChange(index, e.target.value)}\n            onKeyDown={(e) => handleKeyDown(index, e)}\n            onPaste={handlePaste}\n            onFocus={handleFocus}\n            disabled={disabled}\n            autoComplete=\"one-time-code\"\n            aria-label={`Digit ${index + 1}`}\n            aria-invalid={error ? 'true' : undefined}\n          />\n        ))}\n      </div>\n      {error && (\n        <p className=\"cedros-otp-error\" role=\"alert\">\n          {error}\n        </p>\n      )}\n    </div>\n  );\n}\n","/**\n * TOTP Verification component for login flow\n *\n * Displayed when a user with 2FA enabled needs to\n * enter their verification code to complete login.\n */\n\nimport { useState } from 'react';\nimport { useTotpVerify } from '../../hooks/useTotpVerify';\nimport { OtpInput } from './OtpInput';\nimport { LoadingSpinner } from '../shared/LoadingSpinner';\n\nexport interface TotpVerifyProps {\n  /** Temporary token from password authentication */\n  mfaToken: string;\n  /** Email address (for display) */\n  email?: string;\n  /** Called when verification succeeds */\n  onSuccess?: () => void;\n  /** Called when user wants to go back */\n  onBack?: () => void;\n  /** Additional CSS class */\n  className?: string;\n}\n\n/**\n * Two-factor authentication verification for login.\n *\n * Accepts 6-digit codes from authenticator apps\n * or recovery codes for account recovery.\n */\nexport function TotpVerify({\n  mfaToken,\n  email,\n  onSuccess,\n  onBack,\n  className = '',\n}: TotpVerifyProps) {\n  const { verifyTotp, isLoading, error, clearError } = useTotpVerify();\n  const [code, setCode] = useState('');\n  const [useBackupCode, setUseBackupCode] = useState(false);\n  const [backupCode, setBackupCode] = useState('');\n\n  const handleVerify = async (verifyCode?: string) => {\n    const codeToVerify = verifyCode || (useBackupCode ? backupCode : code);\n    if (!codeToVerify) return;\n\n    try {\n      await verifyTotp(mfaToken, codeToVerify);\n      onSuccess?.();\n    } catch {\n      // Error handled by hook, clear the input\n      if (useBackupCode) {\n        setBackupCode('');\n      } else {\n        setCode('');\n      }\n    }\n  };\n\n  const handleOtpComplete = (value: string) => {\n    handleVerify(value);\n  };\n\n  const toggleBackupCode = () => {\n    setUseBackupCode(!useBackupCode);\n    clearError();\n    setCode('');\n    setBackupCode('');\n  };\n\n  return (\n    <div className={`cedros-totp-verify ${className}`}>\n      <div className=\"cedros-totp-verify-header\">\n        <svg\n          className=\"cedros-totp-verify-icon\"\n          width=\"48\"\n          height=\"48\"\n          viewBox=\"0 0 48 48\"\n          fill=\"none\"\n          aria-hidden=\"true\"\n        >\n          <rect x=\"8\" y=\"20\" width=\"32\" height=\"24\" rx=\"4\" stroke=\"currentColor\" strokeWidth=\"2\" />\n          <path\n            d=\"M16 20V14a8 8 0 1 1 16 0v6\"\n            stroke=\"currentColor\"\n            strokeWidth=\"2\"\n            strokeLinecap=\"round\"\n          />\n          <circle cx=\"24\" cy=\"32\" r=\"3\" fill=\"currentColor\" />\n        </svg>\n        <h3 className=\"cedros-totp-title\">Two-factor authentication</h3>\n        <p className=\"cedros-totp-description\">\n          {useBackupCode\n            ? 'Enter one of your recovery codes to sign in.'\n            : 'Enter the 6-digit code from your authenticator app.'}\n        </p>\n        {email && <p className=\"cedros-totp-email\">{email}</p>}\n      </div>\n\n      {useBackupCode ? (\n        <div className=\"cedros-totp-backup-input\">\n          <input\n            type=\"text\"\n            className={`cedros-input ${error ? 'cedros-input-error' : ''}`}\n            placeholder=\"Enter recovery code\"\n            value={backupCode}\n            onChange={(e) => {\n              setBackupCode(e.target.value.toUpperCase());\n              clearError();\n            }}\n            onKeyDown={(e) => {\n              if (e.key === 'Enter' && backupCode) {\n                handleVerify();\n              }\n            }}\n            disabled={isLoading}\n            autoFocus\n            autoComplete=\"one-time-code\"\n          />\n          {error && (\n            <p className=\"cedros-input-error\" role=\"alert\">\n              {error.message}\n            </p>\n          )}\n        </div>\n      ) : (\n        <OtpInput\n          value={code}\n          onChange={(value) => {\n            setCode(value);\n            clearError();\n          }}\n          onComplete={handleOtpComplete}\n          disabled={isLoading}\n          error={error?.message}\n          autoFocus\n        />\n      )}\n\n      <button\n        type=\"button\"\n        className=\"cedros-button cedros-button-primary cedros-button-md cedros-button-full\"\n        onClick={() => handleVerify()}\n        disabled={isLoading || (useBackupCode ? !backupCode : code.length !== 6)}\n      >\n        {isLoading ? (\n          <>\n            <LoadingSpinner size=\"sm\" />\n            <span>Verifying...</span>\n          </>\n        ) : (\n          'Verify'\n        )}\n      </button>\n\n      <div className=\"cedros-totp-verify-footer\">\n        <button\n          type=\"button\"\n          className=\"cedros-link cedros-link-sm\"\n          onClick={toggleBackupCode}\n          disabled={isLoading}\n        >\n          {useBackupCode ? 'Use authenticator app' : 'Use a recovery code'}\n        </button>\n\n        {onBack && (\n          <>\n            <span className=\"cedros-totp-verify-divider\">â€¢</span>\n            <button\n              type=\"button\"\n              className=\"cedros-link cedros-link-sm\"\n              onClick={onBack}\n              disabled={isLoading}\n            >\n              Back to login\n            </button>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n","import { useState, type FormEvent } from 'react';\nimport { useCedrosLogin } from '../../context/useCedrosLogin';\nimport { useEmailAuth } from '../../hooks/useEmailAuth';\nimport { useInstantLink } from '../../hooks/useInstantLink';\nimport { PasswordInput } from './PasswordInput';\nimport { LoadingSpinner } from '../shared/LoadingSpinner';\nimport { ErrorMessage } from '../shared/ErrorMessage';\nimport { TotpVerify } from '../totp/TotpVerify';\n// COMP-01: Email validation now handled by useInstantLink hook internally\n\nexport interface EmailLoginFormProps {\n  onSuccess?: () => void;\n  onSwitchToRegister?: () => void;\n  /** Called when user clicks \"Forgot password?\" (only in 'reset' mode) */\n  onForgotPassword?: () => void;\n  className?: string;\n}\n\n/**\n * Email/password login form\n */\nexport function EmailLoginForm({\n  onSuccess,\n  onSwitchToRegister,\n  onForgotPassword,\n  className = '',\n}: EmailLoginFormProps) {\n  const { config } = useCedrosLogin();\n  const { login, isLoading, error, clearError } = useEmailAuth();\n  const {\n    sendInstantLink,\n    isLoading: isInstantLinkLoading,\n    isSuccess: isInstantLinkSuccess,\n    error: instantLinkError,\n    clearError: clearInstantLinkError,\n    reset: resetInstantLink,\n  } = useInstantLink();\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  // MFA state for 2FA flow\n  const [mfaToken, setMfaToken] = useState<string | null>(null);\n  const [mfaEmail, setMfaEmail] = useState<string>('');\n\n  const forgotPasswordMode = config.forms?.forgotPassword?.mode ?? 'reset';\n\n  const handleSubmit = async (e: FormEvent) => {\n    e.preventDefault();\n    try {\n      const result = await login(email, password);\n      if (result.mfaRequired) {\n        // MFA verification needed\n        setMfaToken(result.mfaToken);\n        setMfaEmail(result.email);\n      } else {\n        // Login successful\n        onSuccess?.();\n      }\n    } catch {\n      // Error is handled by the hook\n    }\n  };\n\n  const handleTotpSuccess = () => {\n    setMfaToken(null);\n    setMfaEmail('');\n    onSuccess?.();\n  };\n\n  const handleTotpBack = () => {\n    setMfaToken(null);\n    setMfaEmail('');\n    setPassword(''); // Clear password for security\n  };\n\n  const handleForgotPassword = async () => {\n    if (forgotPasswordMode === 'instantLink') {\n      // COMP-01: In instant link mode, call sendInstantLink directly.\n      // The hook validates email and sets error state if invalid.\n      try {\n        await sendInstantLink(email);\n      } catch {\n        // Error handled by hook's error state\n      }\n    } else {\n      // In reset mode, call the callback\n      onForgotPassword?.();\n    }\n  };\n\n  // Show TOTP verification step\n  if (mfaToken) {\n    return (\n      <TotpVerify\n        mfaToken={mfaToken}\n        email={mfaEmail}\n        onSuccess={handleTotpSuccess}\n        onBack={handleTotpBack}\n        className={className}\n      />\n    );\n  }\n\n  // Show instant link success state\n  if (isInstantLinkSuccess) {\n    return (\n      <div className={`cedros-instant-link-success ${className}`}>\n        <svg\n          className=\"cedros-success-icon\"\n          width=\"48\"\n          height=\"48\"\n          viewBox=\"0 0 48 48\"\n          fill=\"none\"\n          aria-hidden=\"true\"\n        >\n          <circle cx=\"24\" cy=\"24\" r=\"22\" stroke=\"currentColor\" strokeWidth=\"2\" />\n          <path\n            d=\"M14 24l7 7 13-13\"\n            stroke=\"currentColor\"\n            strokeWidth=\"2\"\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n          />\n        </svg>\n        <h3 className=\"cedros-success-title\">Check your email</h3>\n        <p className=\"cedros-success-message\">\n          We sent a sign-in link to <strong>{email}</strong>. Click the link to sign in.\n        </p>\n        <button\n          type=\"button\"\n          className=\"cedros-button cedros-button-md cedros-button-outline\"\n          onClick={resetInstantLink}\n        >\n          Back to login\n        </button>\n      </div>\n    );\n  }\n\n  const combinedError = error || instantLinkError;\n  const combinedClearError = () => {\n    clearError();\n    clearInstantLinkError();\n  };\n  const isAnyLoading = isLoading || isInstantLinkLoading;\n\n  return (\n    <form onSubmit={handleSubmit} className={`cedros-form ${className}`}>\n      <div className=\"cedros-form-field\">\n        <label htmlFor=\"email\" className=\"cedros-label\">\n          Email\n        </label>\n        <input\n          id=\"email\"\n          type=\"email\"\n          className=\"cedros-input\"\n          value={email}\n          onChange={(e) => setEmail(e.target.value)}\n          placeholder=\"you@example.com\"\n          required\n          aria-required=\"true\"\n          autoComplete=\"email\"\n          disabled={isAnyLoading}\n        />\n      </div>\n\n      <div className=\"cedros-form-field\">\n        <PasswordInput\n          value={password}\n          onChange={(e) => setPassword(e.target.value)}\n          placeholder=\"Enter your password\"\n          required\n          autoComplete=\"current-password\"\n          disabled={isAnyLoading}\n          labelAction={\n            onForgotPassword || forgotPasswordMode === 'instantLink' ? (\n              <button\n                type=\"button\"\n                className=\"cedros-link cedros-link-sm\"\n                onClick={handleForgotPassword}\n                disabled={isInstantLinkLoading}\n              >\n                {isInstantLinkLoading ? 'Sending...' : 'Forgot your password?'}\n              </button>\n            ) : undefined\n          }\n        />\n      </div>\n\n      <ErrorMessage error={combinedError} onDismiss={combinedClearError} />\n\n      <button\n        type=\"submit\"\n        className=\"cedros-button cedros-button-primary cedros-button-md cedros-button-full\"\n        disabled={isAnyLoading || !email || !password}\n        aria-busy={isLoading}\n      >\n        {isLoading ? (\n          <>\n            <LoadingSpinner size=\"sm\" announce label=\"Signing in\" />\n            <span>Signing in...</span>\n          </>\n        ) : (\n          'Sign in'\n        )}\n      </button>\n\n      {onSwitchToRegister && (\n        <p className=\"cedros-form-footer\">\n          Don&apos;t have an account?{' '}\n          <button type=\"button\" className=\"cedros-link\" onClick={onSwitchToRegister}>\n            Sign up\n          </button>\n        </p>\n      )}\n    </form>\n  );\n}\n","import { useState, type FormEvent } from 'react';\nimport { useCedrosLogin } from '../../context/useCedrosLogin';\nimport { useEmailAuth } from '../../hooks/useEmailAuth';\nimport { PasswordInput } from './PasswordInput';\nimport { LoadingSpinner } from '../shared/LoadingSpinner';\nimport { ErrorMessage } from '../shared/ErrorMessage';\nimport { sanitizeExternalUrl } from '../../utils/sanitization';\nimport type { PasswordValidation, AuthError } from '../../types';\n\nexport interface EmailRegisterFormProps {\n  onSuccess?: () => void;\n  onSwitchToLogin?: () => void;\n  className?: string;\n}\n\n/** Values collected from the registration form (for callback) */\nexport interface RegistrationData {\n  termsAccepted: boolean;\n  emailOptIn: boolean;\n}\n\n/**\n * Email/password registration form\n */\nexport function EmailRegisterForm({\n  onSuccess,\n  onSwitchToLogin,\n  className = '',\n}: EmailRegisterFormProps) {\n  const { config } = useCedrosLogin();\n  const { register, isLoading, error, clearError } = useEmailAuth();\n  const [name, setName] = useState('');\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [passwordValidation, setPasswordValidation] = useState<PasswordValidation | null>(null);\n  const [termsError, setTermsError] = useState<AuthError | null>(null);\n\n  // Get form configuration\n  const termsConfig = config.forms?.termsOfService;\n  const emailOptInConfig = config.forms?.emailOptIn;\n\n  const showTerms = termsConfig?.show ?? false;\n  const termsRequired = termsConfig?.required ?? true;\n  const termsDefaultChecked = termsConfig?.defaultChecked ?? false;\n  const termsLabel = termsConfig?.label ?? 'I agree to the Terms of Service';\n  const termsUrl = termsConfig?.url;\n  const safeTermsUrl = sanitizeExternalUrl(termsUrl);\n\n  const showEmailOptIn = emailOptInConfig?.show ?? false;\n  const emailOptInDefaultChecked = emailOptInConfig?.defaultChecked ?? false;\n  const emailOptInLabel = emailOptInConfig?.label ?? 'Send me updates and news';\n\n  // Initialize checkbox states with defaults\n  const [termsAccepted, setTermsAccepted] = useState(termsDefaultChecked);\n  const [emailOptIn, setEmailOptIn] = useState(emailOptInDefaultChecked);\n\n  const passwordsMatch = password === confirmPassword;\n  const isPasswordValid = passwordValidation?.isValid ?? false;\n\n  // Terms must be accepted if shown and required\n  const termsValid = !showTerms || !termsRequired || termsAccepted;\n\n  const canSubmit =\n    email &&\n    password &&\n    confirmPassword &&\n    passwordsMatch &&\n    isPasswordValid &&\n    termsValid &&\n    !isLoading;\n\n  const handleSubmit = async (e: FormEvent) => {\n    e.preventDefault();\n\n    // Clear any previous terms error\n    setTermsError(null);\n\n    // Validate terms if required\n    if (showTerms && termsRequired && !termsAccepted) {\n      setTermsError({\n        code: 'VALIDATION_ERROR',\n        message: 'You must agree to the Terms of Service to continue',\n      });\n      return;\n    }\n\n    if (!canSubmit) return;\n\n    try {\n      // Note: termsAccepted and emailOptIn values can be passed to the backend\n      // via the register function if needed. For now, we call register with the\n      // standard params, but the backend could be extended to accept these values.\n      await register(email, password, name || undefined);\n      onSuccess?.();\n    } catch {\n      // Error is handled by the hook\n    }\n  };\n\n  const combinedError = error || termsError;\n  const combinedClearError = () => {\n    clearError();\n    setTermsError(null);\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className={`cedros-form ${className}`}>\n      <div className=\"cedros-form-field\">\n        <label htmlFor=\"name\" className=\"cedros-label\">\n          Name <span className=\"cedros-optional\">(optional)</span>\n        </label>\n        <input\n          id=\"name\"\n          type=\"text\"\n          className=\"cedros-input\"\n          value={name}\n          onChange={(e) => setName(e.target.value)}\n          placeholder=\"Your name\"\n          autoComplete=\"name\"\n          disabled={isLoading}\n        />\n      </div>\n\n      <div className=\"cedros-form-field\">\n        <label htmlFor=\"register-email\" className=\"cedros-label\">\n          Email\n        </label>\n        <input\n          id=\"register-email\"\n          type=\"email\"\n          className=\"cedros-input\"\n          value={email}\n          onChange={(e) => setEmail(e.target.value)}\n          placeholder=\"you@example.com\"\n          required\n          aria-required=\"true\"\n          autoComplete=\"email\"\n          disabled={isLoading}\n        />\n      </div>\n\n      <div className=\"cedros-form-field\">\n        <PasswordInput\n          value={password}\n          onChange={(e) => setPassword(e.target.value)}\n          placeholder=\"Create a password\"\n          required\n          autoComplete=\"new-password\"\n          disabled={isLoading}\n          showStrengthMeter\n          onValidationChange={setPasswordValidation}\n        />\n      </div>\n\n      <div className=\"cedros-form-field\">\n        <label htmlFor=\"confirm-password\" className=\"cedros-label\">\n          Confirm Password\n        </label>\n        <input\n          id=\"confirm-password\"\n          type=\"password\"\n          className=\"cedros-input\"\n          value={confirmPassword}\n          onChange={(e) => setConfirmPassword(e.target.value)}\n          placeholder=\"Confirm your password\"\n          required\n          aria-required=\"true\"\n          autoComplete=\"new-password\"\n          disabled={isLoading}\n          aria-invalid={confirmPassword && !passwordsMatch ? 'true' : undefined}\n          aria-describedby={\n            confirmPassword && !passwordsMatch ? 'confirm-password-error' : undefined\n          }\n        />\n        {confirmPassword && !passwordsMatch && (\n          <p id=\"confirm-password-error\" className=\"cedros-input-error\" role=\"alert\">\n            Passwords do not match\n          </p>\n        )}\n      </div>\n\n      {/* Terms of Service checkbox */}\n      {showTerms && (\n        <div className=\"cedros-form-field cedros-checkbox-field\">\n          <label className=\"cedros-checkbox-label\">\n            <input\n              type=\"checkbox\"\n              className=\"cedros-checkbox\"\n              checked={termsAccepted}\n              onChange={(e) => setTermsAccepted(e.target.checked)}\n              disabled={isLoading}\n              aria-required={termsRequired}\n            />\n            <span className=\"cedros-checkbox-text\">\n              {safeTermsUrl ? (\n                <>\n                  {termsLabel.replace('Terms of Service', '').trim() || 'I agree to the'}{' '}\n                  <a\n                    href={safeTermsUrl}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"cedros-link\"\n                  >\n                    Terms of Service\n                  </a>\n                </>\n              ) : (\n                termsLabel\n              )}\n              {termsRequired && <span className=\"cedros-required\">*</span>}\n            </span>\n          </label>\n        </div>\n      )}\n\n      {/* Email opt-in checkbox */}\n      {showEmailOptIn && (\n        <div className=\"cedros-form-field cedros-checkbox-field\">\n          <label className=\"cedros-checkbox-label\">\n            <input\n              type=\"checkbox\"\n              className=\"cedros-checkbox\"\n              checked={emailOptIn}\n              onChange={(e) => setEmailOptIn(e.target.checked)}\n              disabled={isLoading}\n            />\n            <span className=\"cedros-checkbox-text\">{emailOptInLabel}</span>\n          </label>\n        </div>\n      )}\n\n      <ErrorMessage error={combinedError} onDismiss={combinedClearError} />\n\n      <button\n        type=\"submit\"\n        className=\"cedros-button cedros-button-primary cedros-button-md cedros-button-full\"\n        disabled={!canSubmit}\n        aria-busy={isLoading}\n      >\n        {isLoading ? (\n          <>\n            <LoadingSpinner size=\"sm\" announce label=\"Creating account\" />\n            <span>Creating account...</span>\n          </>\n        ) : (\n          'Create account'\n        )}\n      </button>\n\n      {onSwitchToLogin && (\n        <p className=\"cedros-form-footer\">\n          Already have an account?{' '}\n          <button type=\"button\" className=\"cedros-link\" onClick={onSwitchToLogin}>\n            Sign in\n          </button>\n        </p>\n      )}\n    </form>\n  );\n}\n"],"names":["useRateLimiter","options","maxAttempts","windowMs","showCountdown","attemptsRef","useRef","hasAttempts","setHasAttempts","useState","setTick","bump","useCallback","value","cleanupAttemptsArray","now","timestamp","cleanupExpiredAttempts","current","getRemainingAttempts","getTimeUntilReset","resetTime","isAllowed","checkLimit","waitTime","waitSeconds","reset","useEffect","intervalId","isMfaRequiredResponse","response","useEmailAuth","config","_internal","useCedrosLogin","isLoading","setIsLoading","error","setError","resetRateLimit","apiClient","useMemo","ApiClient","callbacks","walletEnrollmentEnabled","serverUrl","login","email","password","validateEmail","validationError","err","rateLimitError","data","authResponse","authError","handleApiError","register","name","accessToken","enrollDelay","resolve","silentWalletEnroll","result","message","clearError","useInstantLink","isSuccess","setIsSuccess","sendInstantLink","verifyInstantLink","token","PasswordInput","label","labelAction","showStrengthMeter","onValidationChange","className","onChange","props","showPassword","setShowPassword","validation","setValidation","inputId","useId","handleChange","e","newValue","newValidation","validatePassword","strengthColors","jsxs","jsx","useTotpVerify","state","setState","verifyTotp","mfaToken","code","isRecoveryCode","OTP_LENGTH","OtpInput","onComplete","disabled","autoFocus","inputRefs","localValue","setLocalValue","id","focusInput","index","updateValue","sanitized","digit","chars","handleKeyDown","handlePaste","digits","handleFocus","_","el","TotpVerify","onSuccess","onBack","setCode","useBackupCode","setUseBackupCode","backupCode","setBackupCode","handleVerify","verifyCode","codeToVerify","handleOtpComplete","toggleBackupCode","Fragment","LoadingSpinner","EmailLoginForm","onSwitchToRegister","onForgotPassword","isInstantLinkLoading","isInstantLinkSuccess","instantLinkError","clearInstantLinkError","resetInstantLink","setEmail","setPassword","setMfaToken","mfaEmail","setMfaEmail","forgotPasswordMode","handleSubmit","handleTotpSuccess","handleTotpBack","handleForgotPassword","combinedError","combinedClearError","isAnyLoading","ErrorMessage","EmailRegisterForm","onSwitchToLogin","setName","confirmPassword","setConfirmPassword","passwordValidation","setPasswordValidation","termsError","setTermsError","termsConfig","emailOptInConfig","showTerms","termsRequired","termsDefaultChecked","termsLabel","termsUrl","safeTermsUrl","sanitizeExternalUrl","showEmailOptIn","emailOptInDefaultChecked","emailOptInLabel","termsAccepted","setTermsAccepted","emailOptIn","setEmailOptIn","passwordsMatch","isPasswordValid","canSubmit"],"mappings":"gRAmEO,SAASA,EAAeC,EAAiC,GAA0B,CACxF,KAAM,CAAE,YAAAC,EAAc,EAAG,SAAAC,EAAW,IAAO,cAAAC,EAAgB,IAAUH,EAG/DI,EAAcC,EAAAA,OAAiB,EAAE,EACjC,CAACC,EAAaC,CAAc,EAAIC,EAAAA,SAAS,EAAK,EAC9C,EAAGC,CAAO,EAAID,EAAAA,SAAS,CAAC,EAExBE,EAAOC,EAAAA,YAAY,IAAM,CAC7BF,EAASG,GAAUA,EAAQ,CAAC,CAC9B,EAAG,CAAA,CAAE,EAMCC,EAAuBF,EAAAA,YAAY,IAAM,CAC7C,MAAMG,EAAM,KAAK,IAAA,EACjBV,EAAY,QAAUA,EAAY,QAAQ,OAAQW,GAAcD,EAAMC,EAAYb,CAAQ,CAC5F,EAAG,CAACA,CAAQ,CAAC,EAOPc,EAAyBL,EAAAA,YAAY,IAAM,CAC/CE,EAAA,EAEAN,EAAgBU,GAAab,EAAY,QAAQ,SAAW,GAAKa,EAAU,GAAQA,CAAQ,CAC7F,EAAG,CAACJ,CAAoB,CAAC,EAMnBK,EAAuBP,EAAAA,YAAY,KACvCE,EAAA,EACO,KAAK,IAAI,EAAGZ,EAAcG,EAAY,QAAQ,MAAM,GAC1D,CAACS,EAAsBZ,CAAW,CAAC,EAMhCkB,EAAoBR,EAAAA,YAAY,IAAc,CAElD,GADAE,EAAA,EACIT,EAAY,QAAQ,SAAW,EACjC,MAAO,GAGT,MAAMgB,EADgBhB,EAAY,QAAQ,CAAC,EACTF,EAClC,OAAO,KAAK,IAAI,EAAGkB,EAAY,KAAK,KAAK,CAC3C,EAAG,CAACP,EAAsBX,CAAQ,CAAC,EAM7BmB,EAAYV,EAAAA,YAAY,KAC5BE,EAAA,EACOT,EAAY,QAAQ,OAASH,GACnC,CAACY,EAAsBZ,CAAW,CAAC,EAKhCqB,EAAaX,EAAAA,YAAY,IAAY,CAGzC,GAFAK,EAAA,EAEIZ,EAAY,QAAQ,QAAUH,EAAa,CAC7C,MAAMsB,EAAWJ,EAAA,EACXK,EAAc,KAAK,KAAKD,EAAW,GAAI,EAC7C,MAAM,IAAI,MACR,kCAAkCC,CAAW,UAAUA,IAAgB,EAAI,GAAK,GAAG,uBAAA,CAEvF,CAGApB,EAAY,QAAQ,KAAK,KAAK,IAAA,CAAK,EAEnCG,EAAgBU,GAAaA,GAAoB,EAAK,EACtDP,EAAA,CACF,EAAG,CAACM,EAAwBf,EAAakB,EAAmBT,CAAI,CAAC,EAK3De,EAAQd,EAAAA,YAAY,IAAY,CACpCP,EAAY,QAAU,CAAA,EAEtBG,EAAgBU,GAAaA,GAAU,EAAgB,EACvDP,EAAA,CACF,EAAG,CAACA,CAAI,CAAC,EAITgB,OAAAA,EAAAA,UAAU,IAAM,CACd,GAAI,CAACpB,GAAe,CAACH,EAAe,OACpC,MAAMwB,EAAa,OAAO,YAAY,IAAM,CAC1CX,EAAA,EACAN,EAAA,CACF,EAAG,GAAI,EACP,MAAO,IAAM,CACX,OAAO,cAAciB,CAAU,CACjC,CACF,EAAG,CAACrB,EAAaH,EAAeO,EAAMM,CAAsB,CAAC,EAEtD,CACL,WAAAM,EACA,UAAAD,EACA,qBAAAH,EACA,kBAAAC,EACA,MAAAM,CAAA,CAEJ,CC9KA,SAASG,GACPC,EACiC,CACjC,MAAO,gBAAiBA,GAAYA,EAAS,cAAgB,EAC/D,CAgEO,SAASC,GAAmC,CACjD,KAAM,CAAE,OAAAC,EAAQ,UAAAC,CAAA,EAAcC,iBAAA,EACxB,CAACC,EAAWC,CAAY,EAAI3B,EAAAA,SAAS,EAAK,EAC1C,CAAC4B,EAAOC,CAAQ,EAAI7B,EAAAA,SAA2B,IAAI,EAGnD,CACJ,WAAAc,EACA,qBAAAJ,EACA,kBAAAC,EACA,MAAOmB,CAAA,EACLvC,EAAe,CAAE,YAAa,EAAG,SAAU,IAAO,EAEhDwC,EAAYC,EAAAA,QAChB,IACE,IAAIC,EAAAA,UAAU,CACZ,QAASV,EAAO,UAChB,UAAWA,EAAO,eAClB,cAAeA,EAAO,aAAA,CACvB,EACH,CAACA,EAAO,UAAWA,EAAO,eAAgBA,EAAO,aAAa,CAAA,EAG1DW,EAAYX,EAAO,UACnBY,EAA0BZ,EAAO,UAAU,mBAAqB,GAChEa,EAAYb,EAAO,UAEnBc,EAAQlC,EAAAA,YACZ,MAAOmC,EAAeC,IAA2C,CAE/D,GAAI,CAACC,EAAAA,cAAcF,CAAK,EAAG,CACzB,MAAMG,EAA6B,CACjC,KAAM,mBACN,QAAS,oCAAA,EAEX,MAAAZ,EAASY,CAAe,EAClBA,CACR,CAKA,GAAI,CACF3B,EAAA,CACF,OAAS4B,EAAK,CACZ,MAAMC,EAA4B,CAChC,KAAM,eACN,QAASD,aAAe,MAAQA,EAAI,QAAU,mBAAA,EAEhD,MAAAb,EAASc,CAAc,EACjBA,CACR,CAEAhB,EAAa,EAAI,EACjBE,EAAS,IAAI,EAEb,GAAI,CACF,MAAMe,EAAO,MAAMb,EAAU,KAAyC,SAAU,CAC9E,MAAAO,EACA,SAAAC,CAAA,CACD,EAGD,GAAInB,GAAsBwB,CAAI,EAC5B,MAAO,CACL,YAAa,GACb,SAAUA,EAAK,SACf,MAAAN,EACA,OAAQM,EAAK,MAAA,EAKjB,MAAMC,EAA6BD,EACnC,OAAAV,GAAW,iBAAiBW,EAAa,KAAM,OAAO,EACtDrB,GAAW,mBAAmBqB,EAAa,KAAMA,EAAa,MAAM,EACpEf,EAAA,EACO,CACL,YAAa,GACb,SAAUe,CAAA,CAEd,OAASH,EAAK,CACZ,MAAMI,EAAYC,EAAAA,eAAeL,EAAK,cAAc,EACpD,MAAAb,EAASiB,CAAS,EACZA,CACR,QAAA,CACEnB,EAAa,EAAK,CACpB,CACF,EACA,CAACI,EAAWG,EAAWV,EAAWV,EAAYgB,CAAc,CAAA,EAGxDkB,EAAW7C,EAAAA,YACf,MAAOmC,EAAeC,EAAkBU,IAAyC,CAE/E,GAAI,CAACT,EAAAA,cAAcF,CAAK,EAAG,CACzB,MAAMG,EAA6B,CACjC,KAAM,mBACN,QAAS,oCAAA,EAEX,MAAAZ,EAASY,CAAe,EAClBA,CACR,CAKA,GAAI,CACF3B,EAAA,CACF,OAAS4B,EAAK,CACZ,MAAMC,EAA4B,CAChC,KAAM,eACN,QAASD,aAAe,MAAQA,EAAI,QAAU,mBAAA,EAEhD,MAAAb,EAASc,CAAc,EACjBA,CACR,CAEAhB,EAAa,EAAI,EACjBE,EAAS,IAAI,EAEb,GAAI,CACF,MAAMe,EAAO,MAAMb,EAAU,KAAmB,YAAa,CAAE,MAAAO,EAAO,SAAAC,EAAU,KAAAU,EAAM,EAStF,GARAf,GAAW,iBAAiBU,EAAK,KAAM,OAAO,EAC9CpB,GAAW,mBAAmBoB,EAAK,KAAMA,EAAK,MAAM,EACpDd,EAAA,EAMIK,EAAyB,CAC3B,MAAMe,EAAcN,EAAK,QAAQ,aAAe,GAE1CO,EADe,CAACD,EACa,IAAM,EACpC,IAAI,QAAeE,GAAY,WAAWA,EAASD,CAAW,CAAC,EACjE,KAAK,IAAM,mCAAO,mCAA6B,CAAA,CAAC,EAChD,KAAK,CAAC,CAAE,mBAAAE,CAAA,IACPA,EAAmB,CACjB,SAAAd,EACA,UAAAH,EACA,YAAAc,CAAA,CACD,CAAA,EAEF,KAAMI,GAAW,CACXA,EAAO,SAEV,QAAQ,KAAK,gDAAiDA,EAAO,KAAK,CAE9E,CAAC,EACA,MAAOZ,GAAQ,CACd,MAAMa,EAAUb,aAAe,MAAQA,EAAI,QAAU,gBAErD,QAAQ,KAAK,qDAAsDa,CAAO,CAC5E,CAAC,CACL,CAEA,OAAOX,CACT,OAASF,EAAK,CACZ,MAAMI,EAAYC,EAAAA,eAAeL,EAAK,qBAAqB,EAC3D,MAAAb,EAASiB,CAAS,EACZA,CACR,QAAA,CACEnB,EAAa,EAAK,CACpB,CACF,EACA,CACEI,EACAG,EACAV,EACAV,EACAgB,EACAM,EACAD,CAAA,CACF,EAGIqB,EAAarD,EAAAA,YAAY,IAAM0B,EAAS,IAAI,EAAG,CAAA,CAAE,EAEvD,MAAO,CACL,MAAAQ,EACA,SAAAW,EACA,UAAAtB,EACA,MAAAE,EACA,WAAA4B,EAEA,kBAAmB9C,EAAA,EACnB,eAAgBC,EAAA,CAAkB,CAEtC,CClQA,SAASS,GAAsBwB,EAA4C,CACzE,OACE,OAAOA,GAAS,UAChBA,IAAS,MACT,gBAAiBA,GAChBA,EAAmC,cAAgB,EAExD,CA2CO,SAASa,GAAuC,CACrD,KAAM,CAAE,OAAAlC,EAAQ,UAAAC,CAAA,EAAcC,iBAAA,EACxB,CAACC,EAAWC,CAAY,EAAI3B,EAAAA,SAAS,EAAK,EAC1C,CAAC0D,EAAWC,CAAY,EAAI3D,EAAAA,SAAS,EAAK,EAC1C,CAAC4B,EAAOC,CAAQ,EAAI7B,EAAAA,SAA2B,IAAI,EAEnD+B,EAAYC,EAAAA,QAChB,IACE,IAAIC,EAAAA,UAAU,CACZ,QAASV,EAAO,UAChB,UAAWA,EAAO,eAClB,cAAeA,EAAO,aAAA,CACvB,EACH,CAACA,EAAO,UAAWA,EAAO,eAAgBA,EAAO,aAAa,CAAA,EAI1D,CAAE,WAAAT,EAAY,qBAAAJ,CAAA,EAAyBnB,EAAe,CAC1D,YAAa,EACb,SAAU,GAAA,CACX,EAEKqE,EAAkBzD,EAAAA,YACtB,MAAOmC,GAAiC,CAEtC,GAAI,CAACE,EAAAA,cAAcF,CAAK,EAAG,CACzB,MAAMG,EAA6B,CACjC,KAAM,mBACN,QAAS,oCAAA,EAEX,MAAAZ,EAASY,CAAe,EAClBA,CACR,CAGA,GAAI,CACF3B,EAAA,CACF,OAAS4B,EAAK,CACZ,MAAMC,EAA4B,CAChC,KAAM,eACN,QAASD,aAAe,MAAQA,EAAI,QAAU,mBAAA,EAEhD,MAAAb,EAASc,CAAc,EACjBA,CACR,CAEAhB,EAAa,EAAI,EACjBE,EAAS,IAAI,EACb8B,EAAa,EAAK,EAElB,GAAI,CACF,MAAM5B,EAAU,KAAK,gBAAiB,CAAE,MAAAO,EAAO,EAC/CqB,EAAa,EAAI,CACnB,OAASjB,EAAK,CACZ,MAAMI,EAAYC,EAAAA,eAAeL,EAAK,6BAA6B,EACnE,MAAAb,EAASiB,CAAS,EACZA,CACR,QAAA,CACEnB,EAAa,EAAK,CACpB,CACF,EACA,CAACI,EAAWjB,CAAU,CAAA,EAGlB+C,EAAoB1D,EAAAA,YACxB,MAAO2D,GAA+D,CACpE,GAAI,CAACA,GAASA,EAAM,KAAA,EAAO,SAAW,EAAG,CACvC,MAAMrB,EAA6B,CACjC,KAAM,mBACN,QAAS,uCAAA,EAEX,MAAAZ,EAASY,CAAe,EAClBA,CACR,CAEAd,EAAa,EAAI,EACjBE,EAAS,IAAI,EACb8B,EAAa,EAAK,EAElB,GAAI,CACF,MAAMf,EAAO,MAAMb,EAAU,KAC3B,uBACA,CACE,MAAA+B,CAAA,CACF,EAGF,OAAI1C,GAAsBwB,CAAI,IAK9BrB,EAAO,WAAW,iBAAiBqB,EAAK,KAAM,OAAO,EACrDpB,GAAW,mBAAmBoB,EAAK,KAAMA,EAAK,MAAM,GAC7CA,CACT,OAASF,EAAK,CACZ,MAAMI,EAAYC,EAAAA,eAAeL,EAAK,+BAA+B,EACrE,MAAAb,EAASiB,CAAS,EACZA,CACR,QAAA,CACEnB,EAAa,EAAK,CACpB,CACF,EACA,CAACI,EAAWR,EAAO,UAAWC,CAAS,CAAA,EAGnCgC,EAAarD,EAAAA,YAAY,IAAM0B,EAAS,IAAI,EAAG,CAAA,CAAE,EAEjDZ,EAAQd,EAAAA,YAAY,IAAM,CAC9B0B,EAAS,IAAI,EACb8B,EAAa,EAAK,EAClBhC,EAAa,EAAK,CACpB,EAAG,CAAA,CAAE,EAEL,MAAO,CACL,gBAAAiC,EACA,kBAAAC,EACA,UAAAnC,EACA,UAAAgC,EACA,MAAA9B,EACA,WAAA4B,EACA,MAAAvC,EACA,kBAAmBP,EAAA,CAAqB,CAE5C,CCrKO,SAASqD,EAAc,CAC5B,MAAAC,EAAQ,WACR,YAAAC,EACA,kBAAAC,EAAoB,GACpB,mBAAAC,EACA,MAAAvC,EACA,UAAAwC,EAAY,GACZ,SAAAC,EACA,MAAAjE,EACA,GAAGkE,CACL,EAAuB,CACrB,KAAM,CAACC,EAAcC,CAAe,EAAIxE,EAAAA,SAAS,EAAK,EAChD,CAACyE,EAAYC,CAAa,EAAI1E,EAAAA,SAAoC,IAAI,EACtE2E,EAAUC,EAAAA,MAAA,EAEVC,EAAgBC,GAA2C,CAC/D,MAAMC,EAAWD,EAAE,OAAO,MAE1B,GAAIZ,GAAqBC,EAAoB,CAC3C,MAAMa,EAAgBC,EAAAA,iBAAiBF,CAAQ,EAC/CL,EAAcM,CAAa,EAC3Bb,IAAqBa,CAAa,CACpC,CAEAX,IAAWS,CAAC,CACd,EAEMI,EAAiB,CACrB,KAAM,qCACN,KAAM,iCACN,KAAM,iCACN,OAAQ,gCAAA,EAGV,OACEC,EAAAA,KAAC,MAAA,CAAI,UAAW,yBAAyBf,CAAS,GAChD,SAAA,CAAAe,EAAAA,KAAC,MAAA,CAAI,UAAU,mBACb,SAAA,CAAAC,MAAC,QAAA,CAAM,QAAST,EAAS,UAAU,eAChC,SAAAX,EACH,EACCC,CAAA,EACH,EACAkB,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAAC,QAAA,CACC,GAAIT,EACJ,KAAMJ,EAAe,OAAS,WAC9B,UAAU,eACV,SAAUM,EACV,MAAAzE,EACA,eAAcwB,EAAQ,OAAS,OAC/B,mBAAkBA,EAAQ,GAAG+C,CAAO,SAAW,OAC9C,GAAGL,CAAA,CAAA,EAENc,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,UAAU,yBACV,QAAS,IAAMZ,EAAgB,CAACD,CAAY,EAC5C,aAAYA,EAAe,gBAAkB,gBAC7C,eAAcA,EAEb,SAAAA,EACCY,EAAAA,KAAC,MAAA,CAAI,MAAM,KAAK,OAAO,KAAK,QAAQ,YAAY,KAAK,OAAO,cAAY,OACtE,SAAA,CAAAC,EAAAA,IAAC,OAAA,CACC,EAAE,uDACF,OAAO,eACP,YAAY,KAAA,CAAA,EAEdA,EAAAA,IAAC,SAAA,CAAO,GAAG,KAAK,GAAG,KAAK,EAAE,MAAM,OAAO,eAAe,YAAY,KAAA,CAAM,EACxEA,EAAAA,IAAC,QAAK,EAAE,aAAa,OAAO,eAAe,YAAY,MAAM,cAAc,OAAA,CAAQ,CAAA,CAAA,CACrF,EAEAD,EAAAA,KAAC,MAAA,CAAI,MAAM,KAAK,OAAO,KAAK,QAAQ,YAAY,KAAK,OAAO,cAAY,OACtE,SAAA,CAAAC,EAAAA,IAAC,OAAA,CACC,EAAE,uDACF,OAAO,eACP,YAAY,KAAA,CAAA,EAEdA,EAAAA,IAAC,SAAA,CAAO,GAAG,KAAK,GAAG,KAAK,EAAE,MAAM,OAAO,eAAe,YAAY,KAAA,CAAM,CAAA,CAAA,CAC1E,CAAA,CAAA,CAEJ,EACF,EAECxD,SACE,IAAA,CAAE,GAAI,GAAG+C,CAAO,SAAU,UAAU,qBAClC,SAAA/C,CAAA,CACH,EAGDsC,GAAqBO,GAAerE,GAAkB,OAAS,GAC9D+E,OAAC,MAAA,CAAI,UAAU,2BACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,sBACb,SAAAA,EAAAA,IAAC,MAAA,CACC,UAAU,uBACV,MAAO,CACL,MAAO,GACLX,EAAW,WAAa,OACpB,GACAA,EAAW,WAAa,OACtB,GACAA,EAAW,WAAa,OACtB,GACA,GACV,IACA,gBAAiBS,EAAeT,EAAW,QAAQ,CAAA,CACrD,CAAA,EAEJ,EACAW,EAAAA,IAAC,OAAA,CAAK,UAAU,wBAAyB,WAAW,QAAA,CAAS,CAAA,CAAA,CAC/D,CAAA,EAEJ,CAEJ,CCtFO,SAASC,GAAqC,CACnD,KAAM,CAAE,OAAA9D,EAAQ,UAAAC,CAAA,EAAcC,iBAAA,EACxB,CAAC6D,EAAOC,CAAQ,EAAIvF,EAAAA,SAA0B,MAAM,EACpD,CAAC0B,EAAWC,CAAY,EAAI3B,EAAAA,SAAS,EAAK,EAC1C,CAAC4B,EAAOC,CAAQ,EAAI7B,EAAAA,SAA2B,IAAI,EAInD,CACJ,WAAAc,EACA,qBAAAJ,EACA,kBAAAC,EACA,MAAOmB,CAAA,EACLvC,EAAe,CAAE,YAAa,EAAG,SAAU,KAAQ,EAEjDwC,EAAYC,EAAAA,QAChB,IACE,IAAIC,EAAAA,UAAU,CACZ,QAASV,EAAO,UAChB,UAAWA,EAAO,eAClB,cAAeA,EAAO,aAAA,CACvB,EACH,CAACA,EAAO,UAAWA,EAAO,eAAgBA,EAAO,aAAa,CAAA,EAG1DiE,EAAarF,EAAAA,YACjB,MAAOsF,EAAkBC,IAAwC,CAE/D,MAAMC,EACJ,kBAAkB,KAAKD,CAAI,GAAK,kCAAkC,KAAKA,CAAI,EAE7E,GAAI,EADgB,UAAU,KAAKA,CAAI,GAAKC,GAC1B,CAChB,MAAMlD,EAA6B,CACjC,KAAM,mBACN,QAAS,oDAAA,EAEX,MAAAZ,EAASY,CAAe,EAClBA,CACR,CAGA,GAAI,CACF3B,EAAA,CACF,OAAS4B,EAAK,CACZ,MAAMC,EAA4B,CAChC,KAAM,eACN,QAASD,aAAe,MAAQA,EAAI,QAAU,mBAAA,EAEhD,MAAAb,EAASc,CAAc,EACjBA,CACR,CAEAhB,EAAa,EAAI,EACjBE,EAAS,IAAI,EACb0D,EAAS,WAAW,EAEpB,GAAI,CACF,MAAMlE,EAAW,MAAMU,EAAU,KAAmB,aAAc,CAAE,SAAA0D,EAAU,KAAAC,EAAM,EAEpF,OAAAH,EAAS,SAAS,EAClBzD,EAAA,EAGIN,GAAaH,EAAS,MAAQA,EAAS,QACzCG,EAAU,mBAAmBH,EAAS,KAAMA,EAAS,MAAM,EAGtDA,CACT,OAASqB,EAAK,CACZ,MAAMI,EAAYC,EAAAA,eAAeL,EAAK,2BAA2B,EACjE,MAAAb,EAASiB,CAAS,EAClByC,EAAS,OAAO,EACVzC,CACR,QAAA,CACEnB,EAAa,EAAK,CACpB,CACF,EACA,CAACI,EAAWP,EAAWV,EAAYgB,CAAc,CAAA,EAG7C0B,EAAarD,EAAAA,YAAY,IAAM0B,EAAS,IAAI,EAAG,CAAA,CAAE,EAEjDZ,EAAQd,EAAAA,YAAY,IAAM,CAC9B0B,EAAS,IAAI,EACb0D,EAAS,MAAM,EACf5D,EAAa,EAAK,CACpB,EAAG,CAAA,CAAE,EAEL,MAAO,CACL,MAAA2D,EACA,UAAA5D,EACA,MAAAE,EACA,WAAA4D,EACA,WAAAhC,EACA,MAAAvC,EAEA,kBAAmBP,EAAA,EACnB,eAAgBC,EAAA,CAAkB,CAEtC,CCpIA,MAAMiF,EAAa,EA4BZ,SAASC,EAAS,CACvB,MAAAzF,EAAQ,GACR,SAAAiE,EACA,WAAAyB,EACA,SAAAC,EAAW,GACX,MAAAnE,EACA,UAAAoE,EAAY,GACZ,UAAA5B,EAAY,EACd,EAAkB,CAChB,MAAM6B,EAAYpG,EAAAA,OAAoC,EAAE,EAClD,CAACqG,EAAYC,CAAa,EAAInG,EAAAA,SAASI,EAAM,OAAOwF,EAAY,EAAE,CAAC,EACnEQ,EAAKxB,EAAAA,MAAA,EAGX1D,EAAAA,UAAU,IAAM,CACdiF,EAAc/F,EAAM,OAAOwF,EAAY,EAAE,CAAC,CAC5C,EAAG,CAACxF,CAAK,CAAC,EAEV,MAAMiG,EAAalG,cAAamG,GAAkB,CAC5CA,GAAS,GAAKA,EAAQV,GACxBK,EAAU,QAAQK,CAAK,GAAG,MAAA,CAE9B,EAAG,CAAA,CAAE,EAECC,EAAcpG,EAAAA,YACjB4E,GAAqB,CACpB,MAAMyB,EAAYzB,EAAS,QAAQ,MAAO,EAAE,EAAE,MAAM,EAAGa,CAAU,EACjEO,EAAcK,EAAU,OAAOZ,EAAY,EAAE,CAAC,EAC9CvB,IAAWmC,CAAS,EAEhBA,EAAU,SAAWZ,GACvBE,IAAaU,CAAS,CAE1B,EACA,CAACnC,EAAUyB,CAAU,CAAA,EAGjBjB,EAAe1E,EAAAA,YACnB,CAACmG,EAAeG,IAAkB,CAChC,GAAI,CAAC,QAAQ,KAAKA,CAAK,EAAG,OAE1B,MAAMC,EAAQR,EAAW,MAAM,EAAE,EACjCQ,EAAMJ,CAAK,EAAIG,EACf,MAAM1B,EAAW2B,EAAM,KAAK,EAAE,EAAE,QAAQ,KAAM,EAAE,EAChDH,EAAYxB,CAAQ,EAGhB0B,GAASH,EAAQV,EAAa,GAChCS,EAAWC,EAAQ,CAAC,CAExB,EACA,CAACJ,EAAYK,EAAaF,CAAU,CAAA,EAGhCM,EAAgBxG,EAAAA,YACpB,CAACmG,EAAexB,IAA6C,CAC3D,GAAIA,EAAE,MAAQ,YAAa,CACzBA,EAAE,eAAA,EACF,MAAM4B,EAAQR,EAAW,MAAM,EAAE,EAE7BQ,EAAMJ,CAAK,GAAKI,EAAMJ,CAAK,IAAM,KAEnCI,EAAMJ,CAAK,EAAI,IACfC,EAAYG,EAAM,KAAK,EAAE,EAAE,QAAQ,KAAM,EAAE,CAAC,GACnCJ,EAAQ,IAEjBI,EAAMJ,EAAQ,CAAC,EAAI,IACnBC,EAAYG,EAAM,KAAK,EAAE,EAAE,QAAQ,KAAM,EAAE,CAAC,EAC5CL,EAAWC,EAAQ,CAAC,EAExB,MAAWxB,EAAE,MAAQ,aAAewB,EAAQ,GAC1CxB,EAAE,eAAA,EACFuB,EAAWC,EAAQ,CAAC,GACXxB,EAAE,MAAQ,cAAgBwB,EAAQV,EAAa,IACxDd,EAAE,eAAA,EACFuB,EAAWC,EAAQ,CAAC,EAExB,EACA,CAACJ,EAAYK,EAAaF,CAAU,CAAA,EAGhCO,EAAczG,EAAAA,YACjB2E,GAA4B,CAC3BA,EAAE,eAAA,EAEF,MAAM+B,EADS/B,EAAE,cAAc,QAAQ,MAAM,EACvB,QAAQ,MAAO,EAAE,EAAE,MAAM,EAAGc,CAAU,EACxDiB,IACFN,EAAYM,CAAM,EAElBR,EAAW,KAAK,IAAIQ,EAAO,OAAQjB,EAAa,CAAC,CAAC,EAEtD,EACA,CAACW,EAAaF,CAAU,CAAA,EAGpBS,EAAc3G,cAAa2E,GAA0C,CACzEA,EAAE,OAAO,OAAA,CACX,EAAG,CAAA,CAAE,EAGL5D,OAAAA,EAAAA,UAAU,IAAM,CACV8E,GAAa,CAACD,GAChBE,EAAU,QAAQ,CAAC,GAAG,MAAA,CAE1B,EAAG,CAACD,EAAWD,CAAQ,CAAC,EAGtBZ,EAAAA,KAAC,MAAA,CAAI,UAAW,oBAAoBf,CAAS,GAC3C,SAAA,CAAAgB,MAAC,OAAI,UAAU,mBAAmB,KAAK,QAAQ,aAAW,oBACvD,SAAA,MAAM,KAAK,CAAE,OAAQQ,CAAA,CAAY,EAAE,IAAI,CAACmB,EAAGT,IAC1ClB,EAAAA,IAAC,QAAA,CAEC,IAAM4B,GAAO,CACXf,EAAU,QAAQK,CAAK,EAAIU,CAC7B,EACA,GAAI,GAAGZ,CAAE,IAAIE,CAAK,GAClB,KAAK,OACL,UAAU,UACV,QAAQ,SACR,UAAW,EACX,UAAW,mBAAmB1E,EAAQ,wBAA0B,EAAE,GAClE,MAAOsE,EAAWI,CAAK,IAAM,IAAM,GAAKJ,EAAWI,CAAK,GAAK,GAC7D,SAAWxB,GAAMD,EAAayB,EAAOxB,EAAE,OAAO,KAAK,EACnD,UAAYA,GAAM6B,EAAcL,EAAOxB,CAAC,EACxC,QAAS8B,EACT,QAASE,EACT,SAAAf,EACA,aAAa,gBACb,aAAY,SAASO,EAAQ,CAAC,GAC9B,eAAc1E,EAAQ,OAAS,MAAA,EAlB1B0E,CAAA,CAoBR,EACH,EACC1E,GACCwD,EAAAA,IAAC,IAAA,CAAE,UAAU,mBAAmB,KAAK,QAClC,SAAAxD,CAAA,CACH,CAAA,EAEJ,CAEJ,CCnJO,SAASqF,EAAW,CACzB,SAAAxB,EACA,MAAAnD,EACA,UAAA4E,EACA,OAAAC,EACA,UAAA/C,EAAY,EACd,EAAoB,CAClB,KAAM,CAAE,WAAAoB,EAAY,UAAA9D,EAAW,MAAAE,EAAO,WAAA4B,CAAA,EAAe6B,EAAA,EAC/C,CAACK,EAAM0B,CAAO,EAAIpH,EAAAA,SAAS,EAAE,EAC7B,CAACqH,EAAeC,CAAgB,EAAItH,EAAAA,SAAS,EAAK,EAClD,CAACuH,EAAYC,CAAa,EAAIxH,EAAAA,SAAS,EAAE,EAEzCyH,EAAe,MAAOC,GAAwB,CAClD,MAAMC,EAAeD,IAAeL,EAAgBE,EAAa7B,GACjE,GAAKiC,EAEL,GAAI,CACF,MAAMnC,EAAWC,EAAUkC,CAAY,EACvCT,IAAA,CACF,MAAQ,CAEFG,EACFG,EAAc,EAAE,EAEhBJ,EAAQ,EAAE,CAEd,CACF,EAEMQ,EAAqBxH,GAAkB,CAC3CqH,EAAarH,CAAK,CACpB,EAEMyH,EAAmB,IAAM,CAC7BP,EAAiB,CAACD,CAAa,EAC/B7D,EAAA,EACA4D,EAAQ,EAAE,EACVI,EAAc,EAAE,CAClB,EAEA,OACErC,EAAAA,KAAC,MAAA,CAAI,UAAW,sBAAsBf,CAAS,GAC7C,SAAA,CAAAe,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CACC,UAAU,0BACV,MAAM,KACN,OAAO,KACP,QAAQ,YACR,KAAK,OACL,cAAY,OAEZ,SAAA,CAAAC,EAAAA,IAAC,OAAA,CAAK,EAAE,IAAI,EAAE,KAAK,MAAM,KAAK,OAAO,KAAK,GAAG,IAAI,OAAO,eAAe,YAAY,IAAI,EACvFA,EAAAA,IAAC,OAAA,CACC,EAAE,6BACF,OAAO,eACP,YAAY,IACZ,cAAc,OAAA,CAAA,EAEhBA,EAAAA,IAAC,UAAO,GAAG,KAAK,GAAG,KAAK,EAAE,IAAI,KAAK,cAAA,CAAe,CAAA,CAAA,CAAA,EAEpDA,EAAAA,IAAC,KAAA,CAAG,UAAU,oBAAoB,SAAA,4BAAyB,QAC1D,IAAA,CAAE,UAAU,0BACV,SAAAiC,EACG,+CACA,sDACN,EACC/E,GAAS8C,EAAAA,IAAC,IAAA,CAAE,UAAU,oBAAqB,SAAA9C,CAAA,CAAM,CAAA,EACpD,EAEC+E,EACClC,EAAAA,KAAC,MAAA,CAAI,UAAU,2BACb,SAAA,CAAAC,EAAAA,IAAC,QAAA,CACC,KAAK,OACL,UAAW,gBAAgBxD,EAAQ,qBAAuB,EAAE,GAC5D,YAAY,sBACZ,MAAO2F,EACP,SAAWzC,GAAM,CACf0C,EAAc1C,EAAE,OAAO,MAAM,YAAA,CAAa,EAC1CtB,EAAA,CACF,EACA,UAAYsB,GAAM,CACZA,EAAE,MAAQ,SAAWyC,GACvBE,EAAA,CAEJ,EACA,SAAU/F,EACV,UAAS,GACT,aAAa,eAAA,CAAA,EAEdE,SACE,IAAA,CAAE,UAAU,qBAAqB,KAAK,QACpC,WAAM,OAAA,CACT,CAAA,CAAA,CAEJ,EAEAwD,EAAAA,IAACS,EAAA,CACC,MAAOH,EACP,SAAWtF,GAAU,CACnBgH,EAAQhH,CAAK,EACboD,EAAA,CACF,EACA,WAAYoE,EACZ,SAAUlG,EACV,MAAOE,GAAO,QACd,UAAS,EAAA,CAAA,EAIbwD,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,UAAU,0EACV,QAAS,IAAMqC,EAAA,EACf,SAAU/F,IAAc2F,EAAgB,CAACE,EAAa7B,EAAK,SAAW,GAErE,WACCP,EAAAA,KAAA2C,EAAAA,SAAA,CACE,SAAA,CAAA1C,EAAAA,IAAC2C,EAAAA,eAAA,CAAe,KAAK,IAAA,CAAK,EAC1B3C,EAAAA,IAAC,QAAK,SAAA,cAAA,CAAY,CAAA,CAAA,CACpB,EAEA,QAAA,CAAA,EAIJD,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACb,SAAA,CAAAC,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,UAAU,6BACV,QAASyC,EACT,SAAUnG,EAET,WAAgB,wBAA0B,qBAAA,CAAA,EAG5CyF,GACChC,EAAAA,KAAA2C,WAAA,CACE,SAAA,CAAA1C,EAAAA,IAAC,OAAA,CAAK,UAAU,6BAA6B,SAAA,IAAC,EAC9CA,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,UAAU,6BACV,QAAS+B,EACT,SAAUzF,EACX,SAAA,eAAA,CAAA,CAED,CAAA,CACF,CAAA,CAAA,CAEJ,CAAA,EACF,CAEJ,CCjKO,SAASsG,GAAe,CAC7B,UAAAd,EACA,mBAAAe,EACA,iBAAAC,EACA,UAAA9D,EAAY,EACd,EAAwB,CACtB,KAAM,CAAE,OAAA7C,CAAA,EAAWE,iBAAA,EACb,CAAE,MAAAY,EAAO,UAAAX,EAAW,MAAAE,EAAO,WAAA4B,CAAA,EAAelC,EAAA,EAC1C,CACJ,gBAAAsC,EACA,UAAWuE,EACX,UAAWC,EACX,MAAOC,EACP,WAAYC,EACZ,MAAOC,CAAA,EACL9E,EAAA,EACE,CAACnB,EAAOkG,CAAQ,EAAIxI,EAAAA,SAAS,EAAE,EAC/B,CAACuC,EAAUkG,CAAW,EAAIzI,EAAAA,SAAS,EAAE,EAErC,CAACyF,EAAUiD,CAAW,EAAI1I,EAAAA,SAAwB,IAAI,EACtD,CAAC2I,EAAUC,CAAW,EAAI5I,EAAAA,SAAiB,EAAE,EAE7C6I,EAAqBtH,EAAO,OAAO,gBAAgB,MAAQ,QAE3DuH,EAAe,MAAOhE,GAAiB,CAC3CA,EAAE,eAAA,EACF,GAAI,CACF,MAAMxB,EAAS,MAAMjB,EAAMC,EAAOC,CAAQ,EACtCe,EAAO,aAEToF,EAAYpF,EAAO,QAAQ,EAC3BsF,EAAYtF,EAAO,KAAK,GAGxB4D,IAAA,CAEJ,MAAQ,CAER,CACF,EAEM6B,EAAoB,IAAM,CAC9BL,EAAY,IAAI,EAChBE,EAAY,EAAE,EACd1B,IAAA,CACF,EAEM8B,EAAiB,IAAM,CAC3BN,EAAY,IAAI,EAChBE,EAAY,EAAE,EACdH,EAAY,EAAE,CAChB,EAEMQ,EAAuB,SAAY,CACvC,GAAIJ,IAAuB,cAGzB,GAAI,CACF,MAAMjF,EAAgBtB,CAAK,CAC7B,MAAQ,CAER,MAGA4F,IAAA,CAEJ,EAGA,GAAIzC,EACF,OACEL,EAAAA,IAAC6B,EAAA,CACC,SAAAxB,EACA,MAAOkD,EACP,UAAWI,EACX,OAAQC,EACR,UAAA5E,CAAA,CAAA,EAMN,GAAIgE,EACF,OACEjD,EAAAA,KAAC,MAAA,CAAI,UAAW,+BAA+Bf,CAAS,GACtD,SAAA,CAAAe,EAAAA,KAAC,MAAA,CACC,UAAU,sBACV,MAAM,KACN,OAAO,KACP,QAAQ,YACR,KAAK,OACL,cAAY,OAEZ,SAAA,CAAAC,EAAAA,IAAC,SAAA,CAAO,GAAG,KAAK,GAAG,KAAK,EAAE,KAAK,OAAO,eAAe,YAAY,GAAA,CAAI,EACrEA,EAAAA,IAAC,OAAA,CACC,EAAE,mBACF,OAAO,eACP,YAAY,IACZ,cAAc,QACd,eAAe,OAAA,CAAA,CACjB,CAAA,CAAA,EAEFA,EAAAA,IAAC,KAAA,CAAG,UAAU,uBAAuB,SAAA,mBAAgB,EACrDD,EAAAA,KAAC,IAAA,CAAE,UAAU,yBAAyB,SAAA,CAAA,6BACVC,EAAAA,IAAC,UAAQ,SAAA9C,CAAA,CAAM,EAAS,8BAAA,EACpD,EACA8C,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,UAAU,uDACV,QAASmD,EACV,SAAA,eAAA,CAAA,CAED,EACF,EAIJ,MAAMW,EAAgBtH,GAASyG,EACzBc,EAAqB,IAAM,CAC/B3F,EAAA,EACA8E,EAAA,CACF,EACMc,EAAe1H,GAAayG,EAElC,cACG,OAAA,CAAK,SAAUW,EAAc,UAAW,eAAe1E,CAAS,GAC/D,SAAA,CAAAe,EAAAA,KAAC,MAAA,CAAI,UAAU,oBACb,SAAA,CAAAC,MAAC,QAAA,CAAM,QAAQ,QAAQ,UAAU,eAAe,SAAA,QAEhD,EACAA,EAAAA,IAAC,QAAA,CACC,GAAG,QACH,KAAK,QACL,UAAU,eACV,MAAO9C,EACP,SAAWwC,GAAM0D,EAAS1D,EAAE,OAAO,KAAK,EACxC,YAAY,kBACZ,SAAQ,GACR,gBAAc,OACd,aAAa,QACb,SAAUsE,CAAA,CAAA,CACZ,EACF,EAEAhE,EAAAA,IAAC,MAAA,CAAI,UAAU,oBACb,SAAAA,EAAAA,IAACrB,EAAA,CACC,MAAOxB,EACP,SAAWuC,GAAM2D,EAAY3D,EAAE,OAAO,KAAK,EAC3C,YAAY,sBACZ,SAAQ,GACR,aAAa,mBACb,SAAUsE,EACV,YACElB,GAAoBW,IAAuB,cACzCzD,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,UAAU,6BACV,QAAS6D,EACT,SAAUd,EAET,WAAuB,aAAe,uBAAA,CAAA,EAEvC,MAAA,CAAA,EAGV,EAEA/C,EAAAA,IAACiE,EAAAA,aAAA,CAAa,MAAOH,EAAe,UAAWC,EAAoB,EAEnE/D,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,UAAU,0EACV,SAAUgE,GAAgB,CAAC9G,GAAS,CAACC,EACrC,YAAWb,EAEV,WACCyD,EAAAA,KAAA2C,EAAAA,SAAA,CACE,SAAA,CAAA1C,MAAC2C,EAAAA,gBAAe,KAAK,KAAK,SAAQ,GAAC,MAAM,aAAa,EACtD3C,EAAAA,IAAC,QAAK,SAAA,eAAA,CAAa,CAAA,CAAA,CACrB,EAEA,SAAA,CAAA,EAIH6C,GACC9C,EAAAA,KAAC,IAAA,CAAE,UAAU,qBAAqB,SAAA,CAAA,yBACJ,IAC5BC,EAAAA,IAAC,UAAO,KAAK,SAAS,UAAU,cAAc,QAAS6C,EAAoB,SAAA,SAAA,CAE3E,CAAA,CAAA,CACF,CAAA,EAEJ,CAEJ,CChMO,SAASqB,GAAkB,CAChC,UAAApC,EACA,gBAAAqC,EACA,UAAAnF,EAAY,EACd,EAA2B,CACzB,KAAM,CAAE,OAAA7C,CAAA,EAAWE,iBAAA,EACb,CAAE,SAAAuB,EAAU,UAAAtB,EAAW,MAAAE,EAAO,WAAA4B,CAAA,EAAelC,EAAA,EAC7C,CAAC2B,EAAMuG,CAAO,EAAIxJ,EAAAA,SAAS,EAAE,EAC7B,CAACsC,EAAOkG,CAAQ,EAAIxI,EAAAA,SAAS,EAAE,EAC/B,CAACuC,EAAUkG,CAAW,EAAIzI,EAAAA,SAAS,EAAE,EACrC,CAACyJ,EAAiBC,CAAkB,EAAI1J,EAAAA,SAAS,EAAE,EACnD,CAAC2J,EAAoBC,CAAqB,EAAI5J,EAAAA,SAAoC,IAAI,EACtF,CAAC6J,EAAYC,CAAa,EAAI9J,EAAAA,SAA2B,IAAI,EAG7D+J,EAAcxI,EAAO,OAAO,eAC5ByI,EAAmBzI,EAAO,OAAO,WAEjC0I,EAAYF,GAAa,MAAQ,GACjCG,EAAgBH,GAAa,UAAY,GACzCI,EAAsBJ,GAAa,gBAAkB,GACrDK,EAAaL,GAAa,OAAS,kCACnCM,EAAWN,GAAa,IACxBO,EAAeC,GAAAA,oBAAoBF,CAAQ,EAE3CG,EAAiBR,GAAkB,MAAQ,GAC3CS,EAA2BT,GAAkB,gBAAkB,GAC/DU,EAAkBV,GAAkB,OAAS,2BAG7C,CAACW,EAAeC,CAAgB,EAAI5K,EAAAA,SAASmK,CAAmB,EAChE,CAACU,EAAYC,CAAa,EAAI9K,EAAAA,SAASyK,CAAwB,EAE/DM,EAAiBxI,IAAakH,EAC9BuB,EAAkBrB,GAAoB,SAAW,GAKjDsB,EACJ3I,GACAC,GACAkH,GACAsB,GACAC,IAPiB,CAACf,GAAa,CAACC,GAAiBS,IASjD,CAACjJ,EAEGoH,EAAe,MAAOhE,GAAiB,CAO3C,GANAA,EAAE,eAAA,EAGFgF,EAAc,IAAI,EAGdG,GAAaC,GAAiB,CAACS,EAAe,CAChDb,EAAc,CACZ,KAAM,mBACN,QAAS,oDAAA,CACV,EACD,MACF,CAEA,GAAKmB,EAEL,GAAI,CAIF,MAAMjI,EAASV,EAAOC,EAAUU,GAAQ,MAAS,EACjDiE,IAAA,CACF,MAAQ,CAER,CACF,EAEMgC,GAAgBtH,GAASiI,EACzBV,GAAqB,IAAM,CAC/B3F,EAAA,EACAsG,EAAc,IAAI,CACpB,EAEA,cACG,OAAA,CAAK,SAAUhB,EAAc,UAAW,eAAe1E,CAAS,GAC/D,SAAA,CAAAe,EAAAA,KAAC,MAAA,CAAI,UAAU,oBACb,SAAA,CAAAA,EAAAA,KAAC,QAAA,CAAM,QAAQ,OAAO,UAAU,eAAe,SAAA,CAAA,QACxCC,EAAAA,IAAC,OAAA,CAAK,UAAU,kBAAkB,SAAA,YAAA,CAAU,CAAA,EACnD,EACAA,EAAAA,IAAC,QAAA,CACC,GAAG,OACH,KAAK,OACL,UAAU,eACV,MAAOnC,EACP,SAAW6B,GAAM0E,EAAQ1E,EAAE,OAAO,KAAK,EACvC,YAAY,YACZ,aAAa,OACb,SAAUpD,CAAA,CAAA,CACZ,EACF,EAEAyD,EAAAA,KAAC,MAAA,CAAI,UAAU,oBACb,SAAA,CAAAC,MAAC,QAAA,CAAM,QAAQ,iBAAiB,UAAU,eAAe,SAAA,QAEzD,EACAA,EAAAA,IAAC,QAAA,CACC,GAAG,iBACH,KAAK,QACL,UAAU,eACV,MAAO9C,EACP,SAAWwC,GAAM0D,EAAS1D,EAAE,OAAO,KAAK,EACxC,YAAY,kBACZ,SAAQ,GACR,gBAAc,OACd,aAAa,QACb,SAAUpD,CAAA,CAAA,CACZ,EACF,EAEA0D,EAAAA,IAAC,MAAA,CAAI,UAAU,oBACb,SAAAA,EAAAA,IAACrB,EAAA,CACC,MAAOxB,EACP,SAAWuC,GAAM2D,EAAY3D,EAAE,OAAO,KAAK,EAC3C,YAAY,oBACZ,SAAQ,GACR,aAAa,eACb,SAAUpD,EACV,kBAAiB,GACjB,mBAAoBkI,CAAA,CAAA,EAExB,EAEAzE,EAAAA,KAAC,MAAA,CAAI,UAAU,oBACb,SAAA,CAAAC,MAAC,QAAA,CAAM,QAAQ,mBAAmB,UAAU,eAAe,SAAA,mBAE3D,EACAA,EAAAA,IAAC,QAAA,CACC,GAAG,mBACH,KAAK,WACL,UAAU,eACV,MAAOqE,EACP,SAAW3E,GAAM4E,EAAmB5E,EAAE,OAAO,KAAK,EAClD,YAAY,wBACZ,SAAQ,GACR,gBAAc,OACd,aAAa,eACb,SAAUpD,EACV,eAAc+H,GAAmB,CAACsB,EAAiB,OAAS,OAC5D,mBACEtB,GAAmB,CAACsB,EAAiB,yBAA2B,MAAA,CAAA,EAGnEtB,GAAmB,CAACsB,GACnB3F,MAAC,IAAA,CAAE,GAAG,yBAAyB,UAAU,qBAAqB,KAAK,QAAQ,SAAA,wBAAA,CAE3E,CAAA,EAEJ,EAGC6E,SACE,MAAA,CAAI,UAAU,0CACb,SAAA9E,EAAAA,KAAC,QAAA,CAAM,UAAU,wBACf,SAAA,CAAAC,EAAAA,IAAC,QAAA,CACC,KAAK,WACL,UAAU,kBACV,QAASuF,EACT,SAAW7F,GAAM8F,EAAiB9F,EAAE,OAAO,OAAO,EAClD,SAAUpD,EACV,gBAAewI,CAAA,CAAA,EAEjB/E,EAAAA,KAAC,OAAA,CAAK,UAAU,uBACb,SAAA,CAAAmF,EACCnF,EAAAA,KAAA2C,WAAA,CACG,SAAA,CAAAsC,EAAW,QAAQ,mBAAoB,EAAE,EAAE,QAAU,iBAAkB,IACxEhF,EAAAA,IAAC,IAAA,CACC,KAAMkF,EACN,OAAO,SACP,IAAI,sBACJ,UAAU,cACX,SAAA,kBAAA,CAAA,CAED,CAAA,CACF,EAEAF,EAEDF,GAAiB9E,EAAAA,IAAC,OAAA,CAAK,UAAU,kBAAkB,SAAA,GAAA,CAAC,CAAA,CAAA,CACvD,CAAA,CAAA,CACF,CAAA,CACF,EAIDoF,SACE,MAAA,CAAI,UAAU,0CACb,SAAArF,EAAAA,KAAC,QAAA,CAAM,UAAU,wBACf,SAAA,CAAAC,EAAAA,IAAC,QAAA,CACC,KAAK,WACL,UAAU,kBACV,QAASyF,EACT,SAAW/F,GAAMgG,EAAchG,EAAE,OAAO,OAAO,EAC/C,SAAUpD,CAAA,CAAA,EAEZ0D,EAAAA,IAAC,OAAA,CAAK,UAAU,uBAAwB,SAAAsF,CAAA,CAAgB,CAAA,CAAA,CAC1D,CAAA,CACF,EAGFtF,EAAAA,IAACiE,EAAAA,aAAA,CAAa,MAAOH,GAAe,UAAWC,GAAoB,EAEnE/D,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,UAAU,0EACV,SAAU,CAAC6F,EACX,YAAWvJ,EAEV,WACCyD,EAAAA,KAAA2C,EAAAA,SAAA,CACE,SAAA,CAAA1C,MAAC2C,EAAAA,gBAAe,KAAK,KAAK,SAAQ,GAAC,MAAM,mBAAmB,EAC5D3C,EAAAA,IAAC,QAAK,SAAA,qBAAA,CAAmB,CAAA,CAAA,CAC3B,EAEA,gBAAA,CAAA,EAIHmE,GACCpE,EAAAA,KAAC,IAAA,CAAE,UAAU,qBAAqB,SAAA,CAAA,2BACP,IACzBC,EAAAA,IAAC,UAAO,KAAK,SAAS,UAAU,cAAc,QAASmE,EAAiB,SAAA,SAAA,CAExE,CAAA,CAAA,CACF,CAAA,EAEJ,CAEJ"}