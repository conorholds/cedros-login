"use strict";const e=require("react/jsx-runtime"),a=require("react"),I=require("./useAdminDeposits-Dvx3_UUE.cjs"),T=require("./StatsBar-DTUZCwDD.cjs");function O({refreshInterval:t=0,className:r="",onLoad:h}){const{getStats:x,isLoading:j,error:b,clearError:y}=I.useAdminDeposits(),[d,w]=a.useState(null),[D,l]=a.useState(null),u=a.useCallback(async()=>{try{const i=await x();w(i),h?.(i),l(null)}catch(i){const N=i&&typeof i=="object"&&"message"in i?String(i.message):"Failed to load stats";l(N)}},[x,h]);a.useEffect(()=>{u()},[u]),a.useEffect(()=>{if(t<=0)return;const i=setInterval(u,t);return()=>clearInterval(i)},[t,u]);const g=D||b;return g?e.jsxs("div",{className:`cedros-admin-stats cedros-admin-stats-error ${r}`,children:[e.jsx("p",{className:"cedros-admin-error",children:g}),e.jsx("button",{type:"button",className:"cedros-button cedros-button-outline",onClick:()=>{y(),l(null),u()},children:"Retry"})]}):j&&!d?e.jsxs("div",{className:`cedros-admin-stats cedros-admin-stats-loading ${r}`,children:[e.jsx("span",{className:"cedros-admin-loading-indicator"}),e.jsx("span",{className:"cedros-admin-loading-text",children:"Loading statistics..."})]}):d?e.jsx("div",{className:`cedros-admin-stats ${r}`,children:e.jsx(T.StatsBar,{stats:[{label:"Total Deposits",value:d.totalDeposits},{label:"Private Deposits",value:d.inPrivacyPeriodCount??0},{label:"Standard Deposits",value:d.readyForWithdrawalCount??0},{label:"Microdeposits",value:d.nativeSolDepositCount??0}],isLoading:j,onRefresh:u})}):null}function q(t){return{pending:"Pending",detected:"Detected",processing:"Processing",completed:"Completed",withdrawn:"Withdrawn",partially_withdrawn:"Partially Withdrawn",expired:"Expired",failed:"Failed"}[t]||t}function _(t){return t==="completed"||t==="withdrawn"||t==="partially_withdrawn"?"cedros-admin-deposit-success":t==="failed"||t==="expired"?"cedros-admin-deposit-error":t==="processing"||t==="detected"?"cedros-admin-deposit-processing":"cedros-admin-deposit-pending"}function W(t){return t==null?"—":`${(t/1e9).toFixed(4)} SOL`}function B(t){return new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function P(t){return t.length<=12?t:`${t.slice(0,6)}...${t.slice(-4)}`}function V({statusFilter:t,pageSize:r=20,refreshInterval:h=0,className:x="",onLoad:j,onDepositClick:b}){const{listDeposits:y,isLoading:d,error:w,clearError:D}=I.useAdminDeposits(),[l,u]=a.useState([]),[g,i]=a.useState(0),[N,L]=a.useState(0),[M,A]=a.useState(null),[n,F]=a.useState("createdAt"),[c,k]=a.useState("desc"),v=s=>{n===s?k(c==="asc"?"desc":"asc"):(F(s),k("desc"))},R=a.useMemo(()=>[...l].sort((s,o)=>{let m,p;switch(n){case"userId":m=s.userId.toLowerCase(),p=o.userId.toLowerCase();break;case"amountLamports":m=s.amountLamports??0,p=o.amountLamports??0;break;case"status":m=s.status,p=o.status;break;case"createdAt":m=new Date(s.createdAt).getTime(),p=new Date(o.createdAt).getTime();break;case"txSignature":m=s.txSignature||"",p=o.txSignature||"";break;default:return 0}return m<p?c==="asc"?-1:1:m>p?c==="asc"?1:-1:0}),[l,n,c]),f=a.useCallback(async()=>{try{const s=await y({status:t,limit:r,offset:N});u(s.deposits),i(s.total),j?.(s),A(null)}catch(s){const o=s&&typeof s=="object"&&"message"in s?String(s.message):"Failed to load deposits";A(o)}},[t,r,N,y,j]);a.useEffect(()=>{L(0)},[t,r]),a.useEffect(()=>{f()},[f]),a.useEffect(()=>{if(h<=0)return;const s=setInterval(f,h);return()=>clearInterval(s)},[h,f]);const C=Math.ceil(g/r),S=Math.floor(N/r)+1,$=s=>{const o=(s-1)*r;L(Math.max(0,Math.min(o,Math.max(0,g-1))))},E=M||w;return E?e.jsxs("div",{className:`cedros-admin-deposit-list cedros-admin-deposit-list-error ${x}`,children:[e.jsx("p",{className:"cedros-admin-error",children:E}),e.jsx("button",{type:"button",className:"cedros-button cedros-button-outline",onClick:()=>{D(),A(null),f()},children:"Retry"})]}):d&&l.length===0?e.jsxs("div",{className:`cedros-admin-deposit-list cedros-admin-deposit-list-loading ${x}`,children:[e.jsx("span",{className:"cedros-admin-loading-indicator"}),e.jsx("span",{className:"cedros-admin-loading-text",children:"Loading deposits..."})]}):e.jsxs("div",{className:`cedros-admin-deposit-list ${x}`,children:[e.jsxs("div",{className:"cedros-admin-deposit-list-header",children:[e.jsx("h4",{className:"cedros-admin-deposit-list-title",children:"All Deposits"}),e.jsx("button",{type:"button",className:"cedros-admin__stats-bar-refresh",onClick:f,disabled:d,title:"Refresh deposits","aria-label":"Refresh deposits",children:d?"...":"↻"})]}),l.length===0?e.jsx("div",{className:"cedros-admin-empty",children:e.jsx("p",{className:"cedros-admin-empty-message",children:"No deposits found."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cedros-admin-deposit-table",children:[e.jsxs("div",{className:"cedros-admin-deposit-thead",children:[e.jsx("div",{className:"cedros-admin-deposit-th",children:e.jsxs("button",{type:"button",className:`cedros-admin-sort-button ${n==="userId"?"cedros-admin-sort-active":""}`,onClick:()=>v("userId"),"aria-label":"Sort by user",children:["User"," ",e.jsx("span",{className:"cedros-admin-sort-icon",children:n==="userId"?c==="asc"?"↑":"↓":"↕"})]})}),e.jsx("div",{className:"cedros-admin-deposit-th",children:e.jsxs("button",{type:"button",className:`cedros-admin-sort-button ${n==="amountLamports"?"cedros-admin-sort-active":""}`,onClick:()=>v("amountLamports"),"aria-label":"Sort by amount",children:["Amount"," ",e.jsx("span",{className:"cedros-admin-sort-icon",children:n==="amountLamports"?c==="asc"?"↑":"↓":"↕"})]})}),e.jsx("div",{className:"cedros-admin-deposit-th",children:e.jsxs("button",{type:"button",className:`cedros-admin-sort-button ${n==="status"?"cedros-admin-sort-active":""}`,onClick:()=>v("status"),"aria-label":"Sort by status",children:["Status"," ",e.jsx("span",{className:"cedros-admin-sort-icon",children:n==="status"?c==="asc"?"↑":"↓":"↕"})]})}),e.jsx("div",{className:"cedros-admin-deposit-th",children:e.jsxs("button",{type:"button",className:`cedros-admin-sort-button ${n==="createdAt"?"cedros-admin-sort-active":""}`,onClick:()=>v("createdAt"),"aria-label":"Sort by created",children:["Created"," ",e.jsx("span",{className:"cedros-admin-sort-icon",children:n==="createdAt"?c==="asc"?"↑":"↓":"↕"})]})}),e.jsx("div",{className:"cedros-admin-deposit-th",children:e.jsxs("button",{type:"button",className:`cedros-admin-sort-button ${n==="txSignature"?"cedros-admin-sort-active":""}`,onClick:()=>v("txSignature"),"aria-label":"Sort by transaction",children:["Tx"," ",e.jsx("span",{className:"cedros-admin-sort-icon",children:n==="txSignature"?c==="asc"?"↑":"↓":"↕"})]})})]}),R.map(s=>e.jsxs("div",{className:`cedros-admin-deposit-row ${_(s.status)}`,onClick:()=>b?.(s),onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),b?.(s))},role:b?"button":void 0,tabIndex:b?0:void 0,children:[e.jsx("div",{className:"cedros-admin-deposit-td",title:s.userId,children:P(s.userId)}),e.jsx("div",{className:"cedros-admin-deposit-td",children:W(s.amountLamports)}),e.jsx("div",{className:"cedros-admin-deposit-td",children:e.jsx("span",{className:"cedros-admin-status-badge",children:q(s.status)})}),e.jsx("div",{className:"cedros-admin-deposit-td",children:B(s.createdAt)}),e.jsx("div",{className:"cedros-admin-deposit-td",title:s.txSignature||void 0,children:s.txSignature?P(s.txSignature):"—"})]},s.id))]}),C>1&&e.jsxs("div",{className:"cedros-admin-pagination",children:[e.jsx("button",{type:"button",className:"cedros-button cedros-button-outline cedros-button-sm",onClick:()=>$(S-1),disabled:S<=1,children:"Previous"}),e.jsxs("span",{className:"cedros-admin-page-info",children:["Page ",S," of ",C," (",g," total)"]}),e.jsx("button",{type:"button",className:"cedros-button cedros-button-outline cedros-button-sm",onClick:()=>$(S+1),disabled:S>=C,children:"Next"})]})]})]})}exports.AdminDepositList=V;exports.AdminDepositStats=O;
