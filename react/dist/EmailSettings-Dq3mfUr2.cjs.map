{"version":3,"file":"EmailSettings-Dq3mfUr2.cjs","sources":["../src/components/admin/settings/EmailSettings.tsx"],"sourcesContent":["/**\n * Email settings page - SMTP configuration with provider-aware auto-fill\n */\nimport { useEffect, useMemo } from 'react';\nimport { LoadingSpinner } from '../../shared/LoadingSpinner';\nimport { ErrorMessage } from '../../shared/ErrorMessage';\nimport { useSettingsAutosave } from '../../../hooks/useSettingsAutosave';\nimport { SettingsSection } from './settingsInputs';\nimport { AutosaveStatus } from './AutosaveStatus';\n\n/** SMTP hosts auto-filled when selecting a known provider */\nexport const PROVIDER_SMTP_HOSTS: Record<string, string> = {\n  mailgun: 'smtp.mailgun.org',\n  sendgrid: 'smtp.sendgrid.net',\n  postmark: 'smtp.postmarkapp.com',\n  ses: 'email-smtp.us-east-1.amazonaws.com',\n  resend: 'smtp.resend.com',\n};\n\n/** Simplified fields for known providers (host/port/tls auto-configured) */\nexport const SIMPLIFIED_EMAIL_FIELDS = [\n  'email_provider',\n  'email_smtp_password',\n  'email_from_address',\n  'email_from_name',\n];\n\n/** All fields for custom SMTP */\nexport const ALL_EMAIL_FIELDS = [\n  'email_provider',\n  'email_smtp_host',\n  'email_smtp_port',\n  'email_smtp_user',\n  'email_smtp_password',\n  'email_smtp_tls',\n  'email_from_address',\n  'email_from_name',\n];\n\nexport interface EmailSettingsProps {\n  className?: string;\n}\n\nexport function EmailSettings({ className }: EmailSettingsProps) {\n  const {\n    settings,\n    edits,\n    isLoading,\n    autosaveStatus,\n    autosaveError,\n    error,\n    fetchSettings,\n    handleChange,\n    getEffectiveValue,\n  } = useSettingsAutosave();\n\n  useEffect(() => {\n    fetchSettings();\n  }, [fetchSettings]);\n\n  const emailProvider = getEffectiveValue('email_provider') || 'custom';\n  const isCustomProvider = emailProvider === 'custom';\n\n  // Check if SMTP is configured\n  const smtpHost = getEffectiveValue('email_smtp_host');\n  const isSmtpConfigured = !isCustomProvider || (smtpHost != null && smtpHost !== '');\n\n  // Filter and order fields based on provider mode\n  const currentSettings = useMemo(() => {\n    const categorySettings = settings['email'] ?? [];\n    const fieldsToShow = isCustomProvider ? ALL_EMAIL_FIELDS : SIMPLIFIED_EMAIL_FIELDS;\n    return categorySettings\n      .filter((s) => fieldsToShow.includes(s.key))\n      .sort((a, b) => fieldsToShow.indexOf(a.key) - fieldsToShow.indexOf(b.key));\n  }, [settings, isCustomProvider]);\n\n  // Auto-set SMTP host/port/tls when provider changes\n  const handleProviderAwareChange = (key: string, value: string) => {\n    handleChange(key, value);\n    if (key === 'email_provider' && value !== 'custom') {\n      const host = PROVIDER_SMTP_HOSTS[value];\n      if (host) {\n        handleChange('email_smtp_host', host);\n        handleChange('email_smtp_port', '587');\n        handleChange('email_smtp_tls', 'true');\n      }\n    }\n  };\n\n  if (isLoading && Object.keys(settings).length === 0) {\n    return (\n      <div className={`cedros-system-settings cedros-system-settings-loading ${className ?? ''}`}>\n        <LoadingSpinner />\n        <span>Loading settings...</span>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className={`cedros-system-settings ${className ?? ''}`}>\n        <ErrorMessage error={error.message} />\n      </div>\n    );\n  }\n\n  return (\n    <div className={`cedros-system-settings ${className ?? ''}`}>\n      <div className=\"cedros-settings-page-header\">\n        <div className=\"cedros-settings-page-header-content\">\n          <h2 className=\"cedros-settings-page-title\">Email & SMTP</h2>\n          <p className=\"cedros-settings-page-description\">\n            Configure email delivery for verification emails, password resets, and instant link\n            login.\n          </p>\n        </div>\n        <AutosaveStatus status={autosaveStatus} error={autosaveError} />\n      </div>\n\n      {!isSmtpConfigured && (\n        <div className=\"cedros-settings-warning-banner\">\n          Email features (verification, password reset, instant link) are disabled until SMTP is\n          configured. Select a provider or enter custom SMTP settings below.\n        </div>\n      )}\n\n      {currentSettings.length === 0 ? (\n        <div className=\"cedros-system-settings-empty\">\n          <p>No settings found for this section.</p>\n        </div>\n      ) : (\n        <SettingsSection\n          settings={currentSettings}\n          edits={edits}\n          onChange={handleProviderAwareChange}\n        />\n      )}\n    </div>\n  );\n}\n"],"names":["PROVIDER_SMTP_HOSTS","SIMPLIFIED_EMAIL_FIELDS","ALL_EMAIL_FIELDS","EmailSettings","className","settings","edits","isLoading","autosaveStatus","autosaveError","error","fetchSettings","handleChange","getEffectiveValue","useSettingsAutosave","useEffect","isCustomProvider","smtpHost","isSmtpConfigured","currentSettings","useMemo","categorySettings","fieldsToShow","s","a","b","handleProviderAwareChange","key","value","host","jsx","LoadingSpinner","ErrorMessage","jsxs","AutosaveStatus","SettingsSection"],"mappings":"oMAWaA,EAA8C,CACzD,QAAS,mBACT,SAAU,oBACV,SAAU,uBACV,IAAK,qCACL,OAAQ,iBACV,EAGaC,EAA0B,CACrC,iBACA,sBACA,qBACA,iBACF,EAGaC,EAAmB,CAC9B,iBACA,kBACA,kBACA,kBACA,sBACA,iBACA,qBACA,iBACF,EAMO,SAASC,EAAc,CAAE,UAAAC,GAAiC,CAC/D,KAAM,CACJ,SAAAC,EACA,MAAAC,EACA,UAAAC,EACA,eAAAC,EACA,cAAAC,EACA,MAAAC,EACA,cAAAC,EACA,aAAAC,EACA,kBAAAC,CAAA,EACEC,sBAAA,EAEJC,EAAAA,UAAU,IAAM,CACdJ,EAAA,CACF,EAAG,CAACA,CAAa,CAAC,EAGlB,MAAMK,GADgBH,EAAkB,gBAAgB,GAAK,YAClB,SAGrCI,EAAWJ,EAAkB,iBAAiB,EAC9CK,EAAmB,CAACF,GAAqBC,GAAY,MAAQA,IAAa,GAG1EE,EAAkBC,EAAAA,QAAQ,IAAM,CACpC,MAAMC,EAAmBhB,EAAS,OAAY,CAAA,EACxCiB,EAAeN,EAAmBd,EAAmBD,EAC3D,OAAOoB,EACJ,OAAQE,GAAMD,EAAa,SAASC,EAAE,GAAG,CAAC,EAC1C,KAAK,CAACC,EAAGC,IAAMH,EAAa,QAAQE,EAAE,GAAG,EAAIF,EAAa,QAAQG,EAAE,GAAG,CAAC,CAC7E,EAAG,CAACpB,EAAUW,CAAgB,CAAC,EAGzBU,EAA4B,CAACC,EAAaC,IAAkB,CAEhE,GADAhB,EAAae,EAAKC,CAAK,EACnBD,IAAQ,kBAAoBC,IAAU,SAAU,CAClD,MAAMC,EAAO7B,EAAoB4B,CAAK,EAClCC,IACFjB,EAAa,kBAAmBiB,CAAI,EACpCjB,EAAa,kBAAmB,KAAK,EACrCA,EAAa,iBAAkB,MAAM,EAEzC,CACF,EAEA,OAAIL,GAAa,OAAO,KAAKF,CAAQ,EAAE,SAAW,SAE7C,MAAA,CAAI,UAAW,yDAAyDD,GAAa,EAAE,GACtF,SAAA,CAAA0B,EAAAA,IAACC,EAAAA,eAAA,EAAe,EAChBD,EAAAA,IAAC,QAAK,SAAA,qBAAA,CAAmB,CAAA,EAC3B,EAIApB,EAEAoB,EAAAA,IAAC,MAAA,CAAI,UAAW,0BAA0B1B,GAAa,EAAE,GACvD,SAAA0B,EAAAA,IAACE,EAAAA,aAAA,CAAa,MAAOtB,EAAM,OAAA,CAAS,EACtC,SAKD,MAAA,CAAI,UAAW,0BAA0BN,GAAa,EAAE,GACvD,SAAA,CAAA6B,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,sCACb,SAAA,CAAAH,EAAAA,IAAC,KAAA,CAAG,UAAU,6BAA6B,SAAA,eAAY,EACvDA,EAAAA,IAAC,IAAA,CAAE,UAAU,mCAAmC,SAAA,4FAAA,CAGhD,CAAA,EACF,EACAA,EAAAA,IAACI,EAAAA,eAAA,CAAe,OAAQ1B,EAAgB,MAAOC,CAAA,CAAe,CAAA,EAChE,EAEC,CAACS,GACAY,EAAAA,IAAC,MAAA,CAAI,UAAU,iCAAiC,SAAA,4JAGhD,EAGDX,EAAgB,SAAW,EAC1BW,EAAAA,IAAC,MAAA,CAAI,UAAU,+BACb,SAAAA,EAAAA,IAAC,IAAA,CAAE,SAAA,qCAAA,CAAmC,CAAA,CACxC,EAEAA,EAAAA,IAACK,EAAAA,gBAAA,CACC,SAAUhB,EACV,MAAAb,EACA,SAAUoB,CAAA,CAAA,CACZ,EAEJ,CAEJ"}