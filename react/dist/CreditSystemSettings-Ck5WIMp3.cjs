"use strict";const s=require("react/jsx-runtime"),o=require("react"),E=require("./LoadingSpinner-d6sSxgQN.cjs"),M=require("./ErrorMessage-CHbYbVi2.cjs"),p=require("./AutosaveStatus-CYkC2aI_.cjs"),v=[{id:"deposits",label:"Deposits",categories:["deposit.general"],includeKeys:["deposit_company_token","deposit_max_usd","deposit_min_usd","deposit_micro_enabled","deposit_gasless_swap_enabled","solana_rpc_url","jupiter_api_key"]},{id:"tokens",label:"Component",categories:["deposit"],includeKeys:["deposit_show_explainer","deposit_quick_action_tokens","deposit_custom_tokens","deposit_custom_tokens_json"]},{id:"fees",label:"Fees",categories:["deposit"],includeKeys:["deposit_fee_policy","privacy_fee_fixed_lamports","privacy_fee_percent_bps","swap_fee_fixed_lamports","swap_fee_percent_bps","company_fee_fixed_lamports","company_fee_percent_bps","private_deposit_min_lamports"]},{id:"privacy",label:"Privacy",categories:["deposit.general","privacy","withdrawal"],includeKeys:["deposit_privacy_enabled","privacy_period_secs","withdrawal_percentage","withdrawal_min_lamports","partial_withdrawal_count","partial_withdrawal_min_lamports"],sections:[{title:"Privacy Pool Worker",description:"Background worker for processing withdrawals from the privacy cash pool.",keys:["withdrawal_poll_interval_secs","withdrawal_batch_size"]}]},{id:"treasury",label:"Treasury",categories:["withdrawal","deposit"],includeKeys:["treasury_wallet_address"],sections:[{title:"Micropayment Batch Worker",description:"Background worker for batching small SOL deposits together.",keys:["micro_batch_threshold_usd","micro_batch_poll_secs"]}]}];function O({className:_}){const{settings:u,edits:f,isLoading:j,autosaveStatus:k,autosaveError:w,error:h,fetchSettings:b,handleChange:g,getEffectiveValue:n}=p.useSettingsAutosave(),[m,S]=o.useState("deposits");o.useEffect(()=>{b()},[b]);const t=v.find(e=>e.id===m),c=o.useMemo(()=>{if(!t)return[];const e=[];for(const i of t.categories){const r=u[i]??[];e.push(...r)}return e},[u,t]),a=n("deposit_fee_policy")||"company_pays_all",y=o.useMemo(()=>{if(!t)return[];let e=c;if(t.includeKeys&&t.includeKeys.length>0?(e=e.filter(i=>t.includeKeys.includes(i.key)),e.sort((i,r)=>t.includeKeys.indexOf(i.key)-t.includeKeys.indexOf(r.key))):t.excludeKeys&&t.excludeKeys.length>0&&(e=e.filter(i=>!t.excludeKeys.includes(i.key))),t.id==="deposits"&&(parseFloat(n("deposit_min_usd"))||0)>10&&(e=e.filter(r=>r.key!=="deposit_micro_enabled")),t.id==="fees"){const i=["privacy_fee_fixed_lamports","privacy_fee_percent_bps","private_deposit_min_lamports"],r=["swap_fee_fixed_lamports","swap_fee_percent_bps"],x=["company_fee_fixed_lamports","company_fee_percent_bps"];e=e.filter(l=>l.key==="deposit_fee_policy"?!0:a==="company_pays_all"?!1:i.includes(l.key)?a==="user_pays_privacy"||a==="user_pays_all":r.includes(l.key)?a==="user_pays_swap"||a==="user_pays_all":x.includes(l.key)?a==="user_pays_all":!0)}return e},[c,t,n,a]),N=o.useCallback(e=>c.filter(i=>e.includes(i.key)).sort((i,r)=>e.indexOf(i.key)-e.indexOf(r.key)),[c]),K=o.useMemo(()=>{if(t?.id!=="deposits")return;const e={},i=parseFloat(n("deposit_min_usd"))||0,r=n("deposit_micro_enabled");return(r==="false"||r==="0"||r==="")&&i<10&&(e.deposit_min_usd="SOL micro payments must be enabled for minimum deposits under $10."),Object.keys(e).length>0?e:void 0},[t?.id,n]),d=n("feature_credits")==="true",C=()=>{g("feature_credits",d?"false":"true")};return j&&Object.keys(u).length===0?s.jsxs("div",{className:`cedros-system-settings cedros-system-settings-loading ${_??""}`,children:[s.jsx(E.LoadingSpinner,{}),s.jsx("span",{children:"Loading settings..."})]}):h?s.jsx("div",{className:`cedros-system-settings ${_??""}`,children:s.jsx(M.ErrorMessage,{error:h.message})}):s.jsxs("div",{className:`cedros-system-settings ${_??""}`,children:[s.jsxs("div",{className:"cedros-settings-page-header",children:[s.jsxs("div",{className:"cedros-settings-page-header-content",children:[s.jsx("h2",{className:"cedros-settings-page-title",children:"Credit System"}),s.jsx("p",{className:"cedros-settings-page-description",children:"Configure credit deposits, timed withdrawals, and privacy period settings."})]}),s.jsxs("div",{className:"cedros-settings-page-header-actions",children:[s.jsxs("button",{type:"button",role:"switch","aria-checked":d,className:`cedros-toggle ${d?"cedros-toggle-on":"cedros-toggle-off"}`,onClick:C,children:[s.jsx("span",{className:"cedros-toggle-track",children:s.jsx("span",{className:"cedros-toggle-thumb"})}),s.jsx("span",{className:"cedros-toggle-label",children:d?"Enabled":"Disabled"})]}),s.jsx(p.AutosaveStatus,{status:k,error:w})]})]}),s.jsx("div",{className:"cedros-admin-tabs cedros-admin-tabs--line",children:v.map(e=>s.jsx("button",{type:"button",className:`cedros-admin-tab ${m===e.id?"cedros-admin-tab-active":""}`,onClick:()=>S(e.id),"aria-selected":m===e.id,role:"tab",children:e.label},e.id))}),s.jsx("div",{className:"cedros-admin-tab-content",role:"tabpanel",children:y.length===0&&!t?.sections?.length?s.jsx("div",{className:"cedros-system-settings-empty",children:s.jsxs("p",{children:["No settings found for ",t?.label??"this section","."]})}):s.jsxs(s.Fragment,{children:[y.length>0&&s.jsx(p.SettingsSection,{settings:y,edits:f,onChange:g,externalWarnings:K}),t?.sections?.map(e=>{const i=N(e.keys);return i.length===0?null:s.jsxs("div",{className:"cedros-settings-subsection",children:[s.jsxs("div",{className:"cedros-settings-subsection-header",children:[s.jsx("h4",{className:"cedros-settings-subsection-title",children:e.title}),e.description&&s.jsx("p",{className:"cedros-settings-subsection-description",children:e.description})]}),s.jsx(p.SettingsSection,{settings:i,edits:f,onChange:g})]},e.title)})]})})]})}exports.CreditSystemSettings=O;
